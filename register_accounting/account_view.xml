<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

    <menuitem id="account.menu_finance_bank_and_cash" name="Registers" parent="account.menu_finance" sequence="4"
                groups="account.group_account_user,account.group_account_manager"/>
    <!-- Bank Register Form => Inheritance -->
        <record id="inherit_view_bank_statement_form" model="ir.ui.view">
            <field name='name'>inherit.view.bank.statement.form</field>
            <field name='model'>account.bank.statement</field>
            <field name="type">form</field>
            <field name='inherit_id' ref='account.view_bank_statement_form' />
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <xpath expr="/form" position="replace">
                    <form string="Bank Register" hide_new_button="1" hide_delete_button="1">
                        <group col="6" colspan="4">
                            <field name="name" select="1" readonly="0" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="code" />
                            <field name="journal_id" domain="[('type', '=', 'bank')]" on_change="onchange_journal_id(journal_id)" select="1"/>
                            <newline/>
                            <field name="date" select="1" on_change="onchange_date(date)"/>
                            <field name="period_id" readonly="1" domain="[('state', '=', 'draft')]"/>
                            <field name="journal_name"/>
                            <newline/>
                            <field name="prev_reg_id" invisible="1"/>
                            <field name="balance_start" attrs="{'readonly': ['|', ('prev_reg_id', '!=', False), ('closing_balance_frozen', '=', True)]}"/>
                            <group col="3" colspan="4">
                                <field name="balance_end_real" colspan="2" attrs="{'readonly': ['|', ('closing_balance_frozen', '=', True), ('state', 'in', ['confirm'])]}" string="Bank register balance"/>
                                <button name="button_confirm_closing_balance" type="object" string="Confirm Closing Balance" icon="gtk-apply" 
                                    colspan="1" attrs="{'readonly': [('closing_balance_frozen', '=', True)]}" states="open"
                                    confirm="This action is IRREVERSIBLE. After that it will be impossible to change closing balance. Are you sure to freeze closing balance?"/>
                            </group>
                            <field name="balance_end" readonly="1"/>
                            <field name="balance_gap"/>
                            <field name="currency" invisible="1"/>
                            <field name='company_id' widget="selection" groups="base.group_multi_company" invisible="1"/>
                            <field name="virtual_id" invisible="1" readonly="1"/>
                            <field name="closing_balance_frozen" invisible="1"/>
                        </group>
                        <group col="4" colspan="4">
                            <button name="button_wiz_temp_posting" states="open" string="Temp Posting" type="object" icon="terp-gtk-jump-to-ltr" 
                                context="context"/>
                            <button name="button_wiz_hard_posting" states="open" string="Hard Posting" type="object" icon="terp-camera_test" 
                                context="context"/>
                            <label string="" colspan="2"/>
                        </group>
                        <group col="4" colspan="4">
                            <button name="button_create_invoice" states="open" string="Direct Invoice" type="object" icon="terp-document-new" />
                            <button name="button_wiz_import_cheques" states="open" string="Import Cheques" type="object" icon="gtk-dnd"/>
                            <button name="button_wiz_import_invoices" states="open" string="Import Invoices" type="object" icon="gtk-save"/>
                            <label string="" colspan="1"/>
                        </group>
                        <group col="4" colspan="4">
                            <button name="button_open_advances" string="List of Open Advances" type="object" icon="gtk-justify-fill" colspan="2"/>
                            <label string="" colspan="4"/>
                        </group>
                        <notebook colspan="4">
                            <page string="Transaction" name="statement_line_ids">
                                <field colspan="4" name="line_ids" nolabel="1">
                                    <tree editable="bottom" string="Statement lines" noteditable="state=='hard'" colors="red:display_analytic_button and not analytic_distribution_id">
                                        <button name="button_duplicate" string="Duplicate" type="object" icon="gtk-copy" />
                                        <field name="date" string="Posting Date"/>
                                        <field name="document_date" attrs="{'readonly': [('from_import_cheque_id', '!=', False)]}"/>
                                        <field name="sequence_for_reference" />
                                        <field name="name" string="Description"/>
                                        <field name="partner_type_mandatory" invisible="1"/>
                                        <field name="ref"/>
                                        <field domain="[('journal_id','=',parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id" 
                                            on_change="onchange_account(account_id, parent.virtual_id)" 
                                            attrs="{'readonly': ['|',('from_import_cheque_id', '!=', False),('number_imported_invoice', '>', 0)]}"
                                        />
                                        <field name="partner_type" 
                                            attrs="{'readonly': ['|',('from_import_cheque_id', '!=', False),('number_imported_invoice', '>', 0)], 'required': [('partner_type_mandatory', '=', True)]}"
                                            domain="[('filter_for_third_party', '=', account_id)]"
                                            context="{'curr': parent.currency}" />
                                        <field name="analytic_account_id" groups="analytic.group_analytic_accounting" 
                                            domain="[('company_id', '=', parent.company_id), ('type', '&lt;&gt;', 'view')]" invisible="1"/>
                                        <field name="analytic_distribution_id" invisible="1"/>
                                        <field name="display_analytic_button" invisible="1"/>
                                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" 
                                            context="context" attrs="{'readonly': [('from_import_cheque_id', '!=', False)], 'invisible': [('display_analytic_button', '=', False)]}"/>
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0" attrs="{'readonly': [('from_import_cheque_id', '!=', False)]}"/>
                                        <field name="amount_out" readonly="0" attrs="{'readonly': [('from_import_cheque_id', '!=', False)]}"/>
                                        <field name="direct_invoice" invisible="1"/>
                                        <field name="invoice_id" invisible="1"/>
                                        <field name="number_imported_invoice"  invisible="1"/>
                                        <button name="button_open_invoice" attrs="{'invisible': [('invoice_id', '=', False)]}" 
                                            string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                        <button name="button_open_invoices" attrs="{'invisible': [('number_imported_invoice', '=', 0)]}" 
                                            string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                        <field name="reconciled"/>
                                        <button name="button_temp_posting" states="draft" string="Temp" type="object" icon="terp-gtk-jump-to-ltr" 
                                            context="context"/>
                                        <button name="button_hard_posting" states="draft,temp" string="Hard" type="object" icon="terp-camera_test" 
                                            context="context"/>
                                        <field name="state" readonly="True"/>
                                        <field name="from_import_cheque_id" invisible="1"/>
                                    </tree>
                                    <form string="Statement lines">
                                        <field name="date" string="Posting Date"/>
                                        <field name="document_date" attrs="{'readonly': [('from_import_cheque_id', '!=', False)]}"/>
                                        <field name="sequence" invisible="1"/>
                                        <field name="sequence_for_reference"/>
                                        <field name="name" string="Description"/>
                                        <field name="partner_type_mandatory" invisible="1"/>
                                        <field name="ref"/>
                                        <field domain="[('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id"
                                            on_change="onchange_account(account_id, parent.virtual_id)"
                                            attrs="{'readonly': ['|',('from_import_cheque_id', '!=', False),('number_imported_invoice', '>', 0)]}"
                                            />
                                        <field name="partner_type" 
                                            attrs="{'readonly': ['|',('from_import_cheque_id', '!=', False),('number_imported_invoice', '>', 0)], 'required': [('partner_type_mandatory', '=', True)]}"
                                            domain="[('filter_for_third_party', '=', account_id)]" 
                                            context="{'curr': parent.currency}" />
                                        <field name="display_analytic_button" invisible="1"/>
                                        <field name="analytic_distribution_id" invisible="1"/>
                                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" 
                                            context="context" attrs="{'readonly': [('from_import_cheque_id', '!=', False)], 'invisible': [('display_analytic_button', '=', False)]}"/>
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0" attrs="{'readonly': [('from_import_cheque_id', '!=', False)]}" />
                                        <field name="amount_out" readonly="0" attrs="{'readonly': [('from_import_cheque_id', '!=', False)]}"/>
                                        <field name="direct_invoice" invisible="1"/>
                                        <field name="invoice_id" invisible="1"/>
                                        <field name="number_imported_invoice"  invisible="1"/>
                                        <button name="button_open_invoice" attrs="{'invisible': [('invoice_id', '=', False)]}" 
                                            string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                        <field name="reconciled"/>
                                        <field name="state" readonly="True"/>
                                        <field name="from_import_cheque_id" invisible="1"/>
                                        <separator colspan="4" string="Notes"/>
                                        <field colspan="4" name="note" nolabel="1"/>
                                    </form>
                                </field>
                            </page>
                        </notebook>
                        <group col="8" colspan="4">
                            <field name="state" readonly="1"/>
                            <button name="button_dummy" states="draft,open" string="Compute" type="object" icon="terp-stock_format-scientific"/>
                            <button name="button_open_bank" states="draft" string="Open Bank" type="object" icon="gtk-go-forward"/>
                            <button name="button_confirm_bank" states="open" string="Confirm" type="object" icon="terp-camera_test"/>
                        </group>
                    </form>
                </xpath>
            </field>
        </record>

    <!-- Cash Register Form => Inheritance -->
        <record id="inherit_view_bank_statement_form2" model="ir.ui.view">
            <field name='name'>inherit.view.bank.statement.form2</field>
            <field name='model'>account.bank.statement</field>
            <field name="type">form</field>
            <field name='inherit_id' ref='account.view_bank_statement_form2' />
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <xpath expr="/form" position="replace">
                    <form string="Statement" hide_new_button="1" hide_delete_button="1">
                        <group col="6" colspan="4">
                            <field name="name" readonly="1"/>
                            <field name="code"   attrs="{'readonly': [('state', 'not in',('draft'))]}"/>
                            <field name="company_id" select="1" groups="base.group_multi_company" invisible="True"/>
                            <field name="journal_id" on_change="onchange_journal_id(journal_id)" domain="[('type','=','cash')]" select="1"/>
                            <newline/>
                            
                            <field name="user_id" select="1" readonly="1"/>
                            <field name="period_id" select="1" domain="[('state', '=', 'draft')]"/>
                            <field name="journal_name"/>
                            
                            <field name="currency" invisible="1"/>
                            <field name="virtual_id" invisible="1" readonly="1"/>
                        </group>
                        <group col="2" colspan="4">
                            <button name="button_wiz_temp_posting" states="open" string="Temp Posting" type="object" icon="terp-gtk-jump-to-ltr" 
                                context="context"/>
                            <button name="button_wiz_hard_posting" states="open" string="Hard Posting" type="object" icon="terp-camera_test" 
                                context="context"/>
                            <button name="button_create_invoice" states="open" string="Direct Invoice" type="object" icon="terp-document-new" />
                            <button name="button_wiz_import_invoices" states="open" string="Import Invoices" type="object" icon="gtk-save"/>
                        </group>
                        <group col="4" colspan="4">
                            <button name="button_open_advances" string="List of Open Advances" type="object" icon="gtk-justify-fill" colspan="2"/>
                            <label string="" colspan="4"/>
                        </group>
                        <notebook colspan="4">
                            <page string="Cash Transactions" attrs="{'invisible': [('state','=','draft')]}">
                                <field colspan="4" name="line_ids" nolabel="1">
                                    <tree editable="bottom" string="Statement lines" noteditable="state=='hard'" colors="red:display_analytic_button and not analytic_distribution_id">
                                        <button name="button_duplicate" string="Duplicate" type="object" icon="gtk-copy" />
                                        <field name="from_cash_return" invisible="1"/>
                                        <button name="button_advance" states="hard" string="Advance return" type="object" 
                                            icon="terp-stock_effects-object-colorize" context="context" 
                                            attrs="{'invisible': ['|', ('from_cash_return', '=', True), '|', ('amount', '&gt;=', 0), 
                                            ('employee_id', '=', False)]}"/>
                                        <field name="date" />
                                        <field name="document_date"/>
                                        <field name="sequence_for_reference"/>
                                        <field name="name" string="Description"/>
                                        <field name="partner_type_mandatory" invisible="1"/>
                                        <field name="ref"/>
                                        <field domain="[('journal_id','=',parent.journal_id),('type', '&lt;&gt;', 'view')]" name="account_id" 
                                            on_change="onchange_account(account_id, parent.virtual_id)"
                                            attrs="{'readonly': [('number_imported_invoice', '>', 0)]}" />
                                        <field name="partner_type"  
                                            attrs="{'required': [('partner_type_mandatory', '=', True)], 'readonly': [('number_imported_invoice', '>', 0)]}"
                                            domain="[('filter_for_third_party', '=', account_id)]"
                                            context="{'curr': parent.currency}" 
                                            />
                                        <field name="analytic_distribution_id" invisible="1"/>
                                        <field name="display_analytic_button" invisible="1"/>
                                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" 
                                            attrs="{'invisible': [('display_analytic_button', '=', False)]}" context="context"/>
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0"/>
                                        <field name="amount_out" readonly="0"/>
                                        <field name="direct_invoice" invisible="1"/>
                                        <field name="invoice_id" invisible="1"/>
                                        <field name="number_imported_invoice"  invisible="1"/>
                                        <button name="button_open_invoice" attrs="{'invisible': [('invoice_id', '=', False)]}" 
                                            string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                        <button name="button_open_invoices" attrs="{'invisible': [('number_imported_invoice', '=', 0)]}"
                                            string="Open invoices" type="object" icon="gtk-index" context="context"/>
                                        <field name="reconciled"/>
                                        <button name="button_temp_posting" states="draft" string="Temp" type="object" icon="terp-gtk-jump-to-ltr" 
                                            context="context"/>
                                        <button name="button_hard_posting" states="draft,temp" string="Hard" type="object" icon="terp-camera_test" 
                                            context="context"/>
                                        <field name="state" readonly="True"/>
                                        <field name="employee_id" invisible="1"/>
                                    </tree>
                                    <form string="Statement lines">
                                        <field name="from_cash_return" invisible="1"/>
                                        <field name="date"/>
                                        <field name="document_date"/>
                                        <field name="sequence_for_reference"/>
                                        <field name="name" string="Description"/>
                                        <field name="partner_type_mandatory" invisible="1"/>
                                        <field name="ref"/>
                                        <field domain="[('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id"
                                            on_change="onchange_account(account_id, parent.virtual_id)"
                                            attrs="{'readonly': [('number_imported_invoice', '>', 0)]}"/>
                                        <field name="partner_type"
                                            attrs="{'required': [('partner_type_mandatory', '=', True)], 'readonly': [('number_imported_invoice', '>', 0)]}"
                                            domain="[('filter_for_third_party', '=', account_id)]"
                                            context="{'curr': parent.currency}" 
                                            />
                                        <field name="analytic_distribution_id" invisible="1"/>
                                        <field name="display_analytic_button" invisible="1"/>
                                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" 
                                            attrs="{'invisible': [('display_analytic_button', '=', False)]}" context="context"/>
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0"/>
                                        <field name="amount_out" readonly="0"/>
                                        <field name="direct_invoice" invisible="1"/>
                                        <field name="invoice_id" invisible="1"/>
                                        <field name="number_imported_invoice"  invisible="1"/>
                                        <button name="button_open_invoice" attrs="{'invisible': [('invoice_id', '=', False)]}" 
                                            string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                        <separator colspan="4" string="Notes"/>
                                        <field colspan="4" name="note" nolabel="1"/>
                                        <field name="state" readonly="True"/>
                                    </form>
                                </field>
                            </page>
                            <page string="CashBox">
                                <field name="prev_reg_id" invisible="1"/>
                                <group col="2" colspan="2" expand="1">
                                    <field name="starting_details_ids" nolabel="1" colspan="2" attrs="{'readonly':['|',('state','!=','draft'),('prev_reg_id','!=',False)]}">
                                        <tree string = "Opening Balance" editable="bottom">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal" sum="Total"/>
                                        </tree>
                                        <form string = "Opening Balance">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal"/>
                                        </form>
                                    </field>
                                </group>
                                <group col="2" colspan="2" expand="1">
                                    <field name="closing_balance_frozen" invisible="1"/>
                                    <field name="ending_details_ids" nolabel="1" colspan="2" attrs="{'readonly':['|', ('state','!=','open'), ('closing_balance_frozen', '=', True)]}">
                                        <tree string = "Closing Balance" editable="bottom">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal" sum="Total"/>
                                        </tree>
                                        <form string = "Closing Balance">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal"/>
                                        </form>
                                    </field>
                                    <button name="button_confirm_closing_balance" type="object" string="Confirm Closing Balance" icon="gtk-apply" 
                                        colspan="1" attrs="{'readonly': [('closing_balance_frozen', '=', True)]}" states="open"
                                        confirm="This action is IRREVERSIBLE. After that it will be impossible to change closing balance. Are you sure to freeze closing balance?"/>
                                </group>
                            </page>
                        </notebook>
                        <group col="6" colspan="4">
                            <group col="2" colspan="2">
                                <separator string="Dates" colspan="4"/>
                                <field name="date" select="1" readonly="True" on_change="onchange_date(date)" string="Opening Date"/>
                                <field name="closing_date" select="1" readonly="1"/>
                            </group>
                            <group col="2" colspan="2">
                                <separator string="Opening Balance" colspan="4"/>
                                <field name="balance_start" string="Opening Balance" readonly="True"/>
                                <field name="total_entry_encoding"/>
                                <field name="open_advance_amount"  attrs="{'readonly': [('state', 'not in',('draft', 'open'))]}"/>
                                <field name="unrecorded_expenses_amount"  attrs="{'readonly': [('state', 'not in',('draft', 'open'))]}"/>
                            </group>
                            <group col="2" colspan="2">
                                <separator string="Closing Balance" colspan="4"/>
                                <field name="balance_end" string="Calculated Balance" readonly="1"/>
                                <field name="balance_end_cash" readonly="1" string="CashBox Balance"/>
                                <field name="closing_gap" readonly="1"/>
                                <field name="comments" attrs="{'readonly': [('state', 'not in',('draft', 'open'))]}"/>
                            </group>
                        </group>
                        <separator string="State" />
                        <group name="state" colspan="4">
                            <field name="state" colspan="4" readonly="True"/>
                        </group>
                        <button name="button_open_cash" states="draft" string="Open CashBox" icon="gtk-go-forward" type="object" colspan="2"/>
                        <group name="open_state" colspan="4">
                            <button name="button_confirm_cash" states="open" string="Close CashBox" icon="gtk-ok" type="object" colspan="2" />
                        </group>
                    </form>
                </xpath>
            </field>
        </record>

    <!-- Bank Statement Line Tree View -->
        <record model="ir.ui.view" id="view_account_bank_statement_line_tree">
            <field name="name">view.account.bank.statement.line.tree</field>
            <field name="model">account.bank.statement.line</field>
            <field name="type">tree</field>
            <field name="priority" eval="20" />
            <field name="arch" type="xml">
                <tree string="Register Lines">
                    <button name="button_advance" states="hard" string="Advance return" type="object" icon="terp-stock_effects-object-colorize" context="context"/>
                    <field name="date"/>
                    <field name="name" string="Description"/>
                    <field name="account_id"/>
                    <field name="partner_type"/>
                    <field name="partner_id" invisible="1"/>
                    <field name="employee_id" invisible="1"/>
                    <field name="register_id" invisible="1"/>
                    <field name="amount_in"/>
                    <field name="amount_out"/>
                    <field name="currency_id"/>
                    <field name="functional_in"/>
                    <field name="functional_out"/>
                    <field name="functional_currency_id"/>
                    <field name="state"/>
                    <field name="statement_id"/>
                </tree>
            </field>
        </record>

    <!-- Bank Statement Line Filter -->
        <record id="view_account_bank_statement_line_filter" model="ir.ui.view">
            <field name="name">view.account.bank.statement.line.select</field>
            <field name="model">account.bank.statement.line</field>
            <field name="type">search</field>
            <field name="priority" eval="20" />
            <field name="arch" type="xml">
                <search string="Register Lines">
                    <group col='10' colspan='4'>
                        <filter string="Draft" domain="[('state','=','draft')]" icon="terp-document-new"/>
                        <filter string="Temp" domain="[('state','=','temp')]" icon="terp-camera_test"/>
                        <separator orientation="vertical"/>
                        <field name="date" select='1'/>
                        <field name="name" select='1'/>
                        <field name="account_id" select='1'/>
                        <field name="employee_id" select='1'/>
                        <field name="amount" select='1'/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..." colspan="12" col="10">
                        <filter string="3rd party Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="3rd party Employee" icon="terp-personal-" domain="[]" context="{'group_by': 'employee_id'}"/>
                        <filter string="3rd party Register" icon="terp-dolar" domain="[]" context="{'group_by': 'register_id'}"/>
                        <filter string="Account"  icon="terp-folder-green" context="{'group_by':'account_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Register Code" icon="terp-dolar_ok!" domain="[]" context="{'group_by': 'statement_id'}"/>
                    </group>
                    <newline/>
                </search>
            </field>
        </record>

    <!-- Bank Register Filter -->
        <record id="account.view_account_bank_statement_filter" model="ir.ui.view">
            <field name="name">account.cash.statement.select</field>
            <field name="model">account.bank.statement</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Bank Registers">
                    <group col="8" colspan="4">
                        <filter string="Draft" domain="[('state','=','draft')]" icon="terp-document-new" name="draft"/>
                        <filter string="Open" domain="[('state', '=', 'open')]" icon="terp-camera_test" name="open"/>
                        <filter string="Closed" domain="[('state','=','confirm')]" icon="terp-dialog-close" name="confirm"/>
                        <separator orientation="vertical"/>
                        <field name="date"/>
                        <field name="name"/>
                        <field name="journal_id" widget='selection' domain="[('type', '=', 'cash')]" />
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Journal" context="{'group_by': 'journal_id'}" icon="terp-folder-orange"/>
                        <filter string="State" context="{'group_by': 'state'}" icon="terp-stock_effects-object-colorize"/>
                        <separator orientation="vertical"/>
                        <filter string="Period" context="{'group_by': 'period_id'}" icon="terp-go-month"/>
                    </group>
                </search>
            </field>
        </record>

    <!-- Bank Register Tree -->
        <record id="account.view_bank_statement_tree" model="ir.ui.view">
            <field name="name">account.bank.statement.tree</field>
            <field name="model">account.bank.statement</field>
            <field name="type">tree</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <tree colors="red:balance_end_real!=balance_end and state=='draft';blue:state=='draft' 
                and (balance_end_real==balance_end);black:state=='confirm'" string="Register" hide_new_button="1" hide_delete_button="1">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="period_id"/>
                    <field name="journal_id"/>
                    <field name="balance_start"/>
                    <field name="balance_end" />
                    <field name="balance_end_real"/>
                    <field name="state"/>
                    <button name="button_open_bank" states="draft" string="Open Bank" type="object" icon="terp-gtk-go-back-rtl"/>
                    <button name="button_confirm_bank" states="open" string="Confirm" type="object"  icon="terp-camera_test"/>
                </tree>
            </field>
        </record>

    <!-- Cash Statement Tree -->
        <record id="view_cash_statement_tree" model="ir.ui.view">
            <field name="name">account.bank.statement.tree</field>
            <field name="model">account.bank.statement</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="red:balance_end_real!=balance_end;blue:state=='draft' and (balance_end_real==balance_end);black:state in ('open')" 
                string="Register" hide_new_button="1" hide_delete_button="1">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="period_id"/>
                    <field name="journal_id"/>
                    <field name="balance_start"/>
                    <field name="balance_end"/>
                    <field name="balance_end_real"/>
                    <field name="state"/>
                    <button type="object" string="Open" name="button_open_cash" states="draft" icon="terp-gtk-go-back-rtl"/>
                    <button type="object" string="Confirm" name="button_confirm_cash" states="open" icon="terp-camera_test"/>
                </tree>
            </field>
        </record>

    <!-- Bank Register Search Form -->
        <record id="view_bank_statement_search" model="ir.ui.view">
            <field name="name">account.bank.statement.search</field>
            <field name="model">account.bank.statement</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Bank Registers">
                    <group col="8" colspan="4">
                        <filter string="Draft" domain="[('state','=','draft')]" icon="terp-document-new" name="draft"/>
                        <filter string="Open" domain="[('state', '=', 'open')]" icon="terp-camera_test" name="open"/>
                        <filter string="Closed" domain="[('state','=','confirm')]" icon="terp-dialog-close" name="confirm"/>
                        <separator orientation="vertical"/>
                        <field name="name"/>
                        <field name="date"/>
                        <field name="period_id"/>
                        <field name="journal_id" widget="selection" domain="[('type', '=', 'bank')]" />
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Journal" context="{'group_by': 'journal_id'}" icon="terp-folder-orange"/>
                        <filter string="State" context="{'group_by': 'state'}" icon="terp-stock_effects-object-colorize"/>
                        <separator orientation="vertical"/>
                        <filter string="Period" context="{'group_by': 'period_id'}" icon="terp-go-month"/>
                    </group>
                </search>
            </field>
        </record>

    <!--Bank Register modification to change "Bank Statement" into "Bank Register" -->

        <record id="account.action_bank_statement_tree" model="ir.actions.act_window">
            <field name="name">Bank Registers</field>
            <field name="res_model">account.bank.statement</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="domain">[('journal_id.type', '=', 'bank')]</field>
            <field name="context">{'journal_type':'bank', 'search_default_open': 1}</field>
            <field name="search_view_id" ref="view_bank_statement_search"/>
            <field name="help">A bank register is a summary of all financial transactions occurring over a given period of time on a deposit account, 
                a credit card or any other type of financial account. The starting balance will be proposed automatically and the closing balance is 
                to be found on your statement. When you are in the Payment column of a line, you can press F1 to open the reconciliation form.
            </field>
        </record>

        <record id="action_bank_statement_periodic_tree" model="ir.actions.act_window">
            <field name="name">Bank Registers</field>
            <field name="res_model">account.bank.statement</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="domain">[('journal_id.type', '=', 'bank')]</field>
            <field name="search_view_id" ref="view_bank_statement_search"/>
            <field name="context">{'journal_type':'bank'}</field>
        </record>

        <act_window
           id="act_account_journal_2_account_bank_statement"
           name="Bank registers"
           context="{'search_default_journal_id':active_id}"
           res_model="account.bank.statement"
           src_model="account.journal"/>

    <!-- Cash Register context modification to display only open cash register by default -->

        <record id="account.action_view_bank_statement_tree" model="ir.actions.act_window">
            <field name="name">Cash Registers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.bank.statement</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="view_id" ref="view_cash_statement_tree"/>
            <field name="search_view_id" ref="account.view_account_bank_statement_filter"/>
            <field name="domain">[('journal_id.type', '=', 'cash')]</field>
            <field name="context">{'journal_type':'cash', 'search_default_open': 1}</field>
            <field name="help">A Cash Register allows you to manage cash entries in your cash journals. This feature provides an easy way to follow up cash payments on a daily basis. You can enter the coins that are in your cash box, and then post entries when money comes in or goes out of the cash box.</field>
        </record>

    <!-- Modification to display bank_statement_tree -->

        <record model="ir.actions.act_window.view" id="account.act_cash_statement1_all">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_cash_statement_tree"/>
            <field name="act_window_id" ref="account.action_view_bank_statement_tree"/>
        </record>

        <record model="ir.actions.act_window.view" id="account.act_cash_statement2_all">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="account.view_bank_statement_form2"/>
            <field name="act_window_id" ref="account.action_view_bank_statement_tree"/>
        </record>
        <record model="ir.actions.act_window.view" id="account.act_cash_statement3_all">
            <field name="sequence" eval="30"/>
            <field name="view_mode">graph</field>
            <field name="view_id" ref="account.account_cash_statement_graph"/>
            <field name="act_window_id" ref="account.action_view_bank_statement_tree"/>
        </record>

        <menuitem string="Bank Registers" action="account.action_bank_statement_tree" id="account.menu_bank_statement_tree" parent="account.menu_finance_bank_and_cash" sequence="7"/>

    <!-- Cheque Register View -->
        <record id="view_cheque_register_form" model="ir.ui.view">
            <field name='name'>view.cheque.register.form</field>
            <field name='model'>account.bank.statement</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Cheque Register" hide_new_button="1" hide_delete_button="1">
                    <group col="7" colspan="4">
                        <field name="name" select="1" readonly="0" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        <field name="code" />
                        <field name="journal_id" domain="[('type', '=', 'cheque')]" on_change="onchange_journal_id(journal_id)" select="1"/>
                        <newline/>
                        <field name="date" select="1" on_change="onchange_date(date)"/>
                        <field name="period_id" readonly="1" domain="[('state', '=', 'draft')]"/>
                        <field name="journal_name"/>
                        
                        <field name="currency" invisible="1"/>
                        <field name='company_id' widget="selection" groups="base.group_multi_company" invisible="1"/>
                        <field name="virtual_id" invisible="1" readonly="1"/>
                    </group>
                    <group col="2" colspan="4">
                        <button name="button_wiz_temp_posting" states="open" string="Temp Posting" type="object" icon="terp-gtk-jump-to-ltr" 
                            context="context"/>
                        <button name="button_wiz_hard_posting" states="open" string="Hard Posting" type="object" icon="terp-camera_test" 
                            context="context"/>
                        <button name="button_create_invoice" states="open" string="Direct Invoice" type="object" icon="terp-document-new" />
                        <button name="button_wiz_import_invoices" states="open" string="Import Invoices" type="object" icon="gtk-save"/>
                    </group>
                    <group col="4" colspan="4">
                        <button name="button_open_advances" string="List of Open Advances" type="object" icon="gtk-justify-fill" colspan="2"/>
                        <label string="" colspan="4"/>
                    </group>
                    <group col="4" colspan="2">
                        <field name="display_type"/>
                        <button name="button_display_type" states="open,confirm" string="Apply display type" type="object" icon="terp-stock_zoom" 
                            context="context" colspan="2"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Transaction" name="statement_line_ids">
                            <field colspan="4" name="line_ids" nolabel="1">
                                <tree editable="bottom" string="Statement lines" noteditable="state=='hard'" colors="red:display_analytic_button and not analytic_distribution_id">
                                    <button name="button_duplicate" string="Duplicate" type="object" icon="gtk-copy" />
                                    <field name="date" string="Posting Date"/>
                                    <field name="document_date"/>
                                    <field name="cheque_number" required="1"/>
                                    <field name="sequence_for_reference"/>
                                    <field name="name" string="Description"/>
                                    <field name="partner_type_mandatory" invisible="1"/>
                                    <field name="ref"/>
                                    <field domain="[('journal_id','=',parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id" 
                                        on_change="onchange_account(account_id, parent.virtual_id)" attrs="{'readonly': [('number_imported_invoice', '>', 0)]}"/>
                                    <field name="partner_type"
                                            attrs="{'required': [('partner_type_mandatory', '=', True)], 'readonly': [('number_imported_invoice', '>', 0)]}"
                                            domain="[('filter_for_third_party', '=', account_id)]"
                                            context="{'curr': parent.currency}"
                                        />
                                    <field name="display_analytic_button" invisible="1"/>
                                    <field name="analytic_distribution_id" invisible="1"/>
                                    <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" 
                                            context="context" attrs="{'invisible': [('display_analytic_button', '=', False)]}"/>
                                    <field name="amount" invisible="1"/>
                                    <field name="amount_in" readonly="0"/>
                                    <field name="amount_out" readonly="0"/>
                                    <field name="direct_invoice" invisible="1"/>
                                    <field name="invoice_id" invisible="1"/>
                                    <field name="number_imported_invoice"  invisible="1"/>
                                    <button name="button_open_invoice" attrs="{'invisible': [('invoice_id', '=', False)]}" 
                                        string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                    <button name="button_open_invoices" attrs="{'invisible': [('number_imported_invoice', '=', 0)]}" 
                                        string="Open invoices" type="object" icon="gtk-index" context="context"/>
                                    <field name="reconciled"/>
                                    <button name="button_temp_posting" states="draft" string="Temp" type="object" icon="terp-gtk-jump-to-ltr" 
                                        context="context"/>
                                    <button name="button_hard_posting" states="draft,temp" string="Hard" type="object" icon="terp-camera_test" 
                                        context="context"/>
                                    <field name="state" readonly="True"/>
                                </tree>
                                <form string="Statement lines">
                                    <field name="date" string="Posting Date"/>
                                    <field name="document_date"/>
                                    <field name="cheque_number" required="1"/>
                                    <field name="sequence" invisible="1"/>
                                    <field name="sequence_for_reference"/>
                                    <field name="name" string="Description"/>
                                    <field name="partner_type_mandatory" invisible="1"/>
                                    <field name="ref"/>
                                    <field domain="[('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id"
                                        on_change="onchange_account(account_id, parent.virtual_id)" attrs="{'readonly': [('number_imported_invoice', '>', 0)]}"/>
                                    <field name="partner_type"
                                        attrs="{'required': [('partner_type_mandatory', '=', True)], 'readonly': [('number_imported_invoice', '>', 0)]}"
                                        domain="[('filter_for_third_party', '=', account_id)]" 
                                        context="{'curr': parent.currency}" 
                                        />
                                    <field name="display_analytic_button" invisible="1"/>
                                    <field name="analytic_distribution_id" invisible="1"/>
                                    <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" 
                                            context="context" attrs="{'invisible': [('display_analytic_button', '=', False)]}"/>
                                    <field name="amount" invisible="1"/>
                                    <field name="amount_in" readonly="0"/>
                                    <field name="amount_out" readonly="0"/>
                                    <field name="direct_invoice" invisible="1"/>
                                    <field name="invoice_id" invisible="1"/>
                                    <button name="button_open_invoice" attrs="{'invisible': [('invoice_id', '=', False)]}" 
                                            string="Open invoice" type="object" icon="gtk-index" context="context"/>
                                    <field name="number_imported_invoice"  invisible="1"/>
                                    <field name="reconciled"/>
                                    <field name="state" readonly="True"/>
                                    <separator colspan="4" string="Notes"/>
                                    <field colspan="4" name="note" nolabel="1"/>
                                </form>
                            </field>
                        </page>
                    </notebook>
                    <group col="8" colspan="4">
                        <field name="state" readonly="1"/>
                        <field name="balance_end" readonly="1"/>
                        <button name="button_open_cheque" states="draft" string="Open Cheque Register" type="object" icon="gtk-go-forward"/>
                        <button name="button_confirm_cheque" states="open" string="Confirm" type="object" icon="terp-camera_test"/>
                    </group>
                </form>
            </field>
        </record>

    <!-- Cheque Register Tree -->
        <record id="view_cheque_register_tree" model="ir.ui.view">
            <field name="name">account.cheque.register.tree</field>
            <field name="model">account.bank.statement</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="red:balance_end_real!=balance_end and state=='draft';blue:state=='draft';black:state=='confirm'" 
                    string="Register" hide_new_button="1" hide_delete_button="1">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="period_id"/>
                    <field name="journal_id"/>
                    <field name="balance_end" />
                    <field name="state"/>
                    <button name="button_open_cheque" states="draft" string="Open Cheque Register" type="object" icon="terp-gtk-go-back-rtl"/>
                    <button name="button_confirm_cheque" states="open" string="Confirm" type="object"  icon="terp-camera_test"/>
                </tree>
            </field>
        </record>

    <!-- Cheque Register Search Form -->
        <record id="view_cheque_register_search" model="ir.ui.view">
            <field name="name">account.cheque.register.search</field>
            <field name="model">account.bank.statement</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Cheque Registers">
                    <group col="8" colspan="4">
                        <filter string="Draft" domain="[('state','=','draft')]" icon="terp-document-new" name="draft"/>
                        <filter string="Open" domain="[('state', '=', 'open')]" icon="terp-camera_test" name="open"/>
                        <filter string="Closed" domain="[('state','=','confirm')]" icon="terp-dialog-close" name="confirm"/>
                        <separator orientation="vertical"/>
                        <field name="name"/>
                        <field name="date"/>
                        <field name="period_id"/>
                        <field name="journal_id" widget="selection" domain="[('type', '=', 'cheque')]" />
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Journal" context="{'group_by': 'journal_id'}" icon="terp-folder-orange"/>
                        <filter string="State" context="{'group_by': 'state'}" icon="terp-stock_effects-object-colorize"/>
                        <separator orientation="vertical"/>
                        <filter string="Period" context="{'group_by': 'period_id'}" icon="terp-go-month"/>
                    </group>
                </search>
            </field>
        </record>

    <!-- Cheque Register Actions -->
        <record id="action_cheque_register_tree" model="ir.actions.act_window">
            <field name="name">Cheque Registers</field>
            <field name="res_model">account.bank.statement</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('journal_id.type', '=', 'cheque')]</field>
            <field name="context">{'journal_type':'cheque', 'search_default_open': 1}</field>
            <field name="search_view_id" ref="view_cheque_register_search"/>
            <field name="help">A cheque register is a summary of all financial transactions occurring over a given period of time on a cheque account.
                 The starting balance will be proposed automatically and the closing balance is to be found on your statement.</field>
        </record>

        <record model="ir.actions.act_window.view" id="action_cheque_register_tree_cheque">
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_cheque_register_tree"/>
            <field name="act_window_id" ref="action_cheque_register_tree"/>
        </record>

        <record model="ir.actions.act_window.view" id="action_cheque_register_form_cheque">
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_cheque_register_form"/>
            <field name="act_window_id" ref="action_cheque_register_tree"/>
        </record>

    <!-- Cheque Register Menu -->
        <menuitem string="Cheque Registers" action="action_cheque_register_tree" id="menu_cash_register" 
            parent="account.menu_finance_bank_and_cash" sequence="7"/>

    <!-- Account View -->
        <record id="inherit_view_account_form" model="ir.ui.view">
            <field name='name'>inherit.view.account.form</field>
            <field name='model'>account.account</field>
            <field name="type">form</field>
            <field name='inherit_id' ref='account.view_account_form' />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='user_type']" position="after">
                    <field name="type_for_register"/>
                </xpath>
            </field>
        </record>

    <!-- Journal Items -->
        <record model="ir.ui.view" id="inherit_view_move_form">
            <field name="name">inherit.view.move.form</field>
            <field name="model">account.move</field>
            <field name="type">form</field>
            <field name='inherit_id' ref='account.view_move_form' />
            <field name="arch" type="xml">
                <data>
                    <xpath expr="/form/notebook/page/field[@name='line_id']/form/group/field[@name='partner_id']" position="replace">
                        <field name="partner_type" />
                        <field name="partner_type_mandatory" invisible="1"/>
                    </xpath>
                    <xpath expr="/form/notebook/page/field[@name='line_id']/tree/field[@name='account_id']" position="replace" />
                    <xpath expr="/form/notebook/page/field[@name='line_id']/tree/field[@name='partner_id']" position="replace">
                        <field name="account_id" domain="[('journal_id','=',parent.journal_id)]" on_change="onchange_account_id(account_id)"/>
                        <field name="partner_id" invisible="1"/>
                        <field name="partner_type" on_change="onchange_partner_type(partner_type, credit, debit)" 
                            attrs="{'required': [('partner_type_mandatory', '=', True)]}"
                            domain="[('filter_for_third_party', '=', account_id)]" 
                            context="{'curr': currency_id}"/>
                        <field name="partner_type_mandatory" invisible="1"/>
                    </xpath>
                </data>
            </field>
        </record>

    <!-- Journal Entries Tree -->
        <record model="ir.ui.view" id="inherit_view_move_tree">
            <field name="name">inherit.view.move.tree</field>
            <field name="model">account.move</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="account.view_move_tree" />
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='partner_id']" position="replace">
                    <field name="partner_id" invisible="1"/>
                    <field name="partner_type" />
                </xpath>
            </field>
        </record>

    <!-- Journal Entries Search (filter) -->
        <record model="ir.ui.view" id="inherit_view_account_move_filter">
            <field name="name">inherit.view.account.move.filter</field>
            <field name="model">account.move</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="account.view_account_move_filter" />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="replace">
                    <field name="partner_id" invisible="1"/>
                    <field name="partner_type"/>
                </xpath>
            </field>
        </record>

    <!-- UF-426: remove Journal Items in Cash and Bank -->
        <delete model="ir.ui.menu" id="account.menu_action_account_moves_bank"/>

    </data>
</openerp>
