-
  In order to test the behaviour of the mission stock report,
  we will create a mission stock report for an other instance
  and use the local instance.
-
    In order to test the mission stock module, we start by creating a new product category
-
  !record {model: product.category, id: product_cat1}:
    name: Categ1
-
  To do this, we need a product
-
  !record {model: product.product, id: product1}:
    categ_id: product_cat1
    cost_method: standard
    mes_type: fixed
    name: P1
    price_margin: 2.0
    procure_method: make_to_stock
    property_stock_inventory: stock.location_inventory
    property_stock_procurement: stock.location_procurement
    property_stock_production: stock.location_production
    seller_delay: '1'
    standard_price: 100.0
    supply_method: buy
    type: product
    uom_id: product.product_uom_unit
    uom_po_id: product.product_uom_unit
    volume : 0.0
    warranty: 0.0
    weight: 0.0
    weight_net: 0.0
    reviewed_consumption: 45
    seller_ids:
      - sequence: 10
        min_qty: 0.00
        name: supplier1
        delay: 12
      - sequence: 20
        min_qty: 0.00
        name: supplier2
        delay: 45
-
  We create also a new Unifield instance which is not a local instance
-
  !record {model: msf.instance, id: proj1}:
    level: project
    code: PROJ1
    mission: Mission Test
    instance: Proj. instance
    parent_id: msf_instance.instance_section
    name: Project 1
    cost_center_id: analytic_distribution.analytic_account_project
    state: active
-
  Activate the local instance
-
  !python {model: msf.instance}: |
    self.write(cr, uid, ref('msf_instance.instance_section'), {'state': 'active'})
-
  Create a mission report for the project instance
-
  !record {model: stock.mission.report, id: report_proj}:
    name: Project report
    instance_id: proj1
    full_view: False
    last_update: time.strftime('%Y-%m-%d')
    report_line:
      product_id: product1
      internal_qty: 100.00
      internal_val: 9000.00
      stock_qty: 55.00
      stock_val: 4950.00
      central_qty: 45.00
      central_val: 4050.00
      cross_qty: 0.00
      cross_val: 0.00
      secondary_qty: 0.00
      secondary_val: 0.00
      cu_qty: 0.00
      cu_val: 0.00
-
  Create some configurable locations
-
  !python {model: stock.location.configuration.wizard}: |
    eprep_id = self.create(cr, uid, {'location_name': 'EPREP',
                                     'location_usage': 'eprep',})
    is1_id = self.create(cr, uid, {'location_name': 'IS1',
                                   'location_usage': 'stock',})
    is2_id = self.create(cr, uid, {'location_name': 'IS2',
                                   'location_usage': 'stock',})
    cu1_id = self.create(cr, uid, {'location_name': 'CU1',
                                   'location_usage': 'consumption_unit',
                                   'location_type': 'internal'})
    cu2_id = self.create(cr, uid, {'location_name': 'CU2',
                                   'location_usage': 'consumption_unit',
                                   'location_type': 'internal'})
    cu3_id = self.create(cr, uid, {'location_name': 'CU3',
                                   'location_usage': 'consumption_unit',,
                                   'location_type': 'external'})
    self.confirm_creation(cr, uid, [eprep_id, is1_id, is2_id, cu1_id, cu2_id], cu3_id)
-
  Create an inventory for the local instance
-
  !record {model: stock.inventory, id: local_inv}:
    name: Local inventory
    date: !eval time.strftime('%Y-%m-%d')
    inventory_line_id:
      - location_id: msf_cross_docking.stock_location_input
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 23
      - location_id: msf_cross_docking.stock_location_cross_docking
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 12
      - location_id: stock.stock_location_output
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 54
      - location_id: msf_outgoing.stock_location_packing
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 23
      - location_id: msf_outgoing.stock_location_dispatch
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 12
      - location_id: msf_outgoing.stock_location_distribution
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 7
      - location_id: stock.stock_location_stock
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 28
      - location_id: msf_config_locations.stock_location_medical
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 56
      - location_id: msf_config_locations.stock_location_unallocated_medical
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 64
      - location_id: msf_config_locations.stock_location_logistic
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 11
      - location_id: msf_config_locations.stock_location_unallocated_logistic
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 8
      - location_id: msf_config_locations.stock_location_quarantine_scrap
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 2
      - location_id: msf_config_locations.stock_location_quarantine_analyze
        product_uom: product.product_uom_unit
        product_id: product1
        product_qty: 5
-
  Add some lines in the inventory for configurable locations
-
  !python {model: stock.location}: |
    eprep_id = self.search(cr, uid, [('name', '=', 'EPREP')])
    assert eprep_id, 'No EPREP location found'
    is1_id = self.search(cr, uid, [('name', '=', 'IS1')])
    assert is1_id, 'No IS1 location found'
    is2_id = self.search(cr, uid, [('name', '=', 'US2')])
    assert is2_id, 'No IS2 location found'
    cu1_id = self.search(cr, uid, [('name', '=', 'CU1')])
    assert cu1_id, 'No CU1 location found'
    cu2_id = self.search(cr, uid, [('name', '=', 'CU2')])
    assert cu2_id, 'No CU2 location found'
    cu3_id = self.search(cr, uid, [('name', '=', 'CU3')])
    assert cu3_id, 'No CU3 location found'
    
    line_obj = self.pool.get('stock.inventory.line')
    line_obj.create(cr, uid, {'location_id': eprep_id[0],
                              'inventory_id': ref('local_inv'),
                              'product_uom': ref('product.product_uom_unit'),
                              'product_id': ref('product1'),
                              'product_qty': 30})
    line_obj.create(cr, uid, {'location_id': is1_id[0],
                              'inventory_id': ref('local_inv'),
                              'product_uom': ref('product.product_uom_unit'),
                              'product_id': ref('product1'),
                              'product_qty': 24})
    line_obj.create(cr, uid, {'location_id': is2_id[0],
                              'inventory_id': ref('local_inv'),
                              'product_uom': ref('product.product_uom_unit'),
                              'product_id': ref('product1'),
                              'product_qty': 23})
    line_obj.create(cr, uid, {'location_id': cu1_id[0],
                              'inventory_id': ref('local_inv'),
                              'product_uom': ref('product.product_uom_unit'),
                              'product_id': ref('product1'),
                              'product_qty': 52})
    line_obj.create(cr, uid, {'location_id': cu2_id[0],
                              'inventory_id': ref('local_inv'),
                              'product_uom': ref('product.product_uom_unit'),
                              'product_id': ref('product1'),
                              'product_qty': 64})
-
  We confirm the inventory
-
  !python {model: stock.inventory}: |
    self.action_confirm(cr, uid, [ref('local_inv')], context=context)
    self.action_done(cr, uid, [ref('local_inv')], context=context)