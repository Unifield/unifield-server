<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        
    <!-- We move the buttons below the notebook -->
        <record id="msf_cross_docking.purchase_move_buttons" model="ir.ui.view">
            <field name="name">purchase.form.view</field>
            <field name="model">purchase.order</field>
            <field name="type">form</field>
            <field name="priority">3002</field>
            <field name="inherit_id" ref="purchase.purchase_order_form" />
            <field name="arch" type="xml">
                <data>
                    <xpath expr="/form" position="attributes">
                        <attribute name='hide_delete_button'>1</attribute>
                    </xpath>
                    <xpath expr="/form/notebook/page/group[2]" position="replace">
                    </xpath>
                    <xpath expr="/form/notebook/page[@string='Purchase Order']/group[2]" position="replace" >
                    </xpath>
                    <!-- We change the positions of the supplier information fields -->
                    <xpath expr="/form//field[@name='internal_type']" position="replace" >
                    </xpath>
                    <xpath expr="/form//field[@name='partner_id']" position="replace" >
                    </xpath>
                    <xpath expr="/form//field[@name='partner_address_id']" position="replace" >
                    </xpath>
                    <xpath expr="/form//field[@name='partner_type']" position="replace" >
                    </xpath>
                    <xpath expr="/form//field[@name='origin']" position="replace" >
                    </xpath>
                    <xpath expr="/form//field[@name='pricelist_id']" position="replace" >
                    </xpath>
                    <xpath expr="/form//group[@name='import']" position="before" >
                        <group colspan="4" col="12">
                            <field name="partner_id" on_change="onchange_partner_id(partner_id)" context="{'search_default_supplier':1}" domain="[('id', '!=', company_id)]" 
                            colspan="3" attrs="{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'confirmed_wait', 'approved', 'except_picking', 'except_invoice'])]}"/>
                            <field name="partner_type" colspan="3" />
                            <field name="internal_type" string="Zone" colspan="3" />
                            <field name="partner_address_id" colspan="3" attrs="{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'confirmed_wait', 'approved', 'except_picking', 'except_invoice'])]}"/>
                            <field name="pricelist_id" string="Currency" colspan="3" attrs="{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'confirmed_wait', 'approved', 'except_picking', 'except_invoice'])]}"/>
                            <field name="origin" colspan="3" attrs="{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'confirmed_wait', 'approved', 'except_picking', 'except_invoice'])]}"/>
                        </group>
                    </xpath>
                    <xpath expr="/form/notebook" position="after">
                        <group col="11" colspan="4">
                            <group colspan="12" col="19" attrs="{'invisible': ['|', '|', ('rfq_ok', '=', True), ('categ', '=', 'transport'), ('display_intl_transport_ok', '=', False)]}">
                                <field name="display_intl_transport_ok" invisible="1"/>
                                <field name="intl_supplier_ok" invisible="1"/>
                                <field name="transport_mode"
                                    attrs="{'invisible': [('display_intl_transport_ok', '=', False)], 'readonly': [('shipped_rate', '!=', 0.00)]}"
                                    />
                                <label colspan="15"/>
                                <field name="transport_cost" 
                                    attrs="{'invisible': [('display_intl_transport_ok', '=', False)], 'required': [('rfq_ok', '=', False), ('intl_supplier_ok', '=', True)], 'readonly': [('shipped_rate', '!=', 0.00)]}" 
                                    nolabel="1"
                                    />
                                <field name="transport_currency_id" domain="[('is_po_functional', '=', pricelist_id)]" attrs="{'invisible': [('display_intl_transport_ok', '=', False)], 'required': [('rfq_ok', '=', False), ('intl_supplier_ok', '=', True)],'readonly': [('shipped_rate', '!=', 0.00)]}" nolabel="1"/>
                                <separator colspan="19" attrs="{'invisible': [('display_intl_transport_ok', '=', False)]}"/>
                            </group>
                                <field name="currency_id" readonly="1"/>
                                <field name="amount_untaxed" sum="Untaxed amount"/>
                                <field name="amount_tax"/>
                                <field name="amount_total" sum="Total amount"/>
                                <newline/>
                                <field name="functional_currency_id" readonly="1"/>
                                <field name="functional_amount_untaxed"/>
                                <field name="functional_amount_tax"/>
                                <field name="functional_amount_total"/>
                                <newline/>
                                <field name="total_price_include_transport" readonly="1" attrs="{'invisible': ['|', '|', ('rfq_ok', '=', True), ('categ', '=', 'transport'), ('display_intl_transport_ok', '=', False)]}"/>
                                <newline/>
                                <field name="func_total_price_include_transport" readonly="1" attrs="{'invisible': ['|', '|', ('rfq_ok', '=', True), ('categ', '=', 'transport'), ('display_intl_transport_ok', '=', False)]}"/>
                        </group>
                        <newline/>

                        <group colspan="4" col="14">
                            <field name="state" readonly="1"/>
                            <button name="dpo_received" string="Validate the reception" icon="terp-camera_test"
                                attrs="{'invisible': ['|', ('state', '!=', 'approved'), ('order_type', '!=', 'direct')]}" />
                            <button name="purchase_cancel" states="draft,confirmed,wait_auth,rfq_sent" string="Cancel" icon="gtk-cancel"/>
                            <button name="action_cancel_draft" states="cancel" string="Set to Draft" type="object" icon="gtk-convert" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'cancel')]}" />
                            <button name="action_cancel" states="approved,except_picking,except_invoice,wait" string="Cancel Purchase Order" type="object" icon="gtk-cancel"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state','not in', ['approved','except_picking','except_invoice','wait'])]}"/>
                            <button name="picking_ok" states="except_picking" string="Manually Corrected" icon="gtk-convert"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'except_picking')]}"/>
                            <button name="invoice_ok" states="except_invoice" string="Manually Corrected" icon="gtk-convert"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'except_invoice')]}"/>
                            <button name="purchase_appbuyer" states="wait_auth" string="Approve Purchase" icon="gtk-ok" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'wait_auth')]}"/>
                            <button name="purchase_approve" states="confirmed" string="Confirm" icon="gtk-go-forward" type="object" />
                            <button name="purchase_confirm" states="draft" string="Validate" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '!=', False), ('state', '!=', 'draft')]}" />
                            <button name="rfq_sent" type="object" states="draft" string="Send RfQ" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '=', False), ('state', '!=', 'draft')]}" />
                            <button name="check_rfq_updated" type="object" states="rfq_sent" string="RfQ Updated" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '=', False), ('state', '!=', 'rfq_sent')]}" />
                            <button name="rfq_done" states="rfq_updated" string="RfQ Closed" icon="gtk-go-forward" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'rfq_updated')]}" />
                        </group>
                    </xpath>
                </data>
            </field>
        </record>
        
        <record id="purchase_order_tree" model="ir.ui.view">
            <field name="name">purchase.order.type.tree.view</field>
            <field name="model">purchase.order</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="purchase.purchase_order_tree" />
            <field name="arch" type="xml">
                <data>
                    <xpath expr="/tree" position="attributes">
                        <attribute name='hide_delete_button'>1</attribute>
                    </xpath>
                </data>
            </field>
        </record>
        
    </data>
</openerp>
