-
   Creating a service location
-
  !record {model: stock.location, id: location_service}:
    name: Test Service
    location_category: other
    usage: view
    service_location: True
- 
  Creating a res.partner record
- 
  !record {model: res.partner, id: res_partner_a0}:
    credit_limit: 0.0
    debit_limit: 0.0
    name: A
    supplier: true
    
- 
  Creating a res.partner.address record
- 
  !record {model: res.partner.address, id: res_partner_address_0}:
    partner_id: res_partner_a0
    street: A

-
  Creating a product.product record service with reception
- 
  !record {model: product.product, id: product_service_p0}:
    default_code: P0
    name: product 0 test
    type: service
    
- 
  Creating a product.product record service with reception
- 
  !record {model: product.product, id: product_service_recep_p1}:
    default_code: P0
    name: product 0 test
    type: service_recep
    procure_method: make_to_order
    
- 
  Creating a product.product record stockable
- 
  !record {model: product.product, id: product_stockable_p2}:
    default_code: P1
    name: product 1 test
    type: product
  
    
- 
  2. I create a stock picking outgoing. I then create a stock move with a
  service with reception product. An exception is raised.
  
  Creating a stock.picking record
-
  !record {model: stock.picking, id: stock_picking_2}:
    name: test OUT
    type: out

-
  Creating a stock.move record
- 
  !record {model: stock.move, id: stock_move_2}:
    name: test stock move
    product_id: product_stockable_p2
    product_uom: product.product_uom_unit
    location_dest_id: stock.stock_location_stock
    location_id: stock.stock_location_stock
    picking_id: stock_picking_2

-
  Change the source location to Service location
-
  !python {model: stock.move}: |
    from osv import osv
    service_location = self.pool.get('stock.location').search(cr, uid, [('service_location', '=', True)], context=context)
    assert service_location, 'No Service Location available'
    service_location = service_location[0]
    
    # try on_change function
    self.onchange_product_id(cr, uid, [ref("stock_move_2")], prod_id=ref("product_service_p0"), loc_id=False, loc_dest_id=False, address_id=False)
    
    try:
      self.write(cr, uid, ref("stock_move_2"), {'location_dest_id': service_location, 'product_id': ref("product_service_recep_p1")}, context=context)
    except osv.except_osv, e:
      # ok the constraint has been raised
      #print e
      pass
    else:
      assert False, 'The constraint: "Only Incoming Shipment can manipulate Service Products." has not been triggered.'
    
