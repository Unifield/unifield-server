<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
	
        <record id="tender_form" model="ir.ui.view">
            <field name="name">tender.form</field>
            <field name="model">tender</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Tender">
                    <group col="6" colspan="4">
                    	<field name="creator" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                    	<field name="creation_date" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                    	<field name="requested_date" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="name" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="sale_order_id" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="warehouse_id" widget="selection" on_change="onchange_warehouse(warehouse_id)" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="location_id" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="company_id" invisible="True" />
                        <field name="categ" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="priority" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="details" />
                    </group>
                    <notebook colspan="5">
                        <page string="Tender Lines">
                            <field colspan="4" mode="tree,form,graph" name="tender_line_ids" nolabel="1" widget="one2many_list">
                                <tree string="Tender Lines" editable="top">
                                	<!-- <field name="date_planned" /> -->
                                    <field name="product_id" on_change="on_product_change(product_id)" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                                    <field name="qty" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                                    <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                                    <field name="supplier_id" />
                                    <field name="price_unit" />
                                    <field name="total_price" />
                                    <field name="purchase_order_id" />
                                    <field name="purchase_order_line_number" />
                                    <field name="state" invisible="1" />
                                </tree>
                            </field>
                            <newline/>
                            <group col="13" colspan="10">
                            </group>
                        </page>
                        <page string="Suppliers">
                        	<field colspan="4" mode="tree,form,graph" name="supplier_ids" nolabel="1" attrs="{'readonly': [('state', '!=', 'draft')]}" >
                                <tree string="Suppliers">
                                    <field name="name" />
                                    <field name="partner_type" />
                                    <field name="city" />
                                    <field name="country" />
                                </tree>
                            </field>
                        </page>
                        <page string="RfQs">
                        	<field colspan="4" mode="tree,form,graph" name="rfq_ids" nolabel="1" attrs="{'readonly': [('state', '!=', 'draft')]}" >
                                <tree string="RfQs">
                                    <field name="name" />
                                    <field name="state" />
                                </tree>
                            </field>
                        </page>
                        <page string="Notes">
                        	<field name="notes" nolabel="1" />
                        </page>
                    </notebook>
                    <group col="13" colspan="4">
                        <field name="state" />
                        <field name="internal_state" invisible="True"/>
                        <button name="tender_cancel" string="Cancel" icon="gtk-cancel" attrs="{'invisible':['|', ('sale_order_id','!=', False), ('state', 'in', ('cancel', 'done',)),],}" />
                        <button name="button_generate" states="draft" string="Generate RfQs" icon="gtk-convert" />
                        <button name="compare_rfqs" states="comparison" string="Compare RfQs" type="object" icon="gtk-find" />
                        <button name="update_supplier_info" states="comparison" string="Update Product's Suppliers" type="object" icon="gtk-edit" 
                            attrs="{'invisible':['|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'),],}" />
                        <button name="button_done" states="comparison" string="Continue Sourcing Process" icon="gtk-go-forward" 
                            attrs="{'invisible':['|', '|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'), ('sale_order_id','=', False),],}" />
                        <button name="create_po" states="comparison" string="Create PO" type="object" icon="gtk-add" 
                            attrs="{'invisible':['|', '|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'), ('sale_order_id','!=', False),],}" />
                        <button name="done" string="Done" type="object" icon="gtk-go-forward" 
                            attrs="{'invisible':['|', '|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'), ('sale_order_id','!=', False),],}" />
                    </group>
                </form>
            </field>
        </record>
        
        <record id="tender_tree" model="ir.ui.view">
            <field name="name">tender.tree</field>
            <field name="model">tender</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Tender">
                    <field name="name" />
                    <field name="priority" />
                    <field name="categ" />
                    <field name="creation_date" />
                    <field name="requested_date" />
                    <field name="sale_order_id" />
                    <field name="state" />
                </tree>
            </field>
        </record>
	
		<record id="tender_search_form_view" model="ir.ui.view">
			<field name="name">tender.search.form</field>
			<field name="model">tender</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Tender">
					<filter name="draft" icon="gtk-file" string="Draft"
                            domain="[('state', '=', 'draft'),]" />
                    <filter name="comparison" icon="gtk-sort-descending" string="Comparison"
                            domain="[('state', '=', 'comparison'),]" />
                    <filter name="done" icon="gtk-apply" string="Done"
                            domain="[('state', '=', 'done'),]" />
                    <filter name="cancel" icon="gtk-cancel" string="Cancelled"
                            domain="[('state', '=', 'cancel'),]" />
					<field name="name" />
                    <field name="supplier_ids" string="Supplier" widget="many2one" />
                    <field name="product_id" string="Product" widget="many2one" />
					<field name="sale_order_id" string="Sale Order" />
                    <field name="creator" />
                    <field name="creation_date" />
					<newline />
                    <group string="Priority" expand="0">
                      <filter icon="gtk-dialog-warning" string="Emergency" domain="[('priority','=','emergency')]"/>
                      <filter icon="gtk-yes" string="Normal" domain="[('priority','=','normal')]"/>
                      <filter icon="gtk-info" string="Medium" domain="[('priority','=','priority')]"/>
                    </group>
                    
                    <newline />
                
                    <group string="Category" expand="0">
                      <filter icon="gtk-color-picker" string="Medical" domain="[('categ','=','medical')]"/>
                      <filter icon="terp-stock" string="Logistic" domain="[('categ','=','log')]"/>
                      <filter icon="terp-purchase" string="Service" domain="[('categ','=','service')]"/>
                      <filter icon="gtk-harddisk" string="Other" domain="[('categ','=','other')]"/>
                    </group> 
                    
                    <newline />
					
                    <group expand="0" string="Group By..." colspan="11" col="11" 
                           groups="base.group_extended">
                        <filter string="Priority" icon="terp-project" domain="[]" context="{'group_by': 'priority'}" />
                        <separator orientation="vertical" />
                        <filter string="Category" icon="terp-translate" domain="[]" context="{'group_by':'categ'}"/>
                        <separator orientation="vertical" />
                        <filter string="Sale Order" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'sale_order_id'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical" />
                        <filter string="Order Date" icon="terp-go-month" domain="[]" context="{'group_by':'creation_date'}"/>
                        <filter string="Expected Date" icon="terp-go-month" domain="[]" context="{'group_by':'requested_date'}" />
					</group>
				</search>
			</field>
		</record>

		<record id="tender_action" model="ir.actions.act_window">
			<field name="name">Tenders</field>
			<field name="res_model">tender</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[]</field>
			<field name="search_view_id" ref="tender_search_form_view" />
		</record>

		<menuitem icon="STOCK_INDENT" action="tender_action"
			id="menu_tender" parent="purchase.menu_procurement_management" sequence="3" />
			
        <record id="purchase_order_form" model="ir.ui.view">
            <field name="name">purchase.order.form</field>
            <field name="model">purchase.order</field>
            <field name="type">form</field>
            <field name="priority">300</field>
            <field name="inherit_id" ref="purchase.purchase_order_form" />
            <field name="arch" type="xml">
                <data>
                    <field name="details" position="after">
                        <field name="tender_id" attrs="{'invisible': [('rfq_ok', '=', False)],'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}" />
                        <field name="valid_till" attrs="{'invisible': [('rfq_ok', '=', False)],'readonly': [('state', 'in', ['rfq_updated', 'draft', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}" />
                        <field name="rfq_ok" invisible="1" />
                    </field>

                    <xpath expr="/form//field[@name='date_order']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='warehouse_id']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='partner_ref']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='order_type']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='priority']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='categ']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='name']" position="attributes">
                        <attribute name="readonly">True</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='invoiced']" position="attributes">
                        <attribute name="readonly">True</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='shipped']" position="attributes">
                        <attribute name="readonly">True</attribute>
                    </xpath>
                    <xpath expr="/form/notebook//field[@name='partner_id']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form/notebook//field[@name='partner_address_id']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form/notebook//field[@name='pricelist_id']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form/notebook//field[@name='origin']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_sent', 'rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form/notebook//field[@name='order_line']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='fiscal_position']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form//field[@name='location_id']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>
                    <xpath expr="/form/notebook/page[@string='Delivery &amp; Invoicing']//field[@name='invoice_method']" position="attributes">
                        <attribute name="attrs">{'readonly': [('state', 'in', ['rfq_updated', 'done', 'cancel', 'confirmed', 'approved', 'except_picking', 'except_invoice'])]}</attribute>
                    </xpath>

                    <xpath expr="/form/notebook/page/group[2]" position="replace">
                        <group colspan="4" col="13">
                            <field name="state" readonly="1"/>
                            <button name="purchase_cancel" states="draft,confirmed,wait_auth,rfq_sent" string="Cancel" icon="gtk-cancel"/>
                            <button name="action_cancel_draft" states="cancel" string="Set to Draft" type="object" icon="gtk-convert" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'cancel')]}" />
                            <button name="action_cancel" states="approved,except_picking,except_invoice,wait" string="Cancel Purchase Order" type="object" icon="gtk-cancel"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state','not in', ['approved','except_picking','except_invoice','wait'])]}"/>
                            <button name="picking_ok" states="except_picking" string="Manually Corrected" icon="gtk-convert"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'except_picking')]}"/>
                            <button name="invoice_ok" states="except_invoice" string="Manually Corrected" icon="gtk-convert"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'except_invoice')]}"/>
                            <button name="purchase_appbuyer" states="wait_auth" string="Approve Purchase" icon="gtk-ok" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'wait_auth')]}"/>
                            <button name="purchase_approve" states="confirmed" string="Confirm" icon="gtk-go-forward"  attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'confirmed')]}"/>
                            <button name="%(purchase.report_purchase_order)d" string="Print" states="approved" type="action" icon="gtk-print" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'approved')]}"/>
                            <button name="purchase_confirm" states="draft" string="Validate" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '!=', False), ('state', '!=', 'draft')]}" />
                            <button name="rfq_sent" type="object" states="draft" string="Send RfQ" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '=', False), ('state', '!=', 'draft')]}" />
                            <button name="check_rfq_updated" type="object" states="rfq_sent" string="RfQ Updated" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '=', False), ('state', '!=', 'rfq_sent')]}" />
                            <button name="rfq_done" states="rfq_updated" string="RfQ Done" icon="gtk-go-forward" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'rfq_updated')]}" />
                        </group>
                    </xpath>
                </data>
            </field>
        </record>

        <record id="rfq_form" model="ir.ui.view">
            <field name="name">rfq.form</field>
            <field name="model">purchase.order</field>
            <field name="type">form</field>
            <field name="priority">500</field>
            <field name="arch" type="xml">
                <form string="Request for Quotation">
                    <group col="6" colspan="4">
                        <field name="name" />
                        <field name="rfq_ok" invisible="1" />
                        <field name="date_order" string="Creation date"/>
                        <field name="invoiced"/>
                        <newline/>
                        <field name="warehouse_id" on_change="onchange_warehouse_id(warehouse_id)" widget="selection"/>
                        <field name="partner_ref"/>
                        <field name="shipped"/>
                        <!-- purchase_override > purchase_view.xml -->
                        <field name="order_type" on_change="onchange_internal_type(order_type, partner_id)" />
                        <field name="priority" />
                        <newline />
                        <field name="categ" />
                        <field name="loan_duration" attrs="{'invisible': [('order_type', '!=', 'loan')], 'required': [('order_type', '=', 'loan')]}" />
                        <field name="details" />
                        <field name="tender_id" />
            			<field name="valid_till" />
                        <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Purchase Order">
                            <field name="partner_id" on_change="onchange_partner_id(partner_id)" context="{'search_default_supplier':1}" domain="[('id', '!=', company_id)]" />
                            <field name="partner_address_id"/>
                            <field domain="[('type','=','purchase')]" name="pricelist_id" groups="base.group_extended"/>
                            <field name="origin" groups="base.group_extended"/>
                            <newline/>
                            <field colspan="4" name="order_line" nolabel="1" mode="tree,form">
                                <tree string="Purchase Order Lines">
                                    <field name="date_planned"/>
                                    <field name="name"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom"/>
                                    <field name="price_unit"/>
                                    <field name="price_subtotal"/>
                                </tree>
                                <!-- default form view -->
                            </field>
                            <group col="7" colspan="4">
                                <field name="amount_untaxed" sum="Untaxed amount"/>
                                <field name="amount_tax"/>
                                <field name="amount_total" sum="Total amount"/>
                                <button name="button_dummy" states="draft" string="Compute" type="object" icon="gtk-execute"/>
                            </group>
                            <group col="11" colspan="4">
                                <field name="state" readonly="1"/>
                                <button name="purchase_cancel" states="draft,confirmed,wait_auth" string="Cancel" icon="gtk-cancel"/>
                                <button name="action_cancel_draft" states="cancel" string="Set to Draft" type="object" icon="gtk-convert"/>
                                <button name="action_cancel" states="approved,except_picking,except_invoice,wait" string="Cancel Purchase Order" type="object" icon="gtk-cancel"/>
                                <button name="picking_ok" states="except_picking" string="Manually Corrected" icon="gtk-convert"/>
                                <button name="invoice_ok" states="except_invoice" string="Manually Corrected" icon="gtk-convert"/>
                                <button name="rfq_sent" states="draft" string="RfQ Sent" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '!=', True), ('state', '!=', 'draft'),],}" />
            					<button name="rfq_updated" states="draft" string="RfQ Updated" icon="gtk-go-forward" attrs="{'invisible': [('state', '!=', 'rfq_sent'),],}" />
                            </group>
                        </page>
                        <page string="Delivery &amp; Invoicing" groups="base.group_extended">
                            <group colspan="2" col="2">
                                <separator string="Delivery" colspan="2"/>
                                <field name="dest_address_id" on_change="onchange_dest_address_id(dest_address_id)"/>
                                <field name="minimum_planned_date"/>
                                <field name="location_id"/>
                            </group>
                            <group colspan="2" col="2">
                                <separator string="Invoice Control" colspan="2"/>
                                <field name="invoice_method" attrs="{'readonly':[('state','in', ['confirmed','approved','done'] )] , 'invisible': [('order_type', 'in', ['donation_exp', 'donation_st', 'in_kind', 'loan'])]}" />
                                <field name="fiscal_position" widget="selection"/>
                            </group>
                            <newline/>
                            <separator string="Purchase Control" colspan="4"/>
                            <field name="validator"/>
                            <field name="date_approve"/>
                        	<separator string="Invoices" colspan="4"/>
                        	<newline/>
                        	<field name="invoice_ids" groups="base.group_extended" nolabel="1" colspan="4" context="{'type':'in_invoice', 'journal_type': 'purchase'}"/>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="notes" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>
       	
       	<record id="product_supplierinfo_form_view" model="ir.ui.view">
            <field name="name">product.supplierinfo.form.view</field>
            <field name="model">product.supplierinfo</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product.product_supplierinfo_form_view" />
            <field name="arch" type="xml">
            	<data>
            	
            		<xpath expr="//tree[@string='Pricelist']/field[@name='price']" position="after">
            			<field name="currency_id" />
            			<field name="valid_till" />
            			<field name="purchase_order_id" />
            			<field name="purchase_order_line_number" />
            			<field name="purchase_order_line_id" />
            		</xpath>
            		
            		<xpath expr="//form/field[@name='price']" position="after">
            			<field name="currency_id" />
            			<field name="valid_till" />
            			<field name="purchase_order_id" />
            			<field name="purchase_order_line_number" />
            			<field name="purchase_order_line_id" />
            		</xpath>
            	
            	</data>
            </field>
       	</record>
       	
        <record id="rfq_form" model="ir.ui.view">
            <field name="name">rfq.form</field>
            <field name="model">purchase.order</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Request for Quotation">
                    <group col="6" colspan="4">
                        <field name="name"/>
                        <field name="rfq_ok" invisible="1" />
                        <field name="date_order"/>
                        <field name="invoiced"/>
                        <newline/>
                        <field name="warehouse_id" on_change="onchange_warehouse_id(warehouse_id)" widget="selection"/>
                        <field name="partner_ref"/>
                        <field name="shipped"/>
                        <!-- purchase_override > purchase_view.xml -->
                        <field name="order_type" on_change="onchange_internal_type(order_type, partner_id)" />
                        <field name="priority" />
                        <newline />
                        <field name="categ" />
                        <field name="loan_duration" attrs="{'invisible': [('order_type', '!=', 'loan')], 'required': [('order_type', '=', 'loan')]}" />
                        <field name="details" />
                        <field name="tender_id" />
            			<field name="valid_till" />
                        <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Purchase Order">
                            <field name="partner_id" on_change="onchange_partner_id(partner_id)" context="{'search_default_supplier':1}" />
                            <field name="partner_address_id"/>
                            <field domain="[('type','=','purchase')]" name="pricelist_id" groups="base.group_extended"/>
                            <field name="origin" groups="base.group_extended"/>
                            <newline/>
                            <field colspan="4" name="order_line" nolabel="1" mode="tree,form">
                                <tree string="Purchase Order Lines">
                                    <field name="date_planned"/>
                                    <field name="name"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom"/>
                                    <field name="price_unit"/>
                                    <field name="price_subtotal"/>
                                </tree>
                                <!-- default form view -->
                            </field>
                            <group col="7" colspan="4">
                                <field name="amount_untaxed" sum="Untaxed amount"/>
                                <field name="amount_tax"/>
                                <field name="amount_total" sum="Total amount"/>
                                <button name="button_dummy" states="draft" string="Compute" type="object" icon="gtk-execute"/>
                            </group>
                            <group col="11" colspan="4">
                                <field name="state" readonly="1"/>
                                <button name="purchase_cancel" states="draft,confirmed,wait_auth" string="Cancel" icon="gtk-cancel"/>
                                <button name="action_cancel_draft" states="cancel" string="Set to Draft" type="object" icon="gtk-convert"/>
                                <button name="action_cancel" states="approved,except_picking,except_invoice,wait" string="Cancel Purchase Order" type="object" icon="gtk-cancel"/>
                                <button name="picking_ok" states="except_picking" string="Manually Corrected" icon="gtk-convert"/>
                                <button name="invoice_ok" states="except_invoice" string="Manually Corrected" icon="gtk-convert"/>
                                <button name="rfq_sent" states="draft" string="RfQ Sent" icon="gtk-go-forward" attrs="{'invisible': ['|', ('rfq_ok', '!=', True), ('state', '!=', 'draft'),],}" />
            					<button name="rfq_updated" states="draft" string="RfQ Updated" icon="gtk-go-forward" attrs="{'invisible': [('state', '!=', 'rfq_sent'),],}" />
                            </group>
                        </page>
                        <page string="Delivery &amp; Invoicing" groups="base.group_extended">
                            <group colspan="2" col="2">
                                <separator string="Delivery" colspan="2"/>
                                <field name="dest_address_id" on_change="onchange_dest_address_id(dest_address_id)"/>
                                <field name="minimum_planned_date"/>
                                <field name="location_id"/>
                            </group>
                            <group colspan="2" col="2">
                                <separator string="Invoice Control" colspan="2"/>
                                <field name="invoice_method" attrs="{'readonly':[('state','in', ['confirmed','approved','done'] )] , 'invisible': [('order_type', 'in', ['donation_exp', 'donation_st', 'in_kind', 'loan'])]}" />
                                <field name="fiscal_position" widget="selection"/>
                            </group>
                            <newline/>
                            <separator string="Purchase Control" colspan="4"/>
                            <field name="validator"/>
                            <field name="date_approve"/>
                        	<separator string="Invoices" colspan="4"/>
                        	<newline/>
                        	<field name="invoice_ids" groups="base.group_extended" nolabel="1" colspan="4" context="{'type':'in_invoice', 'journal_type': 'purchase'}"/>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="notes" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>
       	
       	<record id="product_supplierinfo_form_view" model="ir.ui.view">
            <field name="name">product.supplierinfo.form.view</field>
            <field name="model">product.supplierinfo</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product.product_supplierinfo_form_view" />
            <field name="arch" type="xml">
            	<data>
            	
            		<xpath expr="//tree[@string='Pricelist']/field[@name='price']" position="after">
            			<field name="currency_id" />
            			<field name="valid_till" />
            			<field name="purchase_order_id" />
            			<field name="purchase_order_line_number" />
            			<field name="purchase_order_line_id" />
            		</xpath>
            		
            		<xpath expr="//form/field[@name='price']" position="after">
            			<field name="currency_id" />
            			<field name="valid_till" />
            			<field name="purchase_order_id" />
            			<field name="purchase_order_line_number" />
            			<field name="purchase_order_line_id" />
            		</xpath>
            	
            	</data>
            </field>
        </record>
        
        <record id="view_rfq_filter" model="ir.ui.view">
            <field name="name">purchase.order.rfq.list.select</field>
            <field name="model">purchase.order</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Purchase Order">
                  <group col='10' colspan='4'>
                    <filter icon="terp-document-new" name="draft_rfq" string="Draft" domain="[('state','=','draft')]" separator="1" help="Requests for Quotation which are in draft state"/>
                    <filter icon="gtk-apply" name="sent" string="Sent" domain="[('state','=','rfq_sent')]" separator="1" />
                    <filter icon="terp-camera_test" name="updated" string="Updated" domain="[('state','=','rfq_updated')]" separator="1" />
                    <filter icon="gtk-yes" name="done" string="Done" domain="[('state','=','done')]" separator="1" />
                    <filter icon="gtk-cancel" name="cancelled" string="Cancelled" domain="[('state','=','cancel')]" separator="1" />
                    <field name="partner_id" select="1" string="Supplier" />
                    <field name="product_id" select="1" />
                    <field name="origin" />
                    <field name="create_uid" select="1"/>
                    <field name="date_order" string="Creation date"/>
                    <newline />
                    <group string="Type" expand="0">
	                        <filter icon="terp-check" string="Regular" domain="[('order_type','=','regular')]" />
	                        <filter icon="terp-stage" string="Donation before expiry" domain="[('order_type','=','donation_exp')]" />
	                        <filter icon="terp-gtk-jump-to-ltr" string="Standard Donation" domain="[('order_type','=','donation_st')]" />
	                        <filter icon="terp-partner" string="Loan" domain="[('order_type','=','loan')]" />
	                        <filter icon="terp-gtk-jump-to-rtl" string="In-Kind donation" domain="[('order_type','=','in_kind')]" />
	                        <filter icon="terp-purchase" string="Purchase List" domain="[('order_type','=','purchase_list')]" />
	                        <filter icon="terp-crm" string="Direct PO" domain="[('order_type','=','direct')]" />
	                    </group>
	                    <newline />
	                    <group string="Priority" expand="0">
                            <filter icon="gtk-dialog-warning" string="Emergency" domain="[('priority','=','emergency')]"/>
                            <filter icon="gtk-yes" string="Normal" domain="[('priority','=','normal')]"/>
                            <filter icon="gtk-info" string="Medium" domain="[('priority','=','priority')]"/>
	                    </group>
	                    <newline />
	                    <group string="Category" expand="0">
                            <filter icon="gtk-color-picker" string="Medical" domain="[('categ','=','medical')]"/>
                            <filter icon="terp-stock" string="Logistic" domain="[('categ','=','log')]"/>
                            <filter icon="terp-purchase" string="Service" domain="[('categ','=','service')]"/>
                            <filter icon="gtk-harddisk" string="Other" domain="[('categ','=','other')]"/>                            
	                    </group>
                        <newline />
                </group>
                <newline/>
                <group expand="0" string="Group By..." colspan="4" col="10" groups="base.group_extended">
                  <filter string="Order Type" icon="terp-rating-rated" domain="[]" context="{'group_by':'order_type'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Priority" icon="terp-project" domain="[]" context="{'group_by':'priority'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Category" icon="terp-translate" domain="[]" context="{'group_by':'categ'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Supplier" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Origin" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'origin'}"/>
                  <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Creation Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_order'}"/>
                  <filter string="Expected Date" icon="terp-go-month" domain="[]" context="{'group_by':'delivery_requested_date'}"/>
                </group>
              </search>
            </field>
        </record>

        <record id="view_rfq_tree" model="ir.ui.view">
            <field name="name">view.rfq.tree</field>
            <field name="model">purchase.order</field>
            <field name="type">tree</field>
            <field name="priority" eval="300" />
            <field name="arch" type="xml">
                <tree string="Requests for Quotation">
                    <field name="name" />
                    <field name="order_type" />
                    <field name="priority" />
                    <field name="categ" />
                    <field name="date_order" string="Creation date"/>
                    <field name="partner_id" />
                    <field name="delivery_requested_date" />
                    <field name="origin" />
                    <field name="amount_total" sum="Total amount" />
                    <field name="state" />
                </tree>
            </field>
        </record>
        
        <record id="purchase.purchase_rfq" model="ir.actions.act_window">
            <field name="name">Requests for Quotation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_type">form</field>
            <field name="context">{'rfq_ok': True, 'search_default_draft_rfq': 1,}</field>
            <field name="domain">[('rfq_ok', '=', True),]</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="search_view_id" ref="view_rfq_filter"/>
            <field name="help">You can create a request for quotation when you want to buy products to a supplier but the purchase is not confirmed yet. Use also this menu to review requests for quotation created automatically based on your logistic rules (minimum stock, MTO, etc). You can convert the request for quotation into a purchase order once the order is confirmed. If you use the extended interface (from user's preferences), you can select the way to control your supplier invoices: based on the order, based on the receptions or manual encoding.</field>
        </record>

        <record id="purchase_rfq_tree_view_action" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="purchase.purchase_rfq" />
            <field name="sequence">1</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_rfq_tree" />
        </record>
        
        <record id="purchase.purchase_form_action" model="ir.actions.act_window">
            <field name="name">Purchase Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="context">{'search_default_approved': 1,'search_default_create_uid':uid}</field>
            <field name="domain">[('rfq_ok', '=', False),]</field>
            <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
            <field name="help">Use this menu to search within your purchase orders by references, supplier, products, etc. For each purchase order, you can track the products received, and control the supplier invoices.</field>
        </record>

	</data>
</openerp>
