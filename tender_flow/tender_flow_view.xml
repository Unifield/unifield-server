<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
	
        <record id="tender_form" model="ir.ui.view">
            <field name="name">tender.form</field>
            <field name="model">tender</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Tender">
                    <group col="6" colspan="4">
                    	<field name="creator" />
                    	<field name="creation_date" />
                    	<field name="requested_date" />
                        <field name="name"/>
                        <field name="sale_order_id"/>
                        <field name="warehouse_id" widget="selection" on_change="onchange_warehouse(warehouse_id)" />
                        <field name="location_id" />
                        <field name="company_id" invisible="True" />
                        <field name="categ" />
                        <field name="priority" />
                        <field name="details" />
                    </group>
                    <notebook colspan="5">
                        <page string="Tender Lines">
                            <field colspan="4" mode="tree,form,graph" name="tender_line_ids" nolabel="1" widget="one2many_list">
                                <tree string="Tender Lines" editable="top">
                                	<!-- <field name="date_planned" /> -->
                                    <field name="product_id" on_change="on_product_change(product_id)" />
                                    <field name="qty" />
                                    <field name="product_uom" />
                                    <field name="supplier_id" />
                                    <field name="price_unit" />
                                    <field name="total_price" />
                                    <field name="purchase_order_id" />
                                    <field name="purchase_order_line_number" />
                                </tree>
                            </field>
                            <newline/>
                            <group col="13" colspan="10">
                            </group>
                        </page>
                        <page string="Suppliers">
                        	<field colspan="4" mode="tree,form,graph" name="supplier_ids" nolabel="1">
                                <tree string="Suppliers">
                                    <field name="name" />
                                    <field name="partner_type" />
                                    <field name="city" />
                                    <field name="country" />
                                </tree>
                            </field>
                        </page>
                        <page string="RfQs">
                        	<field colspan="4" mode="tree,form,graph" name="rfq_ids" nolabel="1">
                                <tree string="RfQs">
                                    <field name="name" />
                                    <field name="state" />
                                </tree>
                            </field>
                        </page>
                        <page string="Notes">
                        	<field name="notes" nolabel="1" />
                        </page>
                    </notebook>
                    <group col="13" colspan="4">
                        <field name="state"/>
                        <button name="tender_cancel" string="Cancel" icon="gtk-cancel" attrs="{'invisible':[('sale_order_id','!=', False),],}" />
                        <button name="button_generate" states="draft" string="Generate RfQs" icon="gtk-convert" />
                        <button name="compare_rfqs" states="comparison" string="Compare RfQs" type="object" icon="gtk-find" />
                        <button name="update_supplier_info" states="comparison" string="Update Product's Suppliers" type="object" icon="gtk-edit" />
                        <button name="button_done" states="comparison" string="Continue Sourcing Process" icon="gtk-go-forward" attrs="{'invisible':['|', ('state', '!=', 'comparison'), ('sale_order_id','=', False),],}" />
                        <button name="create_po" states="comparison" string="Create PO" type="object" icon="gtk-add" attrs="{'invisible':['|', ('state', '!=', 'comparison'), ('sale_order_id','!=', False),],}" />
                        <button name="done" string="Done" type="object" icon="gtk-go-forward" attrs="{'invisible':['|', ('state', '!=', 'comparison'), ('sale_order_id','!=', False),],}" />
                    </group>
                </form>
            </field>
        </record>
        
        <record id="tender_tree" model="ir.ui.view">
            <field name="name">tender.tree</field>
            <field name="model">tender</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Tender">
                    <field name="name" />
                    <field name="sale_order_id" />
                    <field name="rfq_name_list" />
                    <field name="categ" />
                    <field name="priority" />
                    <field name="state" />
                </tree>
            </field>
        </record>
	
		<record id="tender_search_form_view" model="ir.ui.view">
			<field name="name">tender.search.form</field>
			<field name="model">tender</field>
			<field name="type">search</field>
			<field name="arch" type="xml">
				<search string="Tender">
					<filter name="draft" icon="gtk-file" string="Draft"
                            domain="[('state', '=', 'draft'),]" />
                    <filter name="comparison" icon="gtk-sort-descending" string="Comparison"
                            domain="[('state', '=', 'comparison'),]" />
                    <filter name="done" icon="gtk-apply" string="Done"
                            domain="[('state', '=', 'done'),]" />
                    <filter name="cancel" icon="gtk-cancel" string="Cancel"
                            domain="[('state', '=', 'cancel'),]" />
					<field name="name" />
					<field name="sale_order_id" />
					<field name="rfq_ids" />
					<field name="state" />
					
					<newline />
					<group expand="0" string="Group By..." colspan="11" col="11"
						groups="base.group_extended">
						<filter string="Sale Order" icon="terp-accessories-archiver" domain="[]"
							context="{'group_by':'sale_order_id'}" />
						<filter string="Tender State" icon="terp-rating-rated"
							domain="[]" context="{'group_by':'state'}" />
					</group>
				</search>
			</field>
		</record>

		<record id="tender_action" model="ir.actions.act_window">
			<field name="name">Tenders</field>
			<field name="res_model">tender</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[]</field>
			<field name="search_view_id" ref="tender_search_form_view" />
		</record>

		<menuitem icon="STOCK_INDENT" action="tender_action"
			id="menu_tender" parent="purchase.menu_procurement_management" sequence="100" />
			
        <record id="purchase_order_form" model="ir.ui.view">
            <field name="name">purchase.order.form</field>
            <field name="model">purchase.order</field>
            <field name="type">form</field>
            <field name="priority">300</field>
            <field name="inherit_id" ref="purchase.purchase_order_form" />
            <field name="arch" type="xml">
            	<data>
            		
            		<field name="details" position="after">
            			<field name="tender_id" invisible="True" />
            			<field name="valid_till" attrs="{'invisible': [('tender_id', '=', False),],}"/>
            		</field>
            		
            		<button name="purchase_confirm" position="replace">
            			<button name="purchase_confirm" states="draft" string="Convert to Purchase Order" icon="gtk-go-forward" attrs="{'invisible': ['|', ('tender_id', '!=', False), ('state', '!=', 'draft'),],}" />
            			<button name="rfq_sent" states="draft" string="RfQ Sent" icon="gtk-go-forward" attrs="{'invisible': ['|', ('tender_id', '=', False), ('state', '!=', 'draft'),],}" />
            			<button name="rfq_updated" states="draft" string="RfQ Updated" icon="gtk-go-forward" attrs="{'invisible': ['|', ('tender_id', '=', False), ('state', '!=', 'rfq_sent'),],}" />
            		</button>
            		
            		<button name="purchase_cancel" position="replace">
            			<button name="purchase_cancel" states="draft,confirmed,wait_auth,rfq_sent" string="Cancel" icon="gtk-cancel"/>
            		</button>
            		
            		<!-- <button name="purchase_cancel" position="replace">
            			<button name="purchase_cancel" states="draft,confirmed,wait_auth" string="Cancel" icon="gtk-cancel" attrs="{'invisible': [('tender_id', '!=', False)],}" />
            		</button>
            		 -->
            	
            	</data>
            </field>
       	</record>
       	
       	<record id="product_supplierinfo_form_view" model="ir.ui.view">
            <field name="name">product.supplierinfo.form.view</field>
            <field name="model">product.supplierinfo</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product.product_supplierinfo_form_view" />
            <field name="arch" type="xml">
            	<data>
            	
            		<xpath expr="//tree[@string='Pricelist']/field[@name='price']" position="after">
            			<field name="currency_id" />
            			<field name="valid_till" />
            			<field name="purchase_order_id" />
            			<field name="purchase_order_line_number" />
            			<field name="purchase_order_line_id" />
            		</xpath>
            		
            		<xpath expr="//form/field[@name='price']" position="after">
            			<field name="currency_id" />
            			<field name="valid_till" />
            			<field name="purchase_order_id" />
            			<field name="purchase_order_line_number" />
            			<field name="purchase_order_line_id" />
            		</xpath>
            	
            	</data>
                
            </field>
        </record>
        
        <record id="view_rfq_filter" model="ir.ui.view">
            <field name="name">purchase.order.rfq.list.select</field>
            <field name="model">purchase.order</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Purchase Order">
                 <group col='10' colspan='4'>
                    <filter icon="terp-document-new" name="draft" string="Quotations" domain="[('state','=','draft')]" separator="1" help="Purchase order which are in draft state"/>
                    <filter icon="gtk-apply" name="sent" string="Sent" domain="[('state','=','rfq_sent')]" separator="1" />
                    <filter icon="gtk-edit" name="updated" string="Updated" domain="[('state','=','rfq_updated')]" separator="1" />
                    <filter icon="gtk-yes" name="done" string="Done" domain="[('state','=','rfq_done')]" separator="1" />
                    <separator orientation="vertical"/>
                    <field name="name" select="1" string="Reference"/>
                    <field name="partner_id" select="1"/>
                    <field name="product_id" select="1"/>
                    <field name="create_uid" select="1"/>
                    <newline />
                    <group string="Type" expand="0">
	                        <filter icon="terp-check" string="Regular" domain="[('order_type','=','regular')]" />
	                        <filter icon="terp-stage" string="Donation before expiry" domain="[('order_type','=','donation_exp')]" />
	                        <filter icon="terp-gtk-jump-to-ltr" string="Standard Donation" domain="[('order_type','=','donation_st')]" />
	                        <filter icon="terp-partner" string="Loan" domain="[('order_type','=','loan')]" />
	                        <filter icon="terp-gtk-jump-to-rtl" string="In-Kind donation" domain="[('order_type','=','in_kind')]" />
	                        <filter icon="terp-purchase" string="Purchase List" domain="[('order_type','=','purchase_list')]" />
	                        <filter icon="terp-crm" string="Direct PO" domain="[('order_type','=','direct')]" />
	                    </group>
	                    <newline />
	                    <group string="Priority" expand="0">
                            <filter icon="gtk-dialog-warning" string="Emergency" domain="[('priority','=','emergency')]"/>
                            <filter icon="gtk-yes" string="Normal" domain="[('priority','=','normal')]"/>
                            <filter icon="gtk-info" string="Medium" domain="[('priority','=','priority')]"/>
	                    </group>
	                    <newline />
	                    <group string="Category" expand="0">
                            <filter icon="gtk-color-picker" string="Medical" domain="[('categ','=','medical')]"/>
                            <filter icon="terp-stock" string="Logistic" domain="[('categ','=','log')]"/>
                            <filter icon="terp-accessories-archiver" string="Food" domain="[('categ','=','food')]"/>
                            <filter icon="terp-purchase" string="Service" domain="[('categ','=','service')]"/>
                            <filter icon="gtk-network" string="Asset" domain="[('categ','=','asset')]"/>
                            <filter icon="terp-stock_symbol-selection" string="Mixed" domain="[('categ','=','mixed')]"/>
                            <filter icon="gtk-harddisk" string="Other" domain="[('categ','=','other')]"/>                            
	                    </group>
                        <newline />
                </group>
                <newline/>
                  <group expand="0" string="Group By..." colspan="4" col="10" groups="base.group_extended">
                  <filter string="Order Type" icon="terp-rating-rated" domain="[]" context="{'group_by':'order_type'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Priority" icon="terp-project" domain="[]" context="{'group_by':'priority'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Category" icon="terp-translate" domain="[]" context="{'group_by':'categ'}"/>
                        <separator orientation="vertical"/>
                    <filter string="Supplier" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                     <separator orientation="vertical"/>
                    <filter string="Origin" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'origin'}"/>
                    <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                     <separator orientation="vertical"/>
                    <filter string="Order Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_order'}"/>
                    <filter string="Expected Date" icon="terp-go-month" domain="[]" context="{'group_by':'minimum_planned_date'}"/>

                </group>
              </search>
            </field>
        </record>
        
        <record id="purchase.purchase_rfq" model="ir.actions.act_window">
            <field name="name">Requests for Quotation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_type">form</field>
            <field name="context">{'rfq_ok': True,}</field>
            <field name="domain">[('state', 'in', ('draft', 'rfq_sent', 'rfq_updated', 'rfq_done',)),]</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="search_view_id" ref="view_rfq_filter"/>
            <field name="help">You can create a request for quotation when you want to buy products to a supplier but the purchase is not confirmed yet. Use also this menu to review requests for quotation created automatically based on your logistic rules (minimum stock, MTO, etc). You can convert the request for quotation into a purchase order once the order is confirmed. If you use the extended interface (from user's preferences), you can select the way to control your supplier invoices: based on the order, based on the receptions or manual encoding.</field>
        </record>

	</data>
</openerp>
