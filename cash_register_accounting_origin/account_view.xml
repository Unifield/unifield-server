<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

    <!-- Cash Register Form => Inheritance -->
        <record id="inherit_view_bank_statement_form2" model="ir.ui.view">
            <field name='name'>inherit.view.bank.statement.form2</field>
            <field name='model'>account.bank.statement</field>
            <field name="type">form</field>
            <field name='inherit_id' ref='account.view_bank_statement_form2' />
            <field name="arch" type="xml">
                <xpath expr="/form" position="replace">
                    <form string="Statement">
                        <group col="6" colspan="4">
                            <field name="name" readonly="1"/>
                            <field name="company_id" select="1" groups="base.group_multi_company" invisible="True"/>
                            <field name="journal_id" on_change="onchange_journal_id(journal_id)" domain="[('type','=','cash')]" select="1" 
                                widget="selection"/>
                            <field name="user_id" select="1" readonly="1"/>
                            <field name="period_id" select="1"/>
                            <field name="currency" invisible="1"/>
                        </group>
                        <group col="6" colspan="4">
                            <button name="button_wiz_temp_posting" states="open" string="Temp Posting" type="object" icon="terp-gtk-jump-to-ltr" 
                                context="context"/>
                            <button name="button_wiz_hard_posting" states="open" string="Hard Posting" type="object" icon="terp-camera_test" 
                                context="context"/>
                            <button name="button_wiz_create_invoice" states="open" string="Create Invoice" type="object" icon="terp-document-new" 
                                context="context" />
                        </group>
                        <notebook colspan="4">
                            <page string="Cash Transactions" attrs="{'invisible': [('state','=','draft')]}">
                                <field colspan="4" name="line_ids" nolabel="1">
                                    <tree editable="bottom" string="Statement lines">
                                        <field name="date" groups="base.group_extended"/>
                                        <field name="name" string="Description"/>
                                        <field domain="[('journal_id','=',parent.journal_id)]" name="account_id"/>
                                        <field name="partner_type"/>
                                        <field name="register_id" domain="[('type', '=', 'liquidity')]"/>
                                        <field name="employee_id"/>
                                        <field name="partner_id" on_change="onchange_partner_id(partner_id)"/>
                                        <field name="analytic_account_id" 
                                            domain="[('company_id', '=', parent.company_id), ('type', '&lt;&gt;', 'view')]" 
                                            groups="analytic.group_analytic_accounting" />
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0"/>
                                        <field name="amount_out" readonly="0"/>
                                        <button name="button_temp_posting" states="draft" string="Temp" type="object" icon="terp-gtk-jump-to-ltr" 
                                            context="context"/>
                                        <button name="button_hard_posting" states="draft,temp" string="Hard" type="object" icon="terp-camera_test" 
                                            context="context"/>
                                        <field name="state" readonly="True"/>
                                    </tree>
                                    <form string="Statement lines">
                                        <field name="date"/>
                                        <field name="name" string="Description"/>
                                        <field domain="[('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id"/>
                                        <field name="type" on_change="onchange_type(partner_id, type)"/>
                                        <field name="ref"/>
                                        <field name="register_id" domain="[('type', '=', 'liquidity')]"/>
                                        <field name="employee_id"/>
                                        <field name="partner_id" on_change="onchange_partner_id(partner_id)"/>
                                        <field name="analytic_account_id" 
                                            domain="[('company_id', '=', parent.company_id), ('type', '&lt;&gt;', 'view')]" 
                                            groups="analytic.group_analytic_accounting" />
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0"/>
                                        <field name="amount_out" readonly="0"/>
                                        <separator colspan="4" string="Notes"/>
                                        <field colspan="4" name="note" nolabel="1"/>
                                        <field name="state" readonly="True"/>
                                    </form>
                                </field>
                            </page>
                            <page string="CashBox">
                                <group col="2" colspan="2" expand="1">
                                    <field name="starting_details_ids" nolabel="1" colspan="2" attrs="{'readonly':[('state','!=','draft')]}">
                                        <tree string = "Opening Balance" editable="bottom">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal" sum="Total"/>
                                        </tree>
                                        <form string = "Opening Balance">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal"/>
                                        </form>
                                    </field>
                                </group>
                                <group col="2" colspan="2" expand="1">
                                    <field name="ending_details_ids" nolabel="1" colspan="2" attrs="{'readonly':[('state','!=','open')]}">
                                        <tree string = "Closing Balance" editable="bottom">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal" sum="Total"/>
                                        </tree>
                                        <form string = "Closing Balance">
                                            <field name="pieces"/>
                                            <field name="number" on_change="on_change_sub(pieces,number, parent.balance_end)"/>
                                            <field name="subtotal"/>
                                        </form>
                                    </field>
                                </group>
                            </page>
                            <page string="Journal Entries" attrs="{'readonly':[('state','=','confirm')]}" invisible="1">
                                <field colspan="4" name="move_line_ids" nolabel="1" string="Journal Entries" />
                            </page>
                        </notebook>
                        <group col="6" colspan="4">
                            <group col="2" colspan="2">
                                <separator string="Dates" colspan="4"/>
                                <field name="date" select="1" readonly="True" on_change="onchange_date(date)" string="Opening Date"/>
                                <field name="closing_date" select="1" readonly="1"/>
                            </group>
                            <group col="2" colspan="2">
                                <separator string="Opening Balance" colspan="4"/>
                                <field name="balance_start" string="Opening Balance" readonly="True"/>
                                <field name="total_entry_encoding"/>
                            </group>
                            <group col="2" colspan="2">
                                <separator string="Closing Balance" colspan="4"/>
                                <field name="balance_end" string="Calculated Balance" readonly="1"/>
                                <field name="balance_end_cash" readonly="1" string="CashBox Balance"/>
                            </group>
                        </group>
                        <separator string="State" />
                        <group name="state" colspan="4">
                            <field name="state" colspan="4" readonly="True"/>
                        </group>
                        <button name="button_open_cash" states="draft" string="Open CashBox" icon="gtk-go-forward" type="object" colspan="2"/>
                        <group name="open_state" colspan="4">
                            <button name="button_cancel" states="open" string="Cancel" icon="terp-gtk-stop" type="object" 
                                groups="base.group_extended" colspan="2"/>
                            <button name="button_confirm_cash" states="open" string="Close CashBox" icon="gtk-ok" type="object" colspan="2" />
                        </group>
                    </form>
                </xpath>
            </field>
        </record>

    <!-- Bank Statement Line Tree View -->
        <record model="ir.ui.view" id="view_account_bank_statement_line_tree">
            <field name="name">view.account.bank.statement.line.tree</field>
            <field name="model">account.bank.statement.line</field>
            <field name="type">tree</field>
            <field name="priority" eval="20" />
            <field name="arch" type="xml">
                <tree string="Register Line List">
                    <field name="date" />
                    <field name="name" string="Description"/>
                    <field name="account_id" />
                    <field name="partner_id" />
                    <field name="amount_in" />
                    <field name="amount_out" />
                    <field name="state" />
                </tree>
            </field>
        </record>

<!-- Bank Register Filter -->

        <record id="view_account_bank_statement_filter" model="ir.ui.view">
            <field name="name">account.cash.statement.select</field>
            <field name="model">account.bank.statement</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Bank Registers">
                    <group col="8" colspan="4">
                        <filter string="Draft" domain="[('state','=','draft')]" icon="terp-document-new"/>
                        <filter string="Confirmed" domain="[('state','=','confirm')]" icon="terp-camera_test"/>
                        <separator orientation="vertical"/>
                        <field name="date"/>
                        <field name="name"/>
                        <field name="journal_id" widget='selection' domain="[('type', '=', 'cash')]" />
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Journal" context="{'group_by': 'journal_id'}" icon="terp-folder-orange"/>
                        <filter string="State" context="{'group_by': 'state'}" icon="terp-stock_effects-object-colorize"/>
                        <separator orientation="vertical"/>
                        <filter string="Period" context="{'group_by': 'period_id'}" icon="terp-go-month"/>
                    </group>
                </search>
            </field>
        </record>

    <!-- Bank Register Search Form -->
        <record id="view_bank_statement_search" model="ir.ui.view">
            <field name="name">account.bank.statement.search</field>
            <field name="model">account.bank.statement</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Bank Registers">
                    <group col="8" colspan="4">
                        <filter string="Draft" domain="[('state','=','draft')]" icon="terp-document-new"/>
                        <filter string="Confirmed" domain="[('state','=','confirm')]" icon="terp-camera_test"/>
                        <separator orientation="vertical"/>
                        <field name="name"/>
                        <field name="date"/>
                        <field name="period_id"/>
                        <field name="journal_id" widget="selection" domain="[('type', '=', 'bank')]" />
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Journal" context="{'group_by': 'journal_id'}" icon="terp-folder-orange"/>
                        <filter string="State" context="{'group_by': 'state'}" icon="terp-stock_effects-object-colorize"/>
                        <separator orientation="vertical"/>
                        <filter string="Period" context="{'group_by': 'period_id'}" icon="terp-go-month"/>
                    </group>
                </search>
            </field>
        </record>

    <!-- Bank Register Form => Inheritance -->
        <record id="inherit_view_bank_statement_form" model="ir.ui.view">
            <field name='name'>inherit.view.bank.statement.form</field>
            <field name='model'>account.bank.statement</field>
            <field name="type">form</field>
            <field name='inherit_id' ref='account.view_bank_statement_form' />
            <field name="arch" type="xml">
                <xpath expr="/form" position="replace">
                    <form string="Bank Register">
                        <group col="7" colspan="4">
                            <field name="name" select="1" readonly="0" attrs="{'readonly': [('state', '=', 'open')]}"/>
                            <field name="date" select="1" on_change="onchange_date(date)"/>
                            <field name="journal_id" domain="[('type', '=', 'bank')]" on_change="onchange_journal_id(journal_id)" select="1" 
                                widget="selection"/>
                            <newline/>
                            <field name="period_id" readonly="1"/>
                            <field name="balance_start"/>
                            <field name="balance_end_real"/>
                            <field name="currency" invisible="1"/>
                            <field name='company_id' widget="selection" groups="base.group_multi_company" invisible="1"/>
                        </group>
                        <group col="2" colspan="4">
                            <button name="button_wiz_temp_posting" states="open" string="Temp Posting" type="object" icon="terp-gtk-jump-to-ltr" 
                                context="context"/>
                            <button name="button_wiz_hard_posting" states="open" string="Hard Posting" type="object" icon="terp-camera_test" 
                                context="context"/>
                        </group>
                        <notebook colspan="4">
                            <page string="Transaction" name="statement_line_ids">
                                <field colspan="4" name="line_ids" nolabel="1">
                                    <tree editable="bottom" string="Statement lines">
                                        <field name="sequence" readonly="1" invisible="1"/>
                                        <field name="date" groups="base.group_extended" string="Posting Date"/>
                                        <field name="name" string="Description"/>
                                        <field name="ref"/>
                                        <field domain="[('journal_id','=',parent.journal_id)]" name="account_id"/>
                                        <field name="partner_type"/>
                                        <field name="register_id" domain="[('type', '=', 'liquidity')]"/>
                                        <field name="employee_id"/>
                                        <field name="partner_id" on_change="onchange_partner_id(partner_id)"/>
                                        <field name="analytic_account_id" groups="analytic.group_analytic_accounting" 
                                            domain="[('company_id', '=', parent.company_id), ('type', '&lt;&gt;', 'view')]"/>
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0"/>
                                        <field name="amount_out" readonly="0"/>
                                        <field name="reconciled"/>
                                        <button name="button_temp_posting" states="draft" string="Temp" type="object" icon="terp-gtk-jump-to-ltr" 
                                            context="context"/>
                                        <button name="button_hard_posting" states="draft,temp" string="Hard" type="object" icon="terp-camera_test" 
                                            context="context"/>
                                        <field name="state" readonly="True"/>
                                    </tree>
                                    <form string="Statement lines">
                                        <field name="date" string="Posting Date"/>
                                        <field name="name" string="Description"/>
                                        <field name="ref"/>
                                        <field domain="[('journal_id', '=', parent.journal_id), ('type', '&lt;&gt;', 'view')]" name="account_id"/>
                                        <field name="partner_type"/>
                                        <field name="register_id" domain="[('type', '=', 'liquidity')]"/>
                                        <field name="employee_id"/>
                                        <field name="partner_id" on_change="onchange_partner_id(partner_id)"/>
                                        <field name="analytic_account_id" groups="analytic.group_analytic_accounting" 
                                            domain="[('company_id', '=', parent.company_id), ('type', '&lt;&gt;', 'view')]"/>
                                        <field name="amount" invisible="1"/>
                                        <field name="amount_in" readonly="0"/>
                                        <field name="amount_out" readonly="0"/>
                                        <field name="reconciled"/>
                                        <field name="sequence" readonly="0" invisible="1"/>
                                        <separator colspan="4" string="Notes"/>
                                        <field colspan="4" name="note" nolabel="1"/>
                                    </form>
                                </field>
                            </page>
                            <page string="Journal Entries" name="move_live_ids">
                                <field colspan="4" name="move_line_ids" nolabel="1"/>
                            </page>
                        </notebook>
                        <group col="8" colspan="4">
                            <field name="state" readonly="1"/>
                            <field name="balance_end" readonly="1"/>
                            <button name="button_cancel" states="confirm" string="Cancel" type="object" icon="gtk-cancel"/>
                            <button name="button_dummy" states="draft,open" string="Compute" type="object" icon="terp-stock_format-scientific"/>
                            <button name="button_open_bank" states="draft" string="Open Bank" type="object" icon="gtk-go-forward"/>
                            <button name="button_confirm_bank" states="open" string="Confirm" type="object"  icon="terp-camera_test"/>
                        </group>
                    </form>
                </xpath>
            </field>
        </record>

    <!--Bank Register modification to change "Bank Statement" into "Bank Register" -->

        <record id="action_bank_statement_tree" model="ir.actions.act_window">
            <field name="name">Bank Registers</field>
            <field name="res_model">account.bank.statement</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="domain">[('journal_id.type', '=', 'bank')]</field>
            <field name="context">{'journal_type':'bank'}</field>
            <field name="search_view_id" ref="view_bank_statement_search"/>
            <field name="help">A bank register is a summary of all financial transactions occurring over a given period of time on a deposit account, 
                a credit card or any other type of financial account. The starting balance will be proposed automatically and the closing balance is 
                to be found on your statement. When you are in the Payment column of a line, you can press F1 to open the reconciliation form.
            </field>
        </record>

    <record id="action_bank_statement_periodic_tree" model="ir.actions.act_window">
            <field name="name">Bank Registers</field>
            <field name="res_model">account.bank.statement</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="domain">[('journal_id.type', '=', 'bank')]</field>
            <field name="search_view_id" ref="view_bank_statement_search"/>
            <field name="context">{'journal_type':'bank'}</field>
        </record>

        <menuitem string="Bank Registers" action="action_bank_statement_tree" id="account.menu_bank_statement_tree" parent="account.menu_finance_bank_and_cash" 
            sequence="7"/>

        <act_window
           id="act_account_journal_2_account_bank_statement"
           name="Bank registers"
           context="{'search_default_journal_id':active_id,}"
           res_model="account.bank.statement"
           src_model="account.journal"/>

    </data>
</openerp>
