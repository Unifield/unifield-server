<?xml version="1.0" encoding="utf-8" ?>
<openerp>
	<data>
        
    	<!-- Override Stock Moves -->
    	<record id="stock_move_tree2_type_id" model="ir.ui.view">
            <field name="name">stock.move.tree2.type.id</field>
            <field name="model">stock.move</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="stock.stock_move_tree2" />
            <field name="arch" type="xml">
				<data>
		    		<xpath expr="/tree/field[@name='location_dest_id']" position="replace">
						<field name="location_dest_id" on_change="location_dest_change(location_dest_id)" />
		    		</xpath>

                    <xpath expr="/tree/field[@name='product_uom']" position="after">
	    	        	<field name="reason_type_id" widget="selection" attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}" />
                        <field name="comment" />
                    </xpath>
				</data>
            </field>
        </record>

        <record id="view_move_tree_type_id" model="ir.ui.view">
            <field name="name">view.move.tree.type.id</field>
            <field name="model">stock.move</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="stock.view_move_tree" />
            <field name="arch" type="xml">
				<data>
		    		<xpath expr="/tree/field[@name='location_dest_id']" position="replace">
						<field name="location_dest_id" on_change="location_dest_change(location_dest_id)" />
		    		</xpath>

	                <xpath expr="/tree/field[@name='create_date']" position="after">
			    		<field name="reason_type_id" widget="selection" attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}" />
       	                <field name="comment" />
	                </xpath>
	        	</data>
            </field>
        </record>

        <record id="view_move_form_type_id" model="ir.ui.view">
            <field name="name">view.move.form.type.id</field>
            <field name="model">stock.move</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_move_form" />
            <field name="arch" type="xml">
                <xpath expr="/form//field[@name='tracking_id']" position="before">
        	    	<field name="reason_type_id" widget="selection" attrs="{'readonly': [('state', 'not in', ('draft', 'waiting', 'confirmed', 'assigned'))]}" />
                    <field name="comment" attrs="{'readonly': [('state', 'not in', ['draft', 'waiting', 'confirmed', 'assigned'])]}" />
                </xpath>
            </field>
        </record>

        <record id="inherit_view_move_form_reception_picking" model="ir.ui.view">
            <field name="name">inherit.view.move.form.reception.picking</field>
            <field name="model">stock.move</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_move_form_reception_picking" />
            <field name="arch" type="xml">
            	<data>
                	<xpath expr="/form//field[@name='tracking_id']" position="before">
                        <field name="reason_type_id" widget="selection" attrs="{'readonly': [('state', 'not in', ('draft', 'waiting', 'confirmed', 'assigned'))]}" />
                    </xpath>
                </data>
            </field>
        </record>

        <record id="view_move_search_type_id" model="ir.ui.view">
            <field name="name">view.move.search.type.id</field>
            <field name="model">stock.move</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="stock.view_move_search" />
            <field name="arch" type="xml">
				<data>
					<xpath expr="/search//field[@name='state']" position="replace" />

					<xpath expr="/search/group/field[@name='address_id']" position="after">
			    		<field name="state" />
        	            <field name="reason_type_id" widget="selection" />
			    		<newline />
	                    <field name="comment" />
					</xpath>

					<xpath expr="/search/group[@string='Group By...']/filter[@string='Destination']" position="after">
                        <separator />
                        <filter string="Reason Type" name="groupby_reason_type_id" icon="terp-purchase" domain="[]" context="{'group_by':'reason_type_id'}"/>
                    </xpath>
				</data>
            </field>
        </record>
        
        <record id="inherit_view_move_tree_reception_picking" model="ir.ui.view">
            <field name="name">inherit.view.move.tree.reception.picking</field>
            <field name="model">stock.move</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="stock.view_move_tree_reception_picking" />
            <field name="arch" type="xml">
            	<data>
                	<xpath expr="/tree/field[@name='picking_id']" position="after">
                        <field name="reason_type_id" />
                    </xpath>
                </data>
            </field>
        </record>

        <record id="inherit_view_move_search_reception_incoming_picking" model="ir.ui.view">
            <field name="name">inherit.view.move.search.reception.incoming.picking</field>
            <field name="model">stock.move</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="stock.view_move_search_reception_incoming_picking" />
            <field name="arch" type="xml">
            	<data>
					<xpath expr="/search/group/field[@name='product_id']" position="after">
			    		<newline />
			    		<field name="state" />
			    		<field name="reason_type_id" widget="selection" />
					    <field name="comment" />
					</xpath>
 			
 					<xpath expr="/search//filter[@string='Supplier']" position="after">
 						<filter string="Reason Type" icon="terp-purchase" domain="[]" context="{'group_by':'reason_type_id'}"/>
 						<separator orientation="vertical" />
 					</xpath>
                </data>
            </field>
        </record>

        <record id="inherit_view_move_search_reception_outcoming_picking" model="ir.ui.view">
            <field name="name">inherit.view.move.search.reception.outcoming.picking</field>
            <field name="model">stock.move</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="stock.view_move_search_reception_outcoming_picking" />
            <field name="arch" type="xml">
            	<data>
					<xpath expr="/search/group/field[@name='product_id']" position="after">
					    <newline />
					    <field name="state" />
					    <field name="reason_type_id" widget="selection" />
					    <field name="comment" />
					</xpath>
                            
                    <xpath expr="/search//filter[@string='Customer']" position="after">
                        <separator orientation="vertical" />
                        <filter string="Reason Type" icon="terp-purchase" domain="[]" context="{'group_by':'reason_type_id'}"/>
        	        </xpath>
        		</data>
            </field>
        </record>


	<record id="inherit_view_move_tree_reception_picking_board" model="ir.ui.view">
		<field name="name">inherit.view.move.tree.reception.picking.board</field>
		<field name="model">stock.move</field>
		<field name="type">tree</field>
		<field name="inherit_id" ref="stock.view_move_tree_reception_picking_board" />
		<field name="arch" type="xml">
			<data>
				<xpath expr="/tree/field[@name='product_uom']" position="after">
					<field name="reason_type_id" />
				</xpath>
				
				<button name="action_done" position="attributes">
           			<attribute name="invisible">1</attribute>
           		</button>
			</data>
		</field>
	</record>

        <record id="inherit_view_picking_in_form" model="ir.ui.view">
            <field name="name">inherit.view.picking.in.form</field>
            <field name="model">stock.picking</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_picking_in_form" />
            <field name="arch" type="xml">
                <data>
                        <xpath expr="/form//field[@name='move_lines']" position="attributes">
                        <attribute name="context">{'reason_type_id': reason_type_id}</attribute>
                        <attribute name="on_change">onchange_move()</attribute>
                    </xpath>

                        <xpath expr="/form/group//field[@name='stock_journal_id']" position="replace">
                                <field name="reason_type_id"  attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}"/>
                        </xpath>

                        <xpath expr="/form/notebook/page/field[@name='move_lines']/form//field[@name='tracking_id']" position="before">
                                <field name="reason_type_id"  attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}"/>
                        </xpath>

			<xpath expr="/form//field[@name='move_lines']/form//field[@name='location_dest_id']" position="replace">
        	                <field name="location_dest_id" domain="[('usage','=','internal')]" on_change="location_dest_change(location_dest_id)" />
	                </xpath>
			
                </data>
            </field>
        </record>

        <record id="inherit_view_picking_form" model="ir.ui.view">
            <field name="name">inherit.view.picking.form</field>
            <field name="model">stock.picking</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_picking_form" />
            <field name="arch" type="xml">
                <data>
                        <xpath expr="/form//field[@name='move_lines']" position="attributes">
                        	<attribute name="context">{'reason_type_id': reason_type_id}</attribute>
                        	<attribute name="on_change">onchange_move()</attribute>
                    	</xpath>

                        <xpath expr="/form/group//field[@name='stock_journal_id']" position="replace">
                            <field name="reason_type_id"  attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}"/>
                       </xpath>

                       <xpath expr="/form/notebook/page/field[@name='move_lines']/form//field[@name='tracking_id']" position="before">
                                <field name="reason_type_id"  attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}"/>
                       </xpath>

                        <xpath expr="/form//field[@name='move_lines']/form//field[@name='location_dest_id']" position="replace">
                                <field name="location_dest_id" domain="[('usage','in',('internal', 'inventory', 'procurement', 'production'))]" on_change="location_dest_change(location_dest_id)" />
                        </xpath>
                        
                        <!-- MOVED TO SPECIFIC_RULES
                        <xpath expr="/form//field[@name='move_lines']/form//field[@name='location_id']" position="replace">
                                <field name="location_id" domain="[('usage','in',('internal', 'procurement', 'production'))]" />
                        </xpath>
                        -->

               </data>
            </field>
        </record>

	 <record id="inherit_view_picking_out_form" model="ir.ui.view">
            <field name="name">inherit.view.picking.out.form</field>
            <field name="model">stock.picking</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_picking_out_form" />
            <field name="arch" type="xml">
                <data>
                        <xpath expr="/form//field[@name='move_lines']" position="attributes">
                        <attribute name="context">{'reason_type_id': reason_type_id}</attribute>
                        <attribute name="on_change">onchange_move()</attribute>
                    </xpath>

                        <xpath expr="/form/group//field[@name='stock_journal_id']" position="replace">
                            <field name="reason_type_id"  attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}"/>
                       </xpath>

                       <xpath expr="/form/notebook/page/field[@name='move_lines']/form//field[@name='tracking_id']" position="before">
                                <field name="reason_type_id"  attrs="{'readonly': [('state', 'not in', ('draft', 'confirmed', 'assigned'))]}"/>
                       </xpath>
                        <xpath expr="/form//field[@name='move_lines']/form//field[@name='location_dest_id']" position="replace">
                                <field name="location_dest_id" domain="[('usage','&lt;&gt;','view')]" on_change="location_dest_change(location_dest_id)" />
                        </xpath>

               </data>
            </field>
        </record>


	</data>
</openerp>

