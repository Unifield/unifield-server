<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <menuitem icon="terp-partner" id="base.menu_base_partner" name="Orders" sequence="0"
            groups="base.group_sale_salesman,base.group_sale_manager"/>

        <menuitem id="base.menu_sales" name="Sales" parent="base.menu_base_partner" sequence="1"/>

        <menuitem id="base.menu_product" name="Products" parent="base.menu_base_partner" sequence="9"/>
        <menuitem action="product.product_normal_action" id="product.menu_products" parent="base.menu_product" sequence="1"/>


        <record id="sync_order_label_tree" model="ir.ui.view">
            <field name="name">sync.order.label.tree</field>
            <field name="model">sync.order.label</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Order in sync. instance" hide_new_button="True" hide_delete_button="True">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="sync_order_label_search" model="ir.ui.view">
            <field name="name">sync.order.label.search</field>
            <field name="model">sync.order.label</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                </search>
            </field>
        </record>

        <record id="view_shop_form" model="ir.ui.view">
            <field name="name">sale.shop</field>
            <field name="model">sale.shop</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Sales Shop">
                    <field name="name" select="1"/>
                    <field name="warehouse_id" required="1" select="1" widget="selection"/>
                    <field name="company_id" widget='selection' groups="base.group_multi_company"/>
                    <separator colspan="4" string="Accounting"/>
                    <field name="payment_default_id"/>
                    <field domain="[('type','=','sale')]" name="pricelist_id" select="1"/>
                    <field name="project_id" select="1" groups="analytic.group_analytic_accounting"/>
                </form>
            </field>
        </record>
        <record id="view_shop_tree" model="ir.ui.view">
            <field name="name">sale.shop</field>
            <field name="model">sale.shop</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Sales Shop">
                    <field name="name"/>
                    <field name="warehouse_id"/>
                    <field name="pricelist_id"/>
                    <field name="project_id" groups="analytic.group_analytic_accounting"/>
                </tree>
            </field>
        </record>

        <record id="action_shop_form" model="ir.actions.act_window">
            <field name="name">Shop</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.shop</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_shop_tree"/>
            <field name="help">If you have more than one shop reselling your company products, you can create and manage that from here. Whenever you will record a new quotation or sales order, it has to be linked to a shop. The shop also defines the warehouse from which the products will be delivered for each particular sales.</field>
        </record>

        <menuitem action="action_shop_form" id="menu_action_shop_form"
            parent="base.menu_sale_config_sales" sequence="0" />

        <record id="view_sale_order_calendar" model="ir.ui.view">
            <field name="name">sale.order.calendar</field>
            <field name="model">sale.order</field>
            <field name="type">calendar</field>
            <field name="arch" type="xml">
                <calendar string="Sales Orders" color="state" date_start="date_order">
                    <field name="partner_id"/>
                    <field name="amount_total"/>
                </calendar>
            </field>
        </record>
        <record model="ir.ui.view" id="view_sale_order_graph">
            <field name="name">sale.order.graph</field>
            <field name="model">sale.order</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph string="Sales Orders" type="bar">
                    <field name="partner_id"/>
                    <field name="amount_total" operator="+"/>
                </graph>
            </field>
        </record>

        <record id="view_order_tree" model="ir.ui.view">
            <field name="name">sale.order.tree</field>
            <field name="model">sale.order</field>
            <field name="type">tree</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree string="Sales Orders" colors="grey:state=='cancel';blue:state in ('waiting_date','manual');red:state in ('invoice_except','shipping_except')">
                    <field name="name"/>
                    <field name="order_type" />
                    <field name="priority" />
                    <field name="categ" />
                    <field name="date_order"/>
                    <field name="short_client_ref" groups="base.group_extended"/>
                    <field name="partner_id"/>
                    <field name="details" truncate="15"/>
                    <field name="user_id" />
                    <field name="line_count"/>
                    <field name="picked_rate" widget="progressbar"/>
                    <!-- <field name="invoiced_rate" widget="progressbar"/> -->
                    <field name="amount_total" sum="Total Tax Included"/>
                    <field name="currency_id" />
                    <field name="state" invisible="True" />
                    <field name="state_hidden_sale_order" />
                </tree>
            </field>
        </record>

        <record id="view_order_form" model="ir.ui.view">
            <field name="name">sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Sales Order" noteditable="import_in_progress==True" hide_delete_button="1">
                    <group col="4" colspan="4">
                        <html>
                            <p id="big_amount" style="display:none; text-align:center; color:#f27d0c; font-weight:bold; font-size:1.2em">
                                <translate>
                                    WARNING: The Total amount of the following lines is more than 10 digits. Please check that the Qty and Unit price are correct to avoid loss of exact information:
                                </translate>
                            </p>
                            <p id="nr_lines" style="display:none; text-align:center; color:#f27d0c; font-weight:bold; font-size:1.2em">
                                <translate>WARNING: Order line(s) not synchronized, code(s) does not exist</translate>
                            </p>
                            <script language="javascript">
                                var is_big_amount = $('#msg_big_qty').val() || $('#msg_big_qty').text();
                                if (is_big_amount) {
                                    $('#big_amount').append('&lt;span&gt;'+is_big_amount+'&lt;/span&gt;&lt;br/&gt;');
                                    $('#big_amount').show();
                                }

                                var has_nr = $('#nb_creation_message_nr').val() || $('#nb_creation_message_nr').text();
                                if (has_nr &amp;&amp; has_nr!= '0') {
                                    $('#nr_lines').show();
                                }
                            </script>
                        </html>
                    </group>
                    <group col="4" colspan="4">
                        <field name="name" required="1"/>
                        <field name="date_order" readonly="1" />
                        <field name="invoiced" string="Invoiced" invisible="1"/>
                        <field name="warehouse_id" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        <field name="client_order_ref" invisible="1" />
                        <field name="short_client_ref" readonly="1" />
                        <field name="shipped" invisible="1"/>
                        <field name="msg_big_qty" invisible="1"/>
                        <field name="nb_creation_message_nr" invisible="1"/>
                        <field name="internal_type" invisible="1"/>
                        <field name="picked_rate" invisible="1"/>
                        <field name="is_a_counterpart" invisible="1"/>
                        <field name="fo_created_by_po_sync" invisible="1"/>
                        <field name="order_type" attrs="{'readonly': ['|', '|', ('fo_created_by_po_sync', '=', True), ('state', '!=', 'draft'), ('order_type', '=', 'loan_return')]}" on_change="onchange_order_type(order_type, partner_id)"/>
                        <field name="sourcing_trace_ok" invisible="1"/>
                        <field name="priority" attrs="{'readonly': [('state', 'not in', ['draft', 'draft_p', 'validated'])]}"/>
                        <field name="categ" on_change="onchange_categ(categ)"/> <!-- RO state!=draft set on _column, same on IR -->
                        <group colspan="2" col="2">
                            <field name="fo_to_resource" invisible="1"/>
                            <field name="loan_duration" attrs="{'invisible': [('order_type', 'not in', ['loan', 'loan_return'])], 'required': [('order_type', 'in', ['loan', 'loan_return'])], 'readonly': ['|', ('state', 'not in', ['draft', 'draft_p', 'validated', 'validated_p']), ('order_type', 'not in', ['loan', 'loan_return'])]}"/>
                            <field name="parent_order_name" readonly="True" attrs="{'invisible': [('fo_to_resource', '=', False)]}"/>
                        </group>
                        <field name="details" attrs="{'readonly': [('state', 'not in', ['draft', 'draft_p', 'validated'])]}"/>
                        <field name="noinvoice" invisible="1"/>
                    </group>
                    <group colspan="4" col="8" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}">
                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-check" context="context" colspan="4" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}"/>
                        <button name="button_reset_distribution" string="Reset AD at line level" type="object" icon="gtk-undelete" colspan="4" states="draft,draft_p,validated,validated_p"/>
                    </group>
                    <group colspan="4" col="8" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}">
                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-emblem-important" context="context" colspan="4" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}"/>
                        <button name="button_reset_distribution" string="Reset AD at line level" type="object" icon="gtk-undelete" colspan="4" states="draft,draft_p,validated,validated_p"/>
                    </group>
                    <field name="analytic_distribution_id" invisible="1"/>
                    <group colspan="3"/>
                    <notebook colspan="5">
                        <page string="Sales Order">
                            <field name="company_id2" invisible="1"/>
                            <field name="partner_id" on_change="onchange_partner_id(partner_id,order_type,date_order,est_transport_lead_time,context)" 
                                context="{'search_default_customer':1}" 
                                domain="[('customer','=',True), ('id', '!=', company_id2), ('check_partner_so', '=', {'order_type':order_type, 'partner_id': partner_id})]"
                                attrs="{'readonly': ['|', ('fo_created_by_po_sync', '=', True), ('state', '!=', 'draft')]}"/>
                            <field name="partner_type"/>
                            <field domain="[('partner_id','=',partner_id)]" name="partner_invoice_id" required="1"/> <!-- RO if state not in draft, draft_p, validated : _columns -->
                            <field domain="[('partner_id','=',partner_id)]" name="partner_order_id" required="1"/> <!-- RO if state not in draft, draft_p, validated : _columns -->
                            <field domain="[('partner_id','=',partner_id)]" name="partner_shipping_id" required="1"/> <!-- RO if state not in draft, draft_p, validated : _columns -->
                            <group colspan="2" col="3">
                                <field name="no_line" invisible="1"/>
                                <field name="pricelist_id" string="Currency" colspan="2" attrs="{'readonly': ['|', '|', ('no_line', '=', False), ('state', 'not in', ['draft']), ('partner_type', 'in', ['internal', 'intermission', 'section'])]}" domain="[('type', '=', 'sale'), ('in_search', '=', partner_type)]"/>
                                <button name="change_currency" string="Change currency" icon="terp-dolar" type="object" attrs="{'invisible': ['|', '|', ('no_line', '=', True), ('state', 'not in', ['draft', 'draft_p', 'validated']), ('partner_type', 'in', ['internal', 'intermission', 'section'])]}"/>
                            </group>
                            <group colspan="2" col="3">
                                <field name="stock_take_date" attrs="{'readonly': [('state', 'not in', ['draft', 'draft_p', 'validated', 'sourced', 'sourced_p', 'confirmed', 'confirmed_p'])]}"/>
                                <button colspan="1" name="update_date" string="Apply to lines" type="object" context="{'field_name': 'stock_take', 'type': 'sale.order'}" icon="gtk-indent" attrs="{'invisible': [('state', 'not in', ('draft', 'draft_p', 'validated', 'sourced', 'sourced_p', 'confirmed', 'confirmed_p'))]}"/>
                            </group>
                            <button colspan="4" string="Round Qty to SoQ" type="object" name="round_to_soq" icon="gtk-execute" attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                            <newline/>
                            <group name="import" string=" Import Lines " colspan="4" attrs="{'invisible':[('state', 'not in', ['draft', 'draft_p', 'validated', 'validated_p'])]}">
                                <button name="wizard_import_fo_line" string="Import lines" icon="gtk-dnd" colspan="1" type="object" attrs="{'invisible':[('state', '!=', 'draft')]}"/>
                                <button name="wizard_import_ad" string="Import AD" icon="terp-stock_symbol-selection" colspan="1" type="object" attrs="{'invisible':[('state', '!=', 'draft')]}"/>
                                <button name="button_cancel_lines" string="Cancel Lines" icon="gtk-remove" colspan="1" type="object"/>
                                <button name="check_lines_to_fix" string="Check Lines" icon="gtk-dialog-warning" colspan="1" type="object" invisible="0" attrs="{'invisible':[('state', '!=', 'draft')]}"/>
                                <newline/>
                                <button name="add_multiple_lines" string="Add multiple lines" icon="gtk-add" colspan="4" type="object" attrs="{'invisible':[('state', '!=', 'draft')]}"/>
                            </group>
                            <field name="order_line" colspan="4" mode="tree,form,graph" nolabel="1" widget="one2many_list"
                                context="{'sale_id': active_id, 'pricelist_id': pricelist_id, 'categ': categ, 'partner_id': partner_id, 'fo_created_by_po_sync': fo_created_by_po_sync}"
                                on_change="order_line_change(order_line)"
                                filter_selector="[('Show all', []), ('Hide closed', [('state', 'not in', ['done', 'cancel', 'cancel_r'])]), ('Show closed only', [('state', '=', 'done')]), ('Hide cancelled', [('state', 'not in', ['cancel', 'cancel_r'])]), ('Show cancelled only', [('state', 'in', ['cancel', 'cancel_r'])])]"
                                default_selector="'3'" o2m_selectable="2"
                                >
                                <form string="Sales Order Lines">
                                    <notebook>
                                        <page string="Order Line">
                                            <field colspan="4" context="categ=parent.categ,partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,warehouse=parent.warehouse_id,uom=product_uom,available_for_restriction=parent.partner_type,search_default_not_restricted=1" name="product_id" on_change="product_id_on_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], True, parent.date_order, product_packaging, parent.fiscal_position, False, context)" domain="[('sale_ok', '=', True)]" default_focus="1"/>
                                            <field name="product_uom_qty" context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom" on_change="product_qty_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order, product_packaging, parent.fiscal_position, True, price_unit, context)"/>
                                            <field groups="product.group_uos" name="product_uos_qty" invisible="1"/>
                                            <field groups="product.group_uos" name="product_uos" invisible="1"/>
                                            <field name="product_uom" on_change="onchange_uom(product_id, product_uom, product_uom_qty)" domain="[('uom_by_product', '=', product_id)]"/>
                                            <field name="product_packaging" context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom" on_change="product_packaging_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order, product_packaging, parent.fiscal_position, False)" domain="[('product_id','=',product_id)]" invisible="1"/>
                                            <newline/>
                                            <field name="price_unit" on_change="change_price_unit(product_uom_qty, price_unit, context)"/>
                                            <field name="supplier" invisible="True"/>
                                            <field name="po_cft" invisible="True"/>
                                            <field name="currency_id" invisible="False"/>
                                            <newline/>
                                            <field name="functional_subtotal"/>
                                            <field name="functional_currency_id"/>
                                            <field name="discount"/>
                                            <field name="type" on_change="requested_type_change(product_id, type)"/>
                                            <field name="so_state_stored" invisible="True"/>
                                            <field name="date_planned" attrs="{'readonly': [('state', 'not in', ['draft', 'validated'])]}"/>
                                            <field name="esti_dd" attrs="{'readonly': [('state', 'not in', ['draft', 'validated'])]}"/>
                                            <field name="confirmed_delivery_date" attrs="{'readonly': [('so_state_stored', 'in', ('cancel','done'))]}"/>
                                            <field name="stock_take_date"/>
                                            <field name="display_resourced_orig_line"/>
                                            <field name="sync_linked_pol" invisible="True"/>
                                            <field name="sync_sourced_origin" invisible="True"/>
                                            <group invisible="not context.get('fo_created_by_po_sync')" colspan="2">
                                                <field name="instance_sync_order_ref" domain="[('order_id', '=', context.get('sale_id', 0))]" attrs="{'invisible': [('sync_linked_pol', '!=', False)], 'readonly': ['|', ('state', '!=', 'draft'), ('sync_sourced_origin', '!=', False)]}" on_change="on_change_instance_sync_order_ref(instance_sync_order_ref)"/>
                                            </group>
                                            <separator colspan="4" string="Changes"/>
                                            <group colspan="4">
                                                <group colspan="2">
                                                    <field name="original_product" colspan="1" readonly="1"/>
                                                    <field name="original_qty" colspan="1" readonly="1"/>
                                                    <field name="original_price" colspan="1" readonly="1"/>
                                                    <field name="original_uom" colspan="1" readonly="1"/>
                                                </group>
                                                <field name="modification_comment" colspan="2"/>
                                            </group>
                                            <newline/>
                                            <field name="vat_ok" invisible="1"/>
                                            <group colspan="4" col="4" attrs="{'invisible': [('vat_ok', '=', False)]}">
                                                <separator colspan="5" string="Taxes"/>
                                                <field colspan="4" name="tax_id" nolabel="1" domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]"/>
                                            </group>
                                            <group colspan="4" col="5" groups="base.group_extended">
                                                <separator colspan="5" string="States"/>
                                                <field name="state"/>
                                                <field name="invoiced" invisible="1"/>
                                                <group attrs="{'invisible':[('invoiced','=',True)]}">
                                                 </group>
                                            </group>
                                        </page>
                                        <page string="Nomenclature Selection">
                                            <group colspan="4" col="2">
                                                <field name="nomenclature_code" colspan="2" invisible="True"/>
                                                <field name="nomenclature_description" colspan="2" readonly="True"/>
                                                <field name="comment" colspan="2" attrs="{'required':[('product_id', '=', False)]}"/>
                                            </group>
                                            <newline/>
                                            <group colspan="2" col="5">
                                                <separator string="Mandatory Levels" colspan="5"/>
                                                <group colspan="4" col="2">
                                                    <field name="nomen_manda_0" domain="[('level', '=', '0'), ('type', '=', 'mandatory')]" widget="selection" on_change="onChangeSearchNomenclature(0, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)" attrs="{'required':[('product_id', '=', False)], 'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_manda_1" domain="[('level', '=', '1'), ('type', '=', 'mandatory')]" widget="selection" get_selection="get_nomen" on_change="onChangeSearchNomenclature(1, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)" attrs="{'required':[('product_id', '=', False)], 'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_manda_2" domain="[('level', '=', '2'), ('type', '=', 'mandatory'), ('category_id', '!=', False)]" widget="selection" get_selection="get_nomen" on_change="onChangeSearchNomenclature(2, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)" attrs="{'required':[('product_id', '=', False)], 'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_manda_3" domain="[('level', '=', '3'), ('type', '=', 'mandatory')]" widget="selection" get_selection="get_nomen" on_change="onChangeSearchNomenclature(3, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                </group>
                                            </group>
                                            <group colspan="2" col="5">
                                                <separator string="Optional Levels" colspan="4"/>
                                                <group colspan="4" col="2">
                                                    <field name="nomen_sub_0" domain="[('type', '=', 'optional'), ('id', 'in', [0])]" widget="selection" get_selection="get_sub_nomen" on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_sub_1" domain="[('type', '=', 'optional'), ('id', 'in', [0])]" widget="selection" get_selection="get_sub_nomen" on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_sub_2" domain="[('type', '=', 'optional'), ('id', 'in', [0])]" widget="selection" get_selection="get_sub_nomen" on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_sub_3" domain="[('type', '=', 'optional'), ('id', 'in', [0])]" widget="selection" get_selection="get_sub_nomen" on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_sub_4" domain="[('type', '=', 'optional'), ('id', 'in', [0])]" widget="selection" get_selection="get_sub_nomen" on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                    <field name="nomen_sub_5" domain="[('type', '=', 'optional'), ('id', 'in', [0])]" widget="selection" get_selection="get_sub_nomen" on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)" attrs="{'readonly':[('product_id', '!=', False)]}"/>
                                                </group>
                                            </group>
                                        </page>
                                        <page string="Notes">
                                            <field colspan="4" name="notes" nolabel="1"/>
                                        </page>
                                    </notebook>
                                    <newline/>
                                    <field name="to_correct_ok" readonly="1" invisible="1"/>
                                    <field name="show_msg_ok" readonly="1" invisible="1"/>
                                    <field name="inactive_product" invisible="1"/>
                                    <group attrs="{'invisible': [('text_error', '=', False), ('inactive_error', '=', False)]}">
                                        <html>
                                            <style>
                                    #error_message_unifield 
                                    {
                                        border-style: solid;
                                        border-width: 1px;
                                        border-radius: 5px;
                                        border-color: black;
                                        background-color: #F0EBA4;
                                    }

                                    #view_form #error_message_unifield .readonlyfield
                                    {
                                        border-style: none;
                                        padding: 5px;
                                        color: red;
                                        background-color: #F0EBA4;
                                        font-weight: bold;
                                        text-transform: uppercase;
                                        width: 98%%;
                                    }

                                    #error_message_unifield p, #error_message_unifield span
                                    {
                                        height: 1em;
                                        min-height: 1em;
                                        color: red;
                                        font-weight: bold;
                                        text-transform: uppercase;
                                        padding: 5px;
                                        width: 90%%;
                                    }
                                </style>
                                            <div id="error_message_unifield">
                                                <field name="text_error" nolabel="1" readonly="1" colspan="4" attrs="{'invisible': [('to_correct_ok', '=', False), '|', ('show_msg_ok', '!=',True)]}"/>
                                                <field name="inactive_error" attrs="{'invisible': [('inactive_product', '=', False)]}" nolabel="1" colspan="6"/>
                                            </div>
                                        </html>
                                    </group>
                                    <newline/>
                                </form>
                                <tree string="Sales Order Lines" hide_delete_button="True" colors="red:to_correct_ok == True or inactive_product == True;blue:soq_updated == True" noteditable="fake_state not in ['draft', 'validated']" button_attrs="{'invisible': [('state', 'not in', ['draft', 'draft_p'])]}">
                                    <button name="tree_button" string="Add Line" attrs="{'invisible': [('state', '!=', 'validated')]}" />
                                    <button name="get_error" type="object" icon="gtk-dialog-warning" string="Show error" attrs="{'invisible': [('to_correct_ok', '=', False), ('inactive_product', '=', False)]}" />
                                    <field name="line_number"/>
                                    <field name="default_code"/>
                                    <field name="default_name"/>
                                    <field name="comment"/>
                                    <field name="nomenclature_description"/>
                                    <field name="product_uom_qty" string="Qty"/>
                                    <field name="original_changed" readonly="1"/>
                                    <field name="product_uom" string="UoM"/>
                                    <field name="kc_dg"/>
                                    <field name="date_planned"/>
                                    <field name="confirmed_delivery_date"/>
                                    <field name="discount"/>
                                    <field name="stock_take_date"/>
                                    <field name="price_subtotal"/>
                                    <field name="currency_id"/>
                                    <field name="kit_pol_check_sale_order_line" invisible="True"/>
                                    <field name="so_state_stored" invisible="True"/>
                                    <button name="de_kitting" context="{'product_id': product_id}" string="Replace with kit components..." type="object" icon="gtk-dnd-multiple" attrs="{'invisible':['|', ('kit_pol_check_sale_order_line', '=', False), ('so_state_stored', 'not in', ['draft', 'validated'])]}"/>
                                    <button name="button_analytic_distribution" string="Analytical distribution" type="object" icon="terp-stock_symbol-selection"/>
                                    <field name="analytic_distribution_state_recap"/>
                                    <field name="account_4_distribution" string="Acc. for Ana. Distrib." invisible="1"/>
                                    <field name="fake_state" invisible="1"/>
                                    <field name="state_to_display"/>
                                    <field name="to_correct_ok" invisible="1"/>
                                    <field name="inactive_product" invisible="1"/>
                                    <field name="soq_updated" invisible="1" readonly="1"/>
                                    <button string="Split line" icon="terp-stock_effects-object-colorize" name="open_split_wizard" type="object" attrs="{'invisible': [('fake_state', '!=', 'validated')]}"/>
                                    <button string="Validate" icon="terp-check" name="validated" type="workflow" attrs="{'invisible': [('fake_state', '!=', 'draft')]}" header="True"/>
                                    <button string="Cancel" icon="gtk-del" name="open_delete_sale_order_line_wizard" type="object" attrs="{'invisible': [('fake_state', 'not in', ('draft', 'validated'))]}"/>
                                </tree>
                            </field>
                            <newline/>
                        </page>
                        <page string="Order dates">
                            <group colspan="4" col="4" name="date">
                                <separator colspan="4" string="Dates"/>
                                <group colspan="2" col="3">
                                    <field name="delivery_requested_date" required="1" attrs="{'readonly': [('state', 'not in', ['draft', 'draft_p', 'validated', 'sourced', 'sourced_p', 'confirmed', 'confirmed_p'])]}" on_change="onchange_requested_date(partner_id,date_order,delivery_requested_date,est_transport_lead_time,context)"/>
                                    <button colspan="1" name="update_date" string="Apply to lines" type="object" context="{'field_name': 'requested', 'type': 'sale.order'}" icon="gtk-indent" attrs="{'invisible': [('state', 'not in', ['draft', 'draft_p', 'validated', 'sourced', 'sourced_p', 'confirmed', 'confirmed_p'])]}"/>
                                </group>
                                <group colspan="2" col="3">
                                    <field name="delivery_confirmed_date" attrs="{'readonly': [('state', 'in', ['cancel','done'])]}"/>
                                    <button colspan="1" name="update_date" string="Apply to lines" type="object" context="{'field_name': 'confirmed', 'type': 'sale.order'}" icon="gtk-indent" attrs="{'invisible': [('state', 'in', ('cancel', 'done'))]}"/>
                                </group>
                                <field name="transport_type" attrs="{'readonly': [('state', 'not in', ['draft', 'draft_p', 'validated'])]}" on_change="onchange_transport_type(partner_id,transport_type,delivery_requested_date,context)"/>
                                <field name="est_transport_lead_time" attrs="{'readonly': [('state', 'not in', ['draft', 'draft_p', 'validated'])]}" on_change="onchange_transport_lt(delivery_requested_date,est_transport_lead_time,context)"/>
                                <field name="ready_to_ship_date" attrs="{'readonly': ['|', ('shipped', '=', True), ('state', 'not in', ['draft', 'draft_p', 'validated'])]}"/>
                                <field name="shipment_date" readonly="1"/>
                            </group>
                        </page>
                        <page string="Other Information">
                            <group colspan="2" col="2" groups="base.group_extended" name="logistics">
                                <separator string="Logistic" colspan="2"/>
                                <field name="intl_customer_ok" invisible="1"/>
                                <field name="incoterm" attrs="{'invisible': [('intl_customer_ok', '=', False)]}" widget="selection"/>
                                <field name="picking_policy" required="True" invisible="1"/>
                                <field name="order_policy" on_change="shipping_policy_change(order_policy)"/> <!-- RO on _columns -->
                                <field name="invoice_quantity" readonly="1"/>
                            </group>
                            <group colspan="2" col="2">
                                <separator string="References" colspan="2"/>
                                <field name="user_id" attrs="{'readonly': [('state', '!=', 'state')]}"/>
                                <field name="origin" readonly="1" />
                            </group>
                            <group colspan="2" col="2">
                                <group colspan="2" col="2" attrs="{'invisible': [('vat_ok', '=', False)]}">
                                    <separator string="Conditions" colspan="2"/>
                                </group>
                                <field name="payment_term" widget="selection"  invisible="1"/>
                                <field name="fiscal_position" widget="selection" readonly="1" attrs="{'invisible': [('vat_ok', '=', False)]}"/>
                                <field name="company_id" widget="selection" groups="base.group_multi_company"/>
                            </group>
                            <group colspan="2" col="2" groups="base.group_extended">
                            </group>
                            <separator colspan="4" string="Notes"/>
                            <field name="import_in_progress" invisible="0" readonly="1"/>
                            <field colspan="4" name="note" nolabel="1"/>
                        </page>
                        <page string="History" attrs="{'invisible': [( 'intl_customer_ok', '=', False )]}">
                            <separator colspan="4" string="Invoices"/>
                            <field colspan="4" name="invoice_ids" nolabel="1" context="{'form_view_ref':'account.invoice_form'}"/>
                        </page>
                        <page string="Sourcing Logs" attrs="{'invisible': [('sourcing_trace_ok', '=', False)]}">
                            <field name="sourcing_trace" colspan="4" nolabel="1"/>
                        </page>
                    </notebook>
                    <field name="vat_ok" invisible="1"/>
                    <group col="13" colspan="10">
                        <field name="currency_id" readonly="1"/>
                        <field name="amount_untaxed" sum="Untaxed amount" attrs="{'invisible': [('vat_ok', '=', False)]}"/>
                        <field name="amount_tax" attrs="{'invisible': [('vat_ok', '=', False)]}"/>
                        <field name="amount_total"/>
                        <button name="button_dummy" states="draft,draft_p" string="Compute" type="object" icon="gtk-execute"/>
                        <newline/>
                        <field name="functional_currency_id" readonly="1"/>
                        <field name="functional_amount_untaxed" attrs="{'invisible': [('vat_ok', '=', False)]}"/>
                        <field name="functional_amount_tax" attrs="{'invisible': [('vat_ok', '=', False)]}"/>
                        <field name="functional_amount_total"/>
                    </group>
                    <group col="14" colspan="4">
                        <field name="state" invisible="True"/>
                        <field name="state_hidden_sale_order"/>
                        <button name="invoice_recreate" states="invoice_except" string="Recreate Invoice" icon="gtk-go-forward"/>
                        <button name="invoice_corrected" states="invoice_except" string="Ignore Exception" icon="gtk-apply"/>
                        <button name="ship_corrected" states="shipping_except" string="Manually corrected" icon="gtk-apply"/>
                        <button name="manual_invoice" states="manual" string="Create Final Invoice" icon="gtk-go-forward" type="object" invisible="1"/>
                        <button name="ship_cancel" states="shipping_except" string="Cancel document" icon="gtk-cancel" help="all the lines will be Cancelled where this status change is feasible" />
                        <button name="ask_resource_lines" states="draft,draft_p,validated,validated_p" string="Cancel document" type="object" icon="gtk-cancel" help="all the lines will be Cancelled where this status change is feasible" />
                        <button name="order_confirm" states="validated" string="Confirm document" icon="gtk-apply" invisible="True" help="all the lines will be Confirmed where this status change is feasible" />
                        <button name="do_order_confirm_method" type="object" states="validated" string="Confirm document" help="all the lines will be Confirmed where this status change is feasible" icon="gtk-apply" confirm="You are about to confirm the Field Order without going through the sourcing tool. Are you sure?" attrs="{'readonly': [('no_line', '=', True)]}"/>
                        <button name="validate_lines" type="object" string="Validate document" icon="terp-check" states="draft,draft_p" attrs="{'readonly': [('no_line', '=', True)]}" help="all the lines will be Validated where this status change is feasible" />
                    </group>
                </form>
            </field>
        </record>


        <record id="view_sales_order_filter" model="ir.ui.view">
            <field name="name">sale.order.list.select</field>
            <field name="model">sale.order</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Sales Order">
                    <filter icon="terp-document-new" string="Draft" domain="[('state','in',['draft','draft_p'])]" help="Field Order that haven't yet been confirmed" />
                    <filter icon="terp-check" string="Validated" domain="[('state','in',['validated','validated_p'])]" help="Field Order validated"/>
                    <filter icon="gtk-paste-v" name="sourced" string="Sourced" domain="[('state','in',['sourced','sourced_p'])]" separator="1" />
                    <filter icon="terp-camera_test" string="Confirmed" domain="[('state','in',('confirmed','confirmed_p'))]"/>
                    <filter icon="terp-dialog-close" name="done" string="Closed" domain="[('state','=','done')]"/>
                    <filter icon="gtk-cancel" name="cancelled" string="Cancelled" domain="[('state','=','cancel')]"/>
                    <separator orientation="vertical"/>
                    <filter icon="terp-dolar_ok!" string="To Invoice" domain="[('state','=','manual')]" help="Sales Order ready to be invoiced"/>

                    <separator orientation="vertical"/>
                    <field name="name" select="1"/>
                    <field name="client_order_ref" />
                        <field name="date_order" attrs="{'readonly': [('state_hidden_sale_order', 'not in', ['draft'])]}"
                            on_change="onchange_date_order(partner_id,date_order,est_transport_lead_time,context)"/>
                    <field name="partner_id" select="1"/>
                    <field name="user_id" select="1">
                        <filter domain="[('user_id','=',uid)]" help="My Sale Orders" icon="terp-personal"/>
                    </field>
                    <newline />
                    <field name="product_id" />
                    <newline />
                    <group string="Type" expand="0">
                        <filter icon="terp-check" string="Regular" domain="[('order_type','=','regular')]"/>
                        <filter icon="terp-stage" string="Donation before expiry" domain="[('order_type','=','donation_exp')]"/>
                        <filter icon="terp-gtk-jump-to-ltr" string="Standard Donation" domain="[('order_type','=','donation_st')]"/>
                        <filter icon="terp-partner" string="Loan" domain="[('order_type','=','loan')]"/>
                        <filter icon="terp-partner" string="Loan Return" domain="[('order_type','=','loan_return')]"/>
                    </group>
                    <newline />
                    <group string="Priority" expand="0">
                        <filter icon="gtk-dialog-warning" string="Emergency" domain="[('priority','=','emergency')]"/>
                        <filter icon="gtk-yes" string="Normal" domain="[('priority','=','normal')]"/>
                        <filter icon="gtk-info" string="Priority" domain="[('priority','=','priority')]"/>
                    </group>
                    <newline />
                    <group string="Category" expand="0">
                        <filter icon="gtk-color-picker" string="Medical" domain="[('categ','=','medical')]"/>
                        <filter icon="terp-stock" string="Logistic" domain="[('categ','=','log')]"/>
                        <filter icon="terp-purchase" string="Service" domain="[('categ','=','service')]"/>
                        <filter icon="gtk-network" string="Other" domain="[('categ','=','other')]"/>
                    </group>
                    <newline />
                    <newline/>
                    <group expand="0" string="Group By..." colspan="11" col="11" groups="base.group_extended">
                        <filter string="Order Type" icon="terp-rating-rated" domain="[]" context="{'group_by':'order_type'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Priority" icon="terp-project" domain="[]" context="{'group_by':'priority'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Category" icon="terp-translate" domain="[]" context="{'group_by':'categ'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Customer" icon="terp-personal" domain="[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Salesman" icon="terp-personal" domain="[]" context="{'group_by':'user_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Order Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_order'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="action_order_form" model="ir.actions.act_window">
            <field name="name">Sales Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="search_view_id" ref="view_sales_order_filter"/>
            <field name="context">{"search_default_user_id":uid}</field>
            <field name="help">Sales Orders help you manage quotations and orders from your customers. OpenERP suggests that you start by creating a quotation. Once it is confirmed, the quotation will be converted into a Sales Order. OpenERP can handle several types of products so that a sales order may trigger tasks, delivery orders, manufacturing orders, purchases and so on. Based on the configuration of the sales order, a draft invoice will be generated so that you just have to confirm it when you want to bill your customer.</field>
        </record>

        <menuitem action="sale.action_order_form" id="sale.menu_sale_order" parent="base.menu_sales" sequence="1" />
        <menuitem action="base.action_partner_form"
                  id="base.menu_partner_form"
                  parent="base.menu_sales"
                  sequence="4" />
        <menuitem id="base.menu_base_partner" sequence="3" />
        <menuitem id="menu_localisation" name="Localisation" parent="base.menu_administration" sequence="1"/>
        <menuitem action="base.action_country" id="menu_country_partner" parent="menu_localisation" sequence="0"/>
        <menuitem action="base.action_country_state" id="menu_country_state_partner" parent="menu_localisation" sequence="1"/>

        <record id="sale_order_sourcing_progress_action" model="ir.actions.act_window">
            <field name="name">Sourcing progress</field>
            <field name="res_model">sale.order.sourcing.progress</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
        </record>
        <menuitem
            action="sale_order_sourcing_progress_action"
            id="sale_order_sourcing_progress_menu"
            parent="base.menu_sales" />


        <record id="action_order_tree2" model="ir.actions.act_window">
            <field name="name">Sales in Exception</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="domain">[('state','in',('shipping_except','invoice_except'))]</field>
            <field name="filter" eval="True"/>
            <field name="search_view_id" ref="view_sales_order_filter"/>
        </record>

        <record id="action_order_tree4" model="ir.actions.act_window">
            <field name="name">Sales Order in Progress</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="domain">[('state','in',('progress','waiting_date','manual'))]</field>
            <field name="search_view_id" ref="view_sales_order_filter"/>
        </record>


        <record id="action_order_tree5" model="ir.actions.act_window">
            <field name="name">All Quotations</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="domain">[('state','=','draft')]</field>
            <field name="search_view_id" ref="view_sales_order_filter"/>
        </record>

        <record id="action_order_tree" model="ir.actions.act_window">
            <field name="name">Old Quotations</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="domain">[('state','=','draft'),('date_order','&lt;',time.strftime('%Y-%m-%d %H:%M:%S'))]</field>
            <field name="filter" eval="True"/>
            <field name="search_view_id" ref="view_sales_order_filter"/>
        </record>

        <record id="view_order_line_graph" model="ir.ui.view">
            <field name="name">sale.order.line.graph</field>
            <field name="model">sale.order.line</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph string="Sales Order Lines">
                    <field name="product_id"/>
                    <field name="price_subtotal" operator="+"/>
                </graph>
            </field>
        </record>

        <record id="view_order_line_tree" model="ir.ui.view">
            <field name="name">sale.order.line.tree</field>
            <field name="model">sale.order.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Sales Order Lines">
                    <field name="order_id"/>
                    <field name="order_partner_id"/>
                    <field name="product_id"/>
                    <field name="product_uom_qty" string="Qty"/>
                    <field name="product_uom" string="UoM"/>
                    <field name="salesman_id"/>
                    <field name="price_subtotal" sum="Total"/>
                    <field name="state"/>
                    <field name="invoiced"/>
                </tree>
            </field>
        </record>
        <record id="view_order_line_form2" model="ir.ui.view">
            <field name="name">sale.order.line.form2</field>
            <field name="model">sale.order.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Sales Order Lines">
                    <group colspan="4" col="6">
                        <field name="order_id"/>
                        <field name="order_partner_id" readonly="1" invisible="1"/>
                        <field name="invoiced"/>

                        <field name="product_id" readonly="1"/>
                        <field name="product_uom_qty" readonly="1"/>
                        <field name="product_uom"/>

                        <field colspan="4" name="name" groups="base.group_extended"/>
                        <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                    </group>
                    <separator colspan="4" string="Price"/>
                    <group colspan="4" col="6">
                        <field name="price_unit"/>
                        <field name="discount"/>
                        <field name="price_subtotal"/>
                    </group>
                    <separator colspan="4" string="Notes"/>
                    <field colspan="4" name="notes" nolabel="1"/>
                    <separator colspan="4"/>
                    <field name="state"/>
                    <group col="3" colspan="2">
                        <button name="button_cancel"
                            string="Cancel" type="object"
                            icon="gtk-cancel"
                            states="confirmed,exception"/>
                        <button name="button_done"
                            string="Done" type="object"
                            states="confirmed,exception"
                            icon="gtk-go-forward" />
                    </group>
                </form>
            </field>
        </record>

        <record id="view_sales_order_line_filter" model="ir.ui.view">
            <field name="name">sale.order.line.select</field>
            <field name="model">sale.order.line</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Sales Order">
                    <filter icon="terp-dolar_ok!" string="To Invoice" domain="['&amp;', ('invoiced','&lt;&gt;', 1),('state','=','done')]" separator="1" help="Sale Order Lines ready to be invoiced"/>
                    <separator orientation="vertical"/>
                    <field name="order_id"/>
                    <field name="order_partner_id"/>
                    <field name="product_id"/>
                    <field name="salesman_id">
                        <filter icon="terp-personnal" domain="[('salesman_id','=',uid)]" help="Sales Order Lines related to a Sales Order of mine"/>
                    </field>
                    <newline/>
                    <group expand="context.get('report',False)" string="Group By..." colspan="9" col="8">
                        <filter string="Product" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'product_id'}"/>
                        <filter string="Order" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'order_id'}"/>
                        <filter string="Salesman" icon="terp-personal" domain="[]" context="{'group_by':'salesman_id'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_sales_order_uninvoiced_line_filter" model="ir.ui.view">
            <field name="name">sale.order.uninvoiced.line</field>
            <field name="model">sale.order.line</field>
            <field name="type">search</field>
            <field name="priority">17</field>
            <field name="arch" type="xml">
                <search string="Search Uninvoiced Lines">
                    <filter icon="terp-gtk-go-back-rtl" string="To Do"
                        domain="[('state','=','confirmed')]"
                        name="sale order"
                        help="Confirmed sale order lines, not yet delivered"
                        />
                    <filter icon="terp-dialog-close" string="Done"
                        domain="[('state','=','done')]"
                        name="sale_order_done"
                        help="Sale order lines done"
                        />
                    <separator orientation="vertical"/>
                    <filter icon="terp-accessories-archiver" string="Shipped"
                        domain="[('state','=','done')]"
                        name="unshipped"
                        help="Sale Order Lines that are in 'done' state"
                        />
                    <filter icon="terp-dolar_ok!" string="Uninvoiced" name="uninvoiced"
                        domain="[('invoiced','&lt;&gt;', 1),('state','&lt;&gt;','draft'),('state','&lt;&gt;','cancel')]"
                        help="Sale Order Lines that are confirmed, done or in exception state and haven't yet been invoiced"
                        />
                    <separator orientation="vertical"/>
                    <field name="order_id"/>
                    <field name="order_partner_id"/>
                    <field name="product_id"/>
                    <field name="salesman_id">
                        <filter icon="terp-personal" domain="[('salesman_id','=',uid)]" help="My Sales Order Lines"/>
                    </field>
                    <newline />
                    <group expand="0" string="Group By..." colspan="9" col="8">
                        <filter string="Order" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'order_id'}" help="Order reference"/>
                        <filter string="Product" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'product_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_order_line_tree2" model="ir.actions.act_window">
            <field name="name">Lines to Invoice</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="search_view_id" ref="view_sales_order_uninvoiced_line_filter" />
            <field name="context">{"search_default_uninvoiced":1}</field>
            <field name="filter" eval="True"/>
            <field name="help">Here is a list of each sales order line to be invoiced. You can invoice sales orders partially, by lines of sales order. You do not need this list if you invoice from the delivery orders or if you invoice sales totally.</field>
        </record>

        <record id="action_order_line_tree3" model="ir.actions.act_window">
            <field name="name">Uninvoiced and Delivered Lines</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="domain">[('invoiced','&lt;&gt;', 1),('state','=','done')]</field>
            <field name="filter" eval="True"/>
        </record>

        <menuitem id="menu_invoiced" name="Invoicing" parent="base.menu_base_partner" sequence="5"
            groups="base.group_extended"/>
        <menuitem action="action_order_line_tree2" id="menu_invoicing_sales_order_lines" parent="menu_invoiced" sequence="2" groups="base.group_sale_salesman,base.group_sale_manager"/>
        <!-- configartion view -->

        <record id="view_config_picking_policy" model="ir.ui.view">
            <field name="name">Configure Picking Policy for Sales Order </field>
            <field name="model">sale.config.picking_policy</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="base.res_config_view_base"/>
            <field name="arch" type="xml">
              <data>
                <form position="attributes">
                  <attribute name="string">Sales Application Configuration</attribute>
                </form>
                <separator string="title" position="attributes">
                <attribute name="string">Configure Sales Order Logistics</attribute>
                  </separator>
                  <xpath expr="//label[@string='description']" position="attributes">
                    <attribute name="string">Setup your sales workflow and default values.</attribute>
                  </xpath>
                <xpath expr='//separator[@string="vsep"]' position='attributes'>
                      <attribute name='rowspan'>15</attribute>
                      <attribute name='string'></attribute>
                  </xpath>
                <group string="res_config_contents" position="replace">
                  <field name="picking_policy" groups="base.group_extended"/>
                  <newline/>
                  <field name="order_policy"/>
                  <newline/>
                  <field name="step"/>
                </group>
                <xpath expr='//button[@name="action_skip"]' position='replace'/>
              </data>
            </field>
        </record>

        <record id="action_config_picking_policy" model="ir.actions.act_window">
            <field name="name">Configure Picking Policy for Sales Order</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.config.picking_policy</field>
            <field name="view_id" ref="view_config_picking_policy"/>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>

        <!-- register configuration wizard -->
        <record id="config_wizard_step_sale_picking_policy" model="ir.actions.todo">
            <field name="action_id" ref="action_config_picking_policy"/>
            <field name="restart">always</field>
            <field name="groups_id" eval="[(6,0,[ref('base.group_extended')])]"/>
        </record>


        <record id="view_order_line_to_correct_form" model="ir.ui.view">
            <field name="name">sale.order.line.to.correct.form</field>
            <field name="model">sale.order.line</field>
            <field name="type">form</field>
            <field name="priority" eval="17" />
            <field name="arch" type="xml">
            <form>
                  <notebook>
                      <page string="Order Line">
                         <field name="product_id" colspan="4" on_change="requested_product_id_change(product_id, comment)" />
                         <field name="product_uom_qty" />
                         <field name="product_uom" on_change="onchange_uom(product_id, product_uom, product_uom_qty)"/>
                         <field name="price_unit" invisible="1"/>
                         <field name="currency_id" />
                         <field name="date_planned" />
                         <field name="type" on_change="requested_type_change(product_id, type)"/>
                         <field name="my_company_id" invisible="1" />
                         <field name="supplier"
                                context="{'product_id': product_id, 'choose_supplier': True}"
                                attrs="{'readonly': [('type', '=', 'make_to_stock')]}"
                                domain="[('supplier', '=', True), ('id', '!=', my_company_id), ('check_partner_ir', '=', True)]"
                             />
                         <newline />
                         <field name="state"/>
                     </page>

                      <!-- EXACT COPY-PASTE FROM product_nomenclature_view.xml -->
                      <page string="Nomenclature Selection">
                      
                          <group colspan="4" col="2">
                              
                              <field name="nomenclature_code" colspan="2" invisible="True" />
                              <field name="nomenclature_description" colspan="2" readonly="True" />
                              <field name="comment" colspan="2" 
                              on_change="comment_change(comment,product_id,nomen_manda_0)"
                              attrs="{'required':[('product_id', '=', False)]}" />
                          
                          </group>
                          <newline />

                          <group colspan="2" col="5">
                              <separator string="Mandatory Levels" colspan="5" />

                              <group colspan="4" col="2">
                                  <field name="nomen_manda_0"
                                      domain="[('level', '=', '0'), ('type', '=', 'mandatory')]"
                                      widget="selection"
                                      on_change="onChangeSearchNomenclature(0, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                                      attrs="{'required':[('product_id', '=', False)], 'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_manda_1"
                                      domain="[('level', '=', '1'), ('type', '=', 'mandatory')]"
                                      widget="selection"
                                      get_selection="get_nomen"
                                      on_change="onChangeSearchNomenclature(1, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                                      attrs="{'required':[('product_id', '=', False)], 'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_manda_2"
                                      domain="[('level', '=', '2'), ('type', '=', 'mandatory')]"
                                      widget="selection"
                                      get_selection="get_nomen"
                                      on_change="onChangeSearchNomenclature(2, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                                      attrs="{'required':[('product_id', '=', False)], 'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_manda_3"
                                      domain="[('level', '=', '3'), ('type', '=', 'mandatory')]"
                                      widget="selection"
                                      get_selection="get_nomen"
                                      on_change="onChangeSearchNomenclature(3, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                              </group>

                          </group>

                          <group colspan="2" col="5">
                              <separator string="Optional Levels" colspan="4" />


                              <group colspan="4" col="2">
                                  <field name="nomen_sub_0"
                                      domain="[('type', '=', 'optional'), ('id', 'in', [0])]"
                                      widget="selection"
                                      get_selection="get_sub_nomen"
                                      on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_sub_1"
                                      domain="[('type', '=', 'optional'), ('id', 'in', [0])]"
                                      widget="selection"
                                      get_selection="get_sub_nomen"
                                      on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_sub_2"
                                      domain="[('type', '=', 'optional'), ('id', 'in', [0])]"
                                      widget="selection"
                                      get_selection="get_sub_nomen"
                                      on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_sub_3"
                                      domain="[('type', '=', 'optional'), ('id', 'in', [0])]"
                                      widget="selection"
                                      get_selection="get_sub_nomen"
                                      on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_sub_4"
                                      domain="[('type', '=', 'optional'), ('id', 'in', [0])]"
                                      widget="selection"
                                      get_selection="get_sub_nomen"
                                      on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                                  <field name="nomen_sub_5"
                                      domain="[('type', '=', 'optional'), ('id', 'in', [0])]"
                                      widget="selection"
                                      get_selection="get_sub_nomen"
                                      on_change="onChangeSubNom(nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, nomen_sub_0, nomen_sub_1, nomen_sub_2, nomen_sub_3, nomen_sub_4, nomen_sub_5)"
                                      attrs="{'readonly':[('product_id', '!=', False)]}" 
                                  />
                              </group>

                          </group>
                      </page>
                      <!-- END COPY -->

                  </notebook>
                  
                  <newline/>
                  <field name="to_correct_ok" readonly="1" invisible="1"/>
                  <field name="show_msg_ok" readonly="1" invisible="1"/>
                  <field name="text_error" 
                  nolabel="1" 
                  readonly="1" 
                  colspan="3" 
                  attrs="{'invisible': [('to_correct_ok', '=', False), '|', ('show_msg_ok', '!=',True)]}"/>
                  <newline/>
                  <button 
                  name="save_and_close" 
                  string="Save and Close"
                  type="object" 
                  icon="gtk-close" />
                  <button
                  name="ask_unlink"
                  type="object"
                  string="Delete"
                  icon="gtk-cancel"
                  invisible="True"
                  confirm="This button shouldn't be use from form view. Please use the red cross on list view." />
              </form>
            </field>
        </record>
              
        <record id="sale_order_unlink_wizard" model="ir.ui.view">
            <field name="name">sale.order.unlink.wizard</field>
            <field name="model">sale.order.unlink.wizard</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Delete Field Order">
                    <group colspan="4" col="1">
                        <html>
                            <h4 style="text-align: center; margin: 10px">You removed all lines of this field order, would you cancel it ?</h4>
                        </html>
                    </group>
                    <newline />
                    <button colspan="2" type="object" icon="gtk-execute" name="cancel_fo" string="Yes" />
                    <button colspan="2" type="object" icon="gtk-execute" name="close_window" string="No" />
                </form>
            </field>
        </record>

        <record id="sale_order_cancelation_wizard_form_view" model="ir.ui.view">
            <field name="name">sale.order.cancelation.wizard.form.view</field>
            <field name="model">sale.order.cancelation.wizard</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Cancel Field Order">
                    <group colspan="4" col="1">
                        <html>
                            <h4 style="text-align: center; margin: 10px">Do you want to re-source all lines of this order ?</h4>
                        </html>
                    </group>
                    <newline/>
                    <button colspan="2" type="object" icon="gtk-execute" name="resource_lines" string="Yes"/>
                    <button colspan="2" type="object" icon="gtk-execute" name="only_cancel" string="No"/>
                </form>
            </field>
        </record>

        <record id="sale_order_cancelation_ask_wizard_form_view" model="ir.ui.view">
            <field name="name">sale.order.cancelation.ask.wizard.form.view</field>
            <field name="model">sale.order.cancelation.wizard</field>
            <field name="type">form</field>
            <field name="priority" eval="100" />
            <field name="arch" type="xml">
                <form string="Cancel Field Order">
                    <group colspan="4" col="1">
                        <html>
                            <p style="text-align:center; font-weight: bold; font-size: 1.2em;">
                                WARNING: The line that you canceled has removed/canceled the last line of the following FO/IR.
                                Would you cancel these FO/IR or leave them in their current status ?
                            </p>
                        </html>
                        <field name="order_ids" nolabel="1" colspan="4" mode="tree">
                            <tree string="Field orders / Internal request" editable="top" hide_new_button="1" hide_delete_button="1">
                                <field name="order_id" readonly="1" />
                                <field name="order_state" readonly="1" />
                                <field name="action" required="1" />
                            </tree>
                        </field>
                    </group>
                    <newline />
                    <label colspan="2" string=" " />
                    <button colspan="2" type="object" icon="gtk-execute" name="close_fo" string="Do selected actions" />
                </form>
            </field>
        </record>

        <!-- Sourcing progress -->
        <record id="sale_order_sourcing_progress_view" model="ir.ui.view">
            <field name="name">sale.order.sourcing.progress.view</field>
            <field name="model">sale.order.sourcing.progress</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Sourcing progress" colors="green: sourcing_stop != False; blue: end_date != False &amp; sourcing_stop == False">
                    <field name="order_id" />
                    <field name="start_date" />
                    <field name="end_date" />
                    <field name="split_order" />
                    <field name="check_data" />
                    <field name="line_completed" />
                    <field name="prepare_picking" />
                    <field name="sourcing_completed" />
                    <field name="sourcing_start" />
                    <field name="sourcing_stop" />
                    <field name="sourcing" />
                    <field name="error" attrs="{'invisible': [('error', '=', False)]}" />
                </tree>
            </field>
        </record>

        <record id="sale_order_sourcing_progress_search_view" model="ir.ui.view">
            <field name="name">sale.order.sourcing.progress.search.view</field>
            <field name="model">sale.order.sourcing.progress</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Sourcing progress">
                    <filter string="Done" name="done" domain="[('end_date', '!=', False)]" icon="terp-check" />
                    <filter string="In Progress" name="progress" domain="['&amp;', ('end_date', '=', False), ('start_date', '!=', False)]" icon="gtk-execute" />
                    <field name="order_id" context="{'procurement_order': True, 'active_test': False}"
                           domain="[('state', '!=', 'draft'), '|', ('procurement_request', '=', True), ('split_type_sale_order', '=', 'original_sale_order')]"/>
                    <field name="start_date" />
                </search>
            </field>
        </record>

        <record id="fo_ir_line_error_message_view" model="ir.ui.view">
            <field name="name">fo.ir.line.error.message.view</field>
            <field name="model">sale.order.line</field>
            <field name="type">form</field>
            <field name="priority" eval="998" />
            <field name="arch" type="xml">
                <form>
                    <field name="to_correct_ok" invisible="1"/>
                    <field name="inactive_product" invisible="1" />
                    <group attrs="{'invisible': [('text_error', '=', False), ('inactive_error', '=', False)]}">
                        <html>
                            <style>
                                #error_message_unifield
                                {
                                    border-style: solid;
                                    border-width: 1px;
                                    border-radius: 5px;
                                    border-color: black;
                                    background-color: #F0EBA4;
                                }

                                #view_form #error_message_unifield .readonlyfield
                                {
                                    border-style: none;
                                    padding: 5px;
                                    color: red;
                                    background-color: #F0EBA4;
                                    font-weight: bold;
                                    text-transform: uppercase;
                                    width: 90%%;
                                }

                                #error_message_unifield p, #error_message_unifield span
                                {
                                    height: 1em;
                                    min-height: 1em;
                                        color: red;
                                    font-weight: bold;
                                    text-transform: uppercase;
                                    padding: 5px;
                                    width: 90%%;
                                }

                                #error_message_unifield .grip
                                {
                                    visibility: hidden;
                                }
                            </style>

                            <div id="error_message_unifield">
                                <field name="text_error" invisible="context.get('hide_column_error_ok', False) != True" readonly="1" />
                                <field name="inactive_error" attrs="{'invisible': [('inactive_product', '=', False)]}" string="Error" colspan="4" />
                            </div>
                        </html>
                    </group>
                    <button special="cancel" icon="gtk-cancel" string="Close window" colspan="4" />
                </form>
            </field>
        </record>

    </data>
</openerp>
