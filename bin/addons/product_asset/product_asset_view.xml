<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

    <!-- product -->
    <record id="product_normal_form_view" model="ir.ui.view">
        <field name="name">product.normal.form</field>
        <field name="model">product.product</field>
        <field name="type">form</field>
        <field name="priority">55</field>
        <field name="inherit_id" ref="product.product_normal_form_view" />
        <field name="arch" type="xml">
            <data>

                <field name="type" position="after">
                    <field name="subtype" attrs="{'invisible':[('type','!=','product')]}" />
                    <field name="asset_type_id" widget="selection"
                        attrs="{'invisible':[('subtype','!=','asset')], 'required':[('subtype','=','asset')]}" />
                </field>

            </data>
        </field>
    </record>


    <act_window id="product_2_assets_normal_link" context="{}"
        domain="[('product_id', '=', active_id)]" name="Asset Forms"
        res_model="product.asset" src_model="product.product" />

    <act_window id="product_2_events_normal_link" context="{}"
        domain="[('product_id', '=', active_id)]" name="Asset Follow Up"
        res_model="product.asset.event" src_model="product.product" />

    <record id="asset_disposal_form_view" model="ir.ui.view">
        <field name="name">product.asset.disposal.form</field>
        <field name="model">product.asset.disposal</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Disposal">
                <field name="disposal_date" />
                <newline />
                <field name="disposal_expense_account" />
                <newline />
                <group colspan="4" col="4">
                    <button name="button_generate_disposal_entry" type="object" string="Dispose" icon="gtk-ok"/>
                    <button name="cancel"  type="special" special="cancel" string="Cancel" icon="gtk-cancel" />
                </group>
            </form>
        </field>
    </record>
    <!--
        Main asset form
    -->
    <record id="asset_normal_form_view" model="ir.ui.view">
        <field name="name">asset.normal.form</field>
        <field name="model">product.asset</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Asset">
                    <field name="name" />
                    <field name="partner_name" readonly='1'/>
                    <field name="asset_type_id" on_change="change_asset_type_id(asset_type_id, useful_life_id)"/>
                    <field name="useful_life_id" widget="selection" get_selection="get_selection_useful_life_id" />
                    <field name="product_id" on_change="onChangeProductId(product_id)" attrs="{'readonly': [('from_invoice', '=', True)]}"/>
                    <field name="description" />
                    <notebook colspan="4">
                    <page string="Asset Form">
                        <group colspan="2" col="2">
                            <separator string="MSF Codification" colspan="2" />
                            <field name="prod_int_code" />
                            <field name="prod_int_name" />
                            <field name="nomenclature_description" />
                            <field name="hq_ref" />
                            <field name="local_ref" />
                        </group>

                        <group colspan="2" col="8">
                            <separator string="Asset Reference" colspan="2" />
                            <field name="serial_nb" colspan="8" />
                            <field name="brand" colspan="8" />
                            <field name="type" colspan="8" />
                            <field name="model" colspan="8" />
                            <field name="year" on_change="onChangeYear(year)" />
                        </group>

                        <group colspan="2" col="4">
                            <separator string="Comment" colspan="4" />
                            <!-- display hack -->
                            <field name="comment" nolabel="True" colspan="4" />
                        </group>

                        <group colspan="2" col="2">
                            <separator string="Traceability" colspan="2" />
                            <field name="project_po" />
                            <field name="orig_mission_code" />
                            <field name="international_po" />
                            <field name="arrival_date" />
                            <field name="receipt_place" />
                        </group>

                        <group colspan="2" col="4">
                            <separator string="Invoice" colspan="4" />
                            <field name="invo_num" colspan="4" attrs="{'readonly': [('from_invoice', '=', True)]}" />
                            <field name="invo_date" colspan="4" attrs="{'readonly': [('from_invoice', '=', True)]}" />
                            <field name="invo_value" attrs="{'readonly': [('from_invoice', '=', True)]}" />
                            <field name="invo_currency" attrs="{'readonly': [('from_invoice', '=', True)]}" />
                            <field name="invo_supplier_id" colspan="4" attrs="{'readonly': [('from_invoice', '=', True)]}" />
                            <field name="invo_donator_code" colspan="4" />
                            <field name="invo_certif_depreciation" colspan="4" />
                        </group>
                        <group colspan="2" col="4">
                            <separator string="Accounts" colspan="4" />
                            <field name="asset_bs_depreciation_account_id"  />
                            <field name="asset_pl_account_id" colspan="4"  />
                        </group>
                    </page>
                    <page string="Event History">
                        <group colspan="2" col="2">
                            <field colspan="4" name="event_ids" nolabel="1" mode="tree,form">
                                <tree string="Events">
                                    <field name="date" />
                                    <field name="event_type" />
                                    <field name="location" />
                                    <field name="state" />
                                    <field name="proj_code" />
                                </tree>
                            </field>
                        </group>
                    </page>
                    <page string="Depreciation">
                        <field name="start_date" />
                        <field name="depreciation_amount" />
                        <field name="disposal_amount" />
                        <button type="object" name="button_generate_draft_entries" string="Generate Drat Entries" />
                        <button type="object" name="button_dispose" string="Dispose" />
                        <group col="6" colspan="4">
                            <group colspan="6" col="6" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}">
                                <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-check" context="context" colspan="3" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}"/>
                                <button name="button_reset_distribution" string="Reset AD at line level" type="object"
                                        icon="gtk-undelete" colspan="3" attrs="{'invisible': [('state', '=', 'done')]}"/>
                            </group>
                            <group colspan="6" col="6" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}">
                                <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-emblem-important" context="context" colspan="3" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}"/>
                                <button name="button_reset_distribution" string="Reset AD at line level" type="object"
                                        icon="gtk-undelete" colspan="3" attrs="{'invisible': [('state', '=', 'done')]}"/>
                            </group>
                            <field name="analytic_distribution_id" invisible="1"/>
                        </group>
                        <field colspan="4" name="line_ids" nolabel="1" mode="tree" readonly="1" filter_selector="[('Show all', []), ('Hide Posted', ['|', ('move_id', '=', False), ('move_id.state', '!=', 'posted')])]">
                            <tree string="Depreciation Lines" editable="top" hide_delete_button="1" hide_new_button="1">
                                <field name="date" />
                                <field name="amount" />
                                <field name="asset_bs_depreciation_account_id" />
                                <field name="asset_pl_account_id" />
                                <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" context="context" attrs="{'invisible': [('is_allocatable', '=', False)]}"/>
                                <field name="analytic_distribution_state_recap"/>
                                <field name="have_analytic_distribution_from_header" invisible="1"/>
                                <field name="analytic_distribution_state" invisible="1"/>
                                <field name="is_allocatable" invisible="1"/>
                                <field name="move_id" />
                                <field name="move_state" />
                                <button name="button_generate_unposted_entries" type="object" icon="terp-gtk-jump-to-ltr" attrs="{'invisible': [('move_id', '!=', False)]}"/>
                                <button name="button_post_entries" type="object" icon="gtk-apply" attrs="{'invisible': [('move_state', '=', 'posted')]}"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
                <group colspan="4">
                    <field name="state" />
                   <field name="from_invoice"  />
                </group>
            </form>
        </field>
    </record>


    <record id="asset_normal_tree_view" model="ir.ui.view">
        <field name="name">asset.normal.tree</field>
        <field name="model">product.asset</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Asset Forms">
                <field name="name" />
                <field name="partner_name"/>
                <field name="asset_type_id" />
                <field name="product_id" />
                <field name="brand" />
                <field name="type" />
                <field name="year" />
                <field name="useful_life_id" />
                <field name="invo_value" sum="sum" sum_selected="1" />
                <field name="invo_currency" />
                <field name="depreciation_amount" sum="sum" sum_selected="1"/>
                <field name="disposal_amount" sum="sum" sum_selected="1"/>
                <field name="state" />
            </tree>
        </field>
    </record>


    <record id="asset_search_form_view" model="ir.ui.view">
        <field name="name">asset.search.form</field>
        <field name="model">product.asset</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
            <search string="Asset Form">
                <field name="name"  />
                <field name="asset_type_id" widget="selection" />
                <field name="product_id" domain="[('subtype', '=', 'asset')]" />
                <field name="serial_nb" />
                <field name="brand" />
                <field name="type" />
                <field name="model" />
                <field name="invo_currency" />
                <field name="state" />
                <newline />
                <group expand="0" string="Group By..." colspan="11" col="11">
                    <filter string="Product" icon="terp-product" domain="[]"
                        context="{'group_by':'product_id'}" />
                    <filter string="Asset Type" icon="terp-stock_symbol-selection"
                        domain="[]" context="{'group_by':'asset_type_id'}" />
                </group>
            </search>
        </field>
    </record>


    <record id="asset_normal_action" model="ir.actions.act_window">
        <field name="name">Asset Forms</field>
        <field name="res_model">product.asset</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="asset_search_form_view" />
    </record>

    <!-- Assets in SALES>Products -->
    <menuitem id="menu_asset_sales" name="Assets" parent="base.menu_product" sequence="100" />
    <menuitem action="asset_normal_action" id="menu_assets_sales"
        parent="menu_asset_sales" sequence="1" />

    <act_window id="asset_2_events_normal_link" context="{}"
        domain="[('asset_id', '=', active_id)]" name="Asset Follow Up" res_model="product.asset.event"
        src_model="product.asset" />

    <record id="asset_event_normal_form_view" model="ir.ui.view">
        <field name="name">asset.event.normal.form</field>
        <field name="model">product.asset.event</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Asset Event">

                <group colspan="2" col="2">
                    <separator string="Event Information" colspan="2" />
                    <field name="date" />
                    <field name="location" />
                    <field name="proj_code" />
                    <field name="event_type" />
                    <field name="state" />
                </group>

                <group colspan="2" col="2">
                    <separator string="Selection" colspan="2" />
                    <field name="asset_id" on_change="onChangeAssetId(asset_id)" />
                    <field name="product_id" />
                    <field name="serial_nb" />
                    <field name="brand" />
                    <field name="model" />
                </group>
                <group colspan="2" col="4">
                    <separator string="Comment" colspan="4" />
                    <!-- display hack -->
                    <group colspan="1" col="1"></group>
                    <field name="comment" nolabel="True" colspan="3" />
                </group>

            </form>
        </field>
    </record>

    <record id="asset_event_normal_tree_view" model="ir.ui.view">
        <field name="name">asset.event.normal.tree</field>
        <field name="model">product.asset.event</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Asset Events">
                <field name="date" />
                <field name="asset_id" />
                <field name="product_id" />
                <field name="asset_type_id" />
                <field name="event_type" />
                <field name="location" />
                <field name="state" />
                <field name="proj_code" />
            </tree>
        </field>
    </record>

    <record id="asset_event_search_form_view" model="ir.ui.view">
        <field name="name">asset.event.search.form</field>
        <field name="model">product.asset.event</field>
        <field name="type">search</field>
        <field name="arch" type="xml">
            <search string="Asset Event">
                <field name="date" />
                <field name="asset_id" />
                <field name="product_id" domain="[('subtype', '=', 'asset')]" />
                <field name="event_type" />
                <newline />
                <group expand="0" string="Group By..." colspan="11" col="11">
                    <filter string="Asset Form" icon="terp-accessories-archiver"
                        domain="[]" context="{'group_by':'asset_id'}" />
                    <filter string="Asset Type" icon="terp-stock_symbol-selection"
                        domain="[]" context="{'group_by':'asset_type_id'}" />
                    <filter string="Product" icon="terp-product" domain="[]"
                        context="{'group_by':'product_id'}" />
                    <filter string="Project Code" icon="gtk-bold" domain="[]"
                        context="{'group_by':'proj_code'}" />
                    <filter string="Event Type" icon="gtk-select-color" domain="[]"
                        context="{'group_by':'event_type'}" />
                    <filter string="Current Status" icon="terp-purchase"
                        domain="[]" context="{'group_by':'state'}" />
                </group>
            </search>
        </field>
    </record>

    <record id="asset_event_normal_action" model="ir.actions.act_window">
        <field name="name">Asset Events</field>
        <field name="res_model">product.asset.event</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="asset_event_search_form_view" />
    </record>


    <!-- Asset Events in SALES>Products>Assets -->
    <menuitem action="asset_event_normal_action" id="menu_asset_event_sales"
        parent="menu_asset_sales" sequence="1" />

    <record id="asset_type_normal_form_view" model="ir.ui.view">
        <field name="name">asset.type.normal.form</field>
        <field name="model">product.asset.type</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Asset Type">
                <group colspan="2" col="2">
                    <separator string="Asset Type Information" colspan="2" />
                    <field name="name" />
                    <field name="description" />
                    <field name="active" />
                    <field name="useful_life_id">
                        <tree editable="top">
                            <field name="year" />
                        </tree>
                    </field>
                </group>
            </form>
        </field>
    </record>

    <record id="asset_type_normal_tree_view" model="ir.ui.view">
        <field name="name">asset.type.normal.tree</field>
        <field name="model">product.asset.type</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Asset Types">
                <field name="name" />
                <field name="description" />
            </tree>
        </field>
    </record>

    <record id="asset_type_normal_action" model="ir.actions.act_window">
        <field name="name">Asset Types</field>
        <field name="res_model">product.asset.type</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Asset Types in SALES>Products>Asssets -->
    <menuitem action="asset_type_normal_action" id="menu_asset_type_sales"
        parent="product_attributes.menu_product_config" sequence="1000" />


    <record id="action_open_asset_account_move_line" model="ir.actions.server">
        <field name="name">Asset Journal Items</field>
        <field name="model_id" ref="product_asset.model_product_asset"/>
        <field name="state">code</field>
        <field name="code">
action = self.open_asset_account_move_line(cr, uid, ids, context=context)
        </field>
    </record>

    <record id="relate_open_asset_account_move_line" model="ir.values">
        <field name="key2">client_action_relate</field>
        <field name="model">product.asset</field>
        <field name="name">Asset Journal Items</field>
        <field name="value" eval="'ir.actions.server,%d'%action_open_asset_account_move_line"/>
        <field name="object" eval="True"/>
        <field name="sequence" eval="10"/>
    </record>

    <record id="action_open_asset_account_move" model="ir.actions.server">
        <field name="name">Asset Journal Entries</field>
        <field name="model_id" ref="product_asset.model_product_asset"/>
        <field name="state">code</field>
        <field name="code">
action = self.open_asset_account_move(cr, uid, ids, context=context)
        </field>
    </record>

    <record id="relate_open_asset_account_move" model="ir.values">
        <field name="key2">client_action_relate</field>
        <field name="model">product.asset</field>
        <field name="name">Asset Journal Entries</field>
        <field name="value" eval="'ir.actions.server,%d'%action_open_asset_account_move"/>
        <field name="object" eval="True"/>
        <field name="sequence" eval="10"/>
    </record>


   <!-- duplicate reccuring line to post view (AD is editable) -->
    <record model="ir.ui.view" id="view_account_move_line_asset_tree">
        <field name="name">account.move.line.asset.tree</field>
        <field name="model">account.move.line</field>
        <field name="type">tree</field>
        <field name="priority" eval="150" />
        <field name="duplicate_view_id" ref="account_subscription.account_move_line_recurring_entries_to_validate" />
        <field name="arch" type="xml">
            <tree />
        </field>
    </record>
    <record model="ir.ui.view" id="view_account_move_line_asset_2tree">
        <field name="name">account.move.line.asset.tree.inherit</field>
        <field name="model">account.move.line</field>
        <field name="type">tree</field>
        <field name="priority" eval="160" />
        <field name="inherit_id" ref="view_account_move_line_asset_tree" />
        <field name="arch" type="xml">
            <xpath expr="/tree" position="attributes">
                <attribute name="string">Asset Journal Items</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_product_asset_generate_entries" model="ir.ui.view">
        <field name="name">product.asset.generate.entries.form</field>
        <field name="model">product.asset.generate.entries</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Asset Generate Entries">
                <group colspan="4" col="10">
                    <separator string="Generate Entries until:" colspan="4"/>
                    <newline/>
                    <label string="Automatically generate entries based on what has been entered in the system until a specific date." colspan="4" nolabel="1"/>
                    <newline/>
                    <field name="date" colspan="2"/>
                    <group colspan="8" />
                    <button icon="gtk-cancel" special="cancel" string="Cancel" colspan="2"/>
                    <button icon="gtk-execute" string="Generate Entries" name="button_generate_all" type="object"  colspan="2"/> 
                    <group colspan="6" />
                </group>
            </form>
        </field>
    </record>

    <record id="action_product_asset_generate_entries" model="ir.actions.act_window">
        <field name="name">Generate Asset Entries</field>
        <field name="res_model">product.asset.generate.entries</field>
        <field name="view_type">form</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <menuitem sequence="200" action="action_product_asset_generate_entries" id="menu_product_asset_generate_entries" parent="product_asset.menu_asset_sales" />



</data>
</openerp>
