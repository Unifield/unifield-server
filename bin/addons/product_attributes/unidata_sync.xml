<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data noupdate="1">
        <record model="res.users" id="base.user_unidata_pull">
            <field name="name">UniData Pull</field>
            <field name="login">unidata_pull</field>
            <field name="active" eval="False" />
        </record>

        <record id="ir_cron_unidata_sync" model="ir.cron">
            <field name="function">start_ud_sync</field>
            <field name="user_id">1</field>
            <field name="name">Sync UD products</field>
            <field name="interval_type">hours</field>
            <field eval="-1" name="numbercall"/>
            <field eval="5" name="priority"/>
            <field eval="0" name="doall"/>
            <field eval="0" name="active"/>
            <field eval="24" name="interval_number"/>
            <field name="model">unidata.sync</field>
        </record>

        <record id="unidata_sync_config" model="unidata.sync">
            <field name="url">https://rest.unidata.msf.org/msf-mdm-unidata/rest/ud-api/v1/articles</field>
            <field name="url_msl">https://rest.unidata.msf.org/msf-mdm-unidata/rest/msl-api/v1</field>
        </record>


    </data>
    <data>

        <record model="ir.ui.view" id="unidata_sync_form">
            <field name="name">unidata.sync.form</field>
            <field name="model">unidata.sync</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="UniData Configuration" hide_new_button="1" hide_delete_button="1" hide_duplicate_button="1">
                    <field name="url" colspan="4"/>
                    <field name="login"  />
                    <field name="password" password="True" />
                    <field name="nb_keep_log" />
                    <field name="page_size" />
                    <field name="ud_timeout" />
                    <newline />
                    <group colspan="4" col="4">
                        <button name="test_connection" string="Test connection" colspan="1" type="object" icon="terp-stock_zoom"  />
                        <group colspan="3" />
                    </group>
                    <separator colspan="4" string="Scheduler" />
                    <field name="is_active" />
                    <field name="next_planned_date" />
                    <field name="interval" />
                    <field name="next_run_date" />
                    <field name="eligible_for_full_sync" invisible="1" />
                    <group colspan="4" col="4">
                        <button name="set_as_full" string="Set next sync as full sync" confirm="The next will be a full sync, this operation cannot be reversed. Do you confirm ?" colspan="1" type="object" icon="gtk-media-previous"  attrs="{'invisible': [('eligible_for_full_sync', '=', False)]}"/>
                        <group colspan="3" />
                    </group>
                    <separator colspan="4" string="Last Sync" />
                    <field name="last_execution_start_date" />
                    <field name="last_execution_end_date" />
                    <field name="last_execution_sync_type" />
                    <field name="last_execution_status" />
                    <group colspan="4" col="4">
                        <button string="Start manually" name="start_manual" type="object" icon="gtk-refresh" />
                        <group colspan="3" />
                    </group>

                </form>
            </field>
        </record>

        <record id="unidata_sync_action" model="ir.actions.server">
            <field name="name">UniData Sync Config</field>
            <field name="model_id" ref="model_unidata_sync" />
            <field name="state">code</field>
            <field name="code">action = obj.open_menu(context=context)</field>
        </record>

        <record model="ir.ui.view" id="unidata_sync_log_form">
            <field name="name">unidata.sync.log.form</field>
            <field name="model">unidata.sync.log</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="UniData Log" hide_new_button="1" hide_delete_button="1" hide_duplicate_button="1">
                    <field name="start_date" />
                    <field name="end_date"  />
                    <field name="page_size" />
                    <field name="start_uid" />
                    <newline />
                    <field name="number_products_pulled" />
                    <field name="number_products_updated" />
                    <field name="msfid_min" />
                    <field name="last_date" />
                    <field name="sync_type" />
                    <field name="state" />
                    <field name="error" colspan="4" />
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="unidata_sync_log_tree">
            <field name="name">unidata.sync.log.tree</field>
            <field name="model">unidata.sync.log</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="UniData Log" hide_new_button="1" hide_delete_button="1" noteditable="1" colors="red:state=='error'">
                    <field name="start_date" />
                    <field name="end_date"  />
                    <field name="page_size" />
                    <field name="number_products_pulled" />
                    <field name="number_products_updated" />
                    <field name="sync_type" />
                    <field name="state" />
                    <field name="log_exists" invisible="1" />
                    <button string="Get log file" name="get_log_file" type="object" icon="gtk-file" attrs="{'invisible': [('log_exists', '=', False)]}" />
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="unidata_sync_log_search">
            <field name="name">unidata.sync.log.search</field>
            <field name="model">unidata.sync.log</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="UniData Log">
                    <field name="start_date" />
                    <field name="end_date"  />
                    <field name="sync_type" />
                    <field name="state" />
                </search>
            </field>
        </record>


        <record id="unidata_sync_log_action" model="ir.actions.act_window">
            <field name="name">UniData Sync report</field>
            <field name="res_model">unidata.sync.log</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
        </record>

        <menuitem name="UniData" parent="object_query.menu_preferences" id="unidata_main_menu" sequence="17" />
        <menuitem name="UniData Sync Config" action="unidata_sync_action" type="server" id="unidata_sync_menu" parent="unidata_main_menu" sequence="10"/>
        <menuitem name="UniData Sync report" action="unidata_sync_log_action" id="unidata_sync_report_menu" parent="unidata_main_menu" sequence="15"/>

        <report
            auto="False"
            id="unidata_sync_log_download"
            model="unidata.sync.log"
            name="product_attributes.unidata_sync_log_download"
            string="Get log files"
            menu="True"
        />


        <record model="ir.ui.view" id="unidata_project_search">
            <field name="name">unidata.project.search</field>
            <field name="model">unidata.project</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="MSL List">
                    <field name="name" />
                    <field name="msfid"  />
                    <field name="code" />
                    <field name="msl_product_ids" />
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="unidata_project_tree">
            <field name="name">unidata.project.tree</field>
            <field name="model">unidata.project</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="MSL Lists" hide_new_button="1" hide_delete_button="1" colors="red:not instance_id">
                    <field name="name" />
                    <field name="instance_id" />
                    <field name="code" />
                    <field name="publication_date" widget="date" />
                    <field name="publication" />
                    <field name="msl_product_ids" />
                    <field name="uf_active" />
                    <button type="object" string="Activate" name="activate" icon="terp-check" attrs="{'invisible': [('uf_active', '=', True)]}"/>
                    <button type="object" string="De-activate" name="de_activate" icon="gtk-stop" attrs="{'invisible': [('uf_active', '=', False)]}"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="unidata_project_form">
            <field name="name">unidata.project.form</field>
            <field name="model">unidata.project</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="MSL List" hide_new_button="1" hide_delete_button="1" hide_duplicate_button="1">
                    <field name="name" />
                    <field name="uf_active" />
                    <field name="instance_id" />
                    <field name="code" />
                    <field name="publication_date" widget="date" />
                    <field name="publication" />
                    <field name="msfid"  />
                    <field name="msl_product_ids"  colspan="4" nolabel="1">
                        <tree>
                            <field name="default_code" />
                            <field name="name" />
                            <field name="nomen_manda_2" />
                            <field name="standard_ok" />
                            <field name="oc_subscription" />
                            <field name="state_ud" />
                            <field name="state" />
                            <field name="controlled_substance" />
                            <field name="justification_code_id" />
                        </tree>
                    </field>
                </form>
            </field>
        </record>

        <record id="unidata_project_action" model="ir.actions.act_window">
            <field name="name">MSL Lists</field>
            <field name="res_model">unidata.project</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('publication_date', '!=', False)]</field>
        </record>

        <menuitem name="MSL Lists" parent="base.menu_product" id="unidata_project_menu" action="unidata_project_action" sequence="15" />

        <record model="ir.ui.view" id="product_product_mml_search">
            <field name="name">product.product.mml.search</field>
            <field name="model">product.product</field>
            <field name="type">search</field>
            <field name="priority" eval="198" />
            <field name="arch" type="xml">
                <search string="MML Products">
                    <filter string="MML Valid" icon="terp-check" domain="[('in_mml_instance', '=', True)]" />
                    <field name="default_code" />
                    <field name="name"  />
                    <field name="standard_ok" />
                    <field name="in_mml_instance" />
                    <field name="oc_subscription" />
                    <field name="state_ud" />
                    <field name="state" />
                    <field name="in_msl_instance" />
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="product_product_mml_tree">
            <field name="name">product.product.mml.tree</field>
            <field name="model">product.product</field>
            <field name="type">tree</field>
            <field name="priority" eval="198" />
            <field name="arch" type="xml">
                <tree string="MML Products" hide_new_button="1" hide_delete_button="1">
                    <field name="default_code" />
                    <field name="name" />
                    <field name="standard_ok" />
                    <field name="restrictions_txt" />
                    <field name="oc_comments" />
                    <field name="oc_subscription" />
                    <field name="state_ud"  />
                    <field name="state"  />
                    <field name="is_msl_valid"  />
                    <field name="is_mml_valid"  />
                </tree>
            </field>
        </record>

        <record  model="ir.actions.act_window" id="product_product_mml_action">
            <field name="name">MML Products</field>
            <field name="res_model">product.product</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('oc_validation', '=', True)]</field>
            <field name="search_view_id" ref="product_product_mml_search" />
            <field name="view_id" ref="product_product_mml_tree" />
        </record>

        <menuitem name="MML Products" parent="base.menu_product" id="product_product_mml_menu" action="product_product_mml_action" sequence="10" />

        <record model="ir.ui.view" id="product_product_msl_search">
            <field name="name">product.product.msl.search</field>
            <field name="model">product.product</field>
            <field name="type">search</field>
            <field name="priority" eval="177" />
            <field name="arch" type="xml">
                <search string="MSL Products">
                    <filter string="MML Valid" icon="terp-check" domain="[('in_mml_instance', '=', True)]" />
                    <field name="default_code" />
                    <field name="name"  />
                    <field name="standard_ok" />
                    <field name="oc_subscription" />
                    <field name="state_ud" />
                    <field name="state" />
                    <field name="in_msl_instance" widget="many2one"/>
                    <field name="justification_code_id" />
                    <field name="controlled_substance" />
                    <field name="in_mml_instance" />
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="product_product_msl_tree">
            <field name="name">product.product.msl.tree</field>
            <field name="model">product.product</field>
            <field name="type">tree</field>
            <field name="priority" eval="177" />
            <field name="arch" type="xml">
                <tree string="MSL Products" hide_new_button="1" hide_delete_button="1">
                    <field name="default_code" />
                    <field name="name" />
                    <field name="nomen_manda_2" />
                    <field name="standard_ok" />
                    <field name="oc_subscription" />
                    <field name="state_ud"  />
                    <field name="state"  />
                    <field name="in_msl_instance" truncate="100" string="MSL DB"/>
                    <field name="justification_code_id" />
                    <field name="controlled_substance" />
                    <field name="is_mml_valid"  />
                </tree>
            </field>
        </record>

        <record  model="ir.actions.act_window" id="product_product_msl_action">
            <field name="name">MSL Products</field>
            <field name="res_model">product.product</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('in_msl_instance', '=', True)]</field>
            <field name="search_view_id" ref="product_product_msl_search" />
            <field name="view_id" ref="product_product_msl_tree" />
        </record>

        <menuitem name="MSL Products" parent="base.menu_product" id="product_product_mSl_menu" action="product_product_msl_action" sequence="20" />

    </data>
</openerp>
