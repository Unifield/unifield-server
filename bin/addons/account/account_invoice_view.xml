<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE INVOICE [
    <!ENTITY payment_tab SYSTEM "account_invoice_payment_tab.xml">
    <!ENTITY signature_template SYSTEM "../base/res/signature_pager_template.xml">
]>

<openerp>
    <data>
        <!--
        Invoices
        -->
        <record id="view_invoice_line_calendar" model="ir.ui.view">
            <field name="name">account.invoice.calendar</field>
            <field name="model">account.invoice</field>
            <field name="type">calendar</field>
            <field name="arch" type="xml">
                <calendar string="Invoices" color="journal_id" date_start="date_invoice">
                    <field name="partner_id"/>
                    <field name="amount_total"/>
                </calendar>
            </field>
        </record>

        <record model="ir.ui.view" id="view_invoice_graph">
            <field name="name">account.invoice.graph</field>
            <field name="model">account.invoice</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph string="Invoices" type="bar">
                    <field name="partner_id"/>
                    <field name="amount_total" operator="+"/>
                </graph>
            </field>
        </record>

        <record id="view_invoice_line_tree" model="ir.ui.view">
            <field name="name">account.invoice.line.tree</field>
            <field name="model">account.invoice.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Invoice Line">
                    <field name="name"/>
                    <field name="account_id" groups="account.group_account_user"/>
                    <field name="quantity"/>
                    <field name="uos_id"/>
                    <field name="price_unit"/>
                    <field name="discount" groups="base.group_extended"/>
                    <field name="price_subtotal"/>
                </tree>
            </field>
        </record>

        <record id="view_invoice_line_form" model="ir.ui.view">
            <field name="name">account.invoice.line.form</field>
            <field name="model">account.invoice.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Invoice Line">
                    <notebook>
                        <page string="Line">
                            <field name="invoice_type" invisible="1"/>
                            <field name="from_supply" invisible="1"/>
                            <field name="line_synced" invisible="1"/>
                            <field name="partner_type" invisible="1"/>
                            <field name="product_id"
                                   on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, {'company_id': parent.company_id})"
                                   default_focus="1"
                                   attrs="{'readonly': ['|',
                                                        '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                        '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"
                            />
                            <field name="uos_id"
                                   on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, {'company_id': parent.company_id})"
                                   attrs="{'readonly': ['|',
                                                        '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                        '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"
                            />
                            <field name="quantity" attrs="{'readonly': ['|',
                                                           '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                           '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"
                            />
                            <field name="price_unit" attrs="{'readonly': [('invoice_type', '=', 'in_invoice'), ('line_synced', '=', True)]}"/>
                            <field name="discount" groups="base.group_extended"
                                   attrs="{'readonly': [('invoice_type', '=', 'in_invoice'), ('line_synced', '=', True)]}"/>
                            <field colspan="4" name="name"/>
                            <field name="account_id"
                                   domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('restricted_area', '=', 'invoice_lines')]"
                                   required="1"
                            />
                            <field domain="[('type','&lt;&gt;','view'), ('company_id', '=', parent.company_id), ('parent_id', '!=', False)]" name="account_analytic_id" groups="analytic.group_analytic_accounting"/>
                            <newline/>
                            <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                            <separator colspan="4" string="Taxes"/>
                            <field colspan="4" name="invoice_line_tax_id" context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"
                            nolabel="1"/>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="note" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record id="view_invoice_tax_tree" model="ir.ui.view">
            <field name="name">account.invoice.tax.tree</field>
            <field name="model">account.invoice.tax</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Manual Invoice Taxes">
                    <field name="sequence"/>
                    <field name="manual"/>
                    <field name="name"/>
                    <field name="account_id" groups="base.group_account_user"/>
                    <field name="base"/>
                    <field name="amount"/>
                </tree>
            </field>
        </record>

        <record id="view_invoice_tax_form" model="ir.ui.view">
            <field name="name">account.invoice.tax.form</field>
            <field name="model">account.invoice.tax</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Manual Invoice Taxes">
                    <field name="name"/>
                    <field name="sequence"/>
                    <field name="account_id"/>
                    <field name="manual"/>
                    <field name="amount"/>
                    <field name="base" readonly="0"/>
                    <separator colspan="4" string="Tax codes"/>
                    <field name="base_code_id"/>
                    <field name="base_amount"/>
                    <field name="tax_code_id"/>
                    <field name="tax_amount"/>
                    <field name="factor_base" invisible="True"/>
                    <field name="factor_tax" invisible="True"/>
                </form>
            </field>
        </record>

        <record id="invoice_tree" model="ir.ui.view">
            <field name="name">account.invoice.tree</field>
            <field name="model">account.invoice</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree colors="blue:state in ('draft');black:state in ('proforma','proforma2','open');gray:state in ('cancel')" string="Invoice">
                    <field name="document_date"/>
                    <field name="supplier_reference"/>

                    <field name="date_invoice"/>
                    <field name="number"/>
                    <field name="partner_id" groups="base.group_user"/>
                    <field name="name"/>
                    <field name="journal_id" invisible="1"/>
                    <field name="period_id" invisible="1" groups="account.group_account_user"/>
                    <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                    <field name="date_due"/>
                    <field name="origin"/>
                    <field name="line_count"/>
                    <field name="currency_id"/>
                    <field name="residual" />
                    <field name="amount_total"/>
                    <field name="state"/>
                    <button name="invoice_open" states="draft,proforma2" type="object" string="Approve" icon="terp-camera_test"/>
                </tree>
            </field>
        </record>

        <record id="invoice_supplier_form" model="ir.ui.view">
            <field name="name">account.invoice.supplier.form</field>
            <field name="model">account.invoice</field>
            <field name="type">form</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <form string="Supplier Invoice">
                    <group col="8" colspan="4">
                        <field name="journal_id"
                               domain="[('inv_doc_type', '=', True), ('is_active', '=', True)]"
                               attrs="{'readonly': ['|', ('state', '!=', 'draft'), '&amp;', ('type', '=', 'in_invoice'), ('synced', '=', True)]}"/>
                        <field name="vat_ok" invisible="1" />
                        <field name="number" readonly="1"/>
                        <field name="type" invisible="1"/>
                        <field name="is_intermission" invisible="1"/>  <!-- for Payment tab -->
                        <field name="currency_id" width="50" attrs="{'readonly': ['|', ('state', '!=', 'draft'),
                                                                                  '&amp;', ('type', '=', 'in_invoice'), ('synced', '=', True)]}"/>
                        <button name="%(action_account_change_currency)d" type="action" icon="terp-stock_effects-object-colorize"
                                string="Change" groups="account.group_account_user"
                                attrs="{'invisible':[('state', '!=', 'draft')],
                                        'readonly': [('type', '=', 'in_invoice'), ('synced', '=', True)]}"/>
                        <newline/>
                        <field string="Supplier" name="partner_id" domain="[('supplier', '=', True)]"
                               on_change="onchange_partner_id(type,partner_id,date_invoice,payment_term,partner_bank_id,company_id,is_inkind_donation,is_intermission,is_debit_note,is_direct_invoice,False)"
                               context="{'default_customer': 0, 'search_default_supplier': 1, 'default_supplier': 1}"
                               attrs="{'readonly': ['|',
                                                    ('state', '!=', 'draft'),
                                                    '&amp;', ('type', '=', 'in_invoice'), '|', ('synced', '=', True), ('from_supply', '=', True)]}"
                        />
                        <field domain="[('partner_id','=',partner_id)]" name="address_invoice_id"/>
                        <field name="fiscal_position" groups="base.group_extended" widget="selection"/>
                        <newline/>
                        <field name="document_date" />
                        <field name="date_invoice"/>
                        <group colspan="2" col="1" />
                    </group>
                    <newline />
                    <group colspan="4" col="8" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}">
                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-check" context="context" colspan="4" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}"/>
                        <button name="button_reset_distribution" string="Reset AD at line level" type="object" icon="gtk-undelete" colspan="4" states="draft"/>
                    </group>
                    <group colspan="4" col="8" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}">
                        <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-emblem-important" context="context" colspan="4" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}"/>
                        <button name="button_reset_distribution" string="Reset AD at line level" type="object" icon="gtk-undelete" colspan="4" states="draft"/>
                    </group>
                    <field name="analytic_distribution_id" invisible="1"/>
                    <group colspan="3"/>

                    <notebook colspan="4">
                        <page string="Invoice">
                           <field domain="[('company_id', '=', company_id), ('restricted_area', '=', 'in_invoice')]" name="account_id" />
                            <field name="reference_type" nolabel="1" size="0"/>
                            <field name="reference" nolabel="1"/>
                            <field name="date_due"/>
                            <field name="check_total" attrs="{'invisible': ['|', ('doc_type', '=', 'isi'), ('doc_type', '=', 'isr')]}"/>
                            <field name="supplier_reference"/>
                            <group name="import" string=" Import Lines " colspan="4" col="4"
                               attrs="{'invisible': [('state', '!=', 'draft'), ('type', '!=', 'in_invoice')]}">
                                    <button name="import_invoice" string="Import Invoice Line" icon="gtk-execute" colspan="2" type="object"
                                            attrs="{'readonly': [('state', '!=', 'draft')],
                                                    'invisible': [('type', '!=', 'in_invoice')]}"/>
                                    <button name="export_invoice" string="Export Invoice Line" icon="gtk-execute" colspan="2" type="object"
                                            attrs="{'invisible': [('type', '!=', 'in_invoice')]}"/>
                                    <newline/>
                                    <button name="wizard_import_si_line" string="Import lines" icon="gtk-dnd" colspan="4" type="object"
                                            attrs="{'invisible': [('state', '!=', 'draft')],
                                                    'readonly': [('type', '=', 'in_invoice'), ('synced', '=', True)]}"/>
                           </group>

                            <field colspan="4" default_get="{'check_total': check_total, 'invoice_line': invoice_line, 'address_invoice_id': address_invoice_id, 'partner_id': partner_id, 'price_type': 'price_type' in dir() and price_type or False}" name="invoice_line" nolabel="1">
                                <tree string="Invoice lines" editable="both" colors="red:analytic_distribution_state in ('invalid', 'invalid_small_amount') or inactive_product == True or not account_id;black:analytic_distribution_state in ('none', 'valid') and inactive_product == False and account_id">
                                    <field name="from_supply" invisible="1"/>
                                    <field name="line_synced" invisible="1"/>
                                    <field name="invoice_type" invisible="1"/>
                                    <field name="partner_type" invisible="1"/>
                                    <field name="line_number" displayon="noteditable"/>
                                    <field name="is_corrected" invisible="1"/>
                                    <button name="button_open_analytic_lines" string="Have been corrected" type="object" icon="terp-mail-" attrs="{'invisible': [('is_corrected', '=', False)]}"/>
                                    <field name="product_id"
                                           attrs="{'readonly': ['|',
                                                                '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                                '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"
                                           on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, {'company_id': parent.company_id})"
                                    />
                                    <field name="account_id"
                                           domain="[('journal_id', '=', parent.journal_id), ('restricted_area', '=', 'invoice_lines')]"
                                           required="1"
                                    />
                                    <field name="invoice_line_tax_id" view_mode="2" context="{'type':parent.type}" domain="[('parent_id','=',False)]"/>
                                    <field name="inactive_product" invisible="1" />
                                    <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-stock_symbol-selection" context="context" attrs="{'invisible': [('is_allocatable', '=', False)]}"/>
                                    <field name="analytic_distribution_state_recap"/>
                                    <field name="have_analytic_distribution_from_header" invisible="1"/>
                                    <field name="analytic_distribution_state" invisible="1"/>
                                    <field name="is_allocatable" invisible="1"/>

                                    <field name="quantity"
                                           attrs="{'readonly': ['|',
                                                                '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True),('from_supply', '=', True),
                                                                '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"
                                    />
                                    <field name="price_unit"
                                           attrs="{'readonly': [('invoice_type', '=', 'in_invoice'), ('line_synced', '=', True)]}"
                                    />
                                     <!-- Removed if subtotal is set -->
                                    <field name="price_subtotal"/>
                                    <field name="name"/>
                                    <field invisible="True" name="uos_id"/>
                                </tree>
                            </field>
                            <group col="1" colspan="2">
                                <field name="tax_line" nolabel="1"
                                       attrs="{'invisible': ['|', ('vat_ok', '=', False), ('doc_type', 'in', ('isi', 'isr'))],
                                               'readonly': ['|', ('state','!=', 'draft'), '&amp;', ('type', '=', 'in_invoice'), ('synced', '=', True)]}">
                                    <tree editable="bottom" string="Taxes">
                                        <field name="invoice_id" invisible="True"/>
                                        <field name="account_tax_id" on_change="tax_code_change(account_tax_id, parent.amount_untaxed, parent.partner_id, context)"/>
                                        <field name="name"/>

                                        <field name="account_id" groups="account.group_account_invoice"
                                               domain="[('type', 'not in', ['view', 'consolidation']),
                                                        ('user_type_code', '=', 'tax')]"/>

                                        <field name="partner_id" readonly="1"/>
                                        <field name="base"
                                               on_change="base_change(base, parent.currency_id, parent.company_id, parent.document_date, parent.date_invoice)"
                                               readonly="1"/>
                                        <field name="amount"
                                               on_change="amount_change(amount, parent.currency_id, parent.company_id, parent.document_date, parent.date_invoice)"/>

                                        <field invisible="True" name="base_amount"/>
                                        <field invisible="True" name="tax_amount"/>
                                        <field name="factor_base" invisible="True"/>
                                        <field name="factor_tax" invisible="True"/>
                                    </tree>
                                </field>
                            </group>
                            <group col="4" colspan="2">
                                <button colspan="2" name="button_reset_taxes" states="draft" string="Compute Taxes"
                                        type="object" icon="terp-stock_format-scientific"
                                        attrs="{'invisible': ['|', ('vat_ok', '=', False), ('doc_type', 'in', ('isi', 'isr'))],
                                                'readonly': [('state', '!=', 'draft')]}"/>
                                <field name="amount_untaxed" attrs="{'invisible': ['|', ('vat_ok', '=', False), ('doc_type', 'in', ('isi', 'isr'))]}"/>
                                <label string="" colspan="2"/>
                                <field name="amount_tax" attrs="{'invisible': ['|', ('vat_ok', '=', False), ('doc_type', 'in', ('isi', 'isr'))]}" />
                                <field name="reconciled"/>
                                <field name="amount_total"/>
                                <field name="state"/>
                                <field name="residual"/>
                                <group col="6" colspan="4">
                                    <field name="doc_type" invisible="1"/>
                                    <button name="%(account.action_account_invoice_refund)d" type='action' string='Refund' icon="gtk-execute"
                                        attrs="{'invisible': ['|', '|',
                                                                ('state', '=', 'draft'),
                                                                ('type', 'in', ['in_refund', 'out_refund']),
                                                                '&amp;', ('doc_type', '=', 'isi'), ('counterpart_inv_status', '!=', 'inv_close')]}"
                                    />
                                    <group attrs="{'invisible': [('doc_type', 'in', ('isi', 'isr'))]}">
                                        <button name="invoice_open" states="draft,proforma2" type="object" string="Validate" icon="gtk-go-forward"/>
                                        <field name="is_direct_invoice" invisible="1"/>
                                        <button name="button_split_invoice" states="draft,proforma2" type="object" string="Split Invoice" icon="gtk-cut"/>
                                    </group>

                                </group>
                            </group>
                            <!-- for ISI/STR the display of the buttons takes the whole width -->
                            <group col="8" colspan="6" attrs="{'invisible': [('doc_type', 'not in', ('isi', 'isr'))]}">
                                <button name="button_split_invoice2" type="object"
                                        string="Split Invoice"
                                        icon="gtk-cut" colspan="4"
                                        states="draft"
                                />
                                <button name="invoice_open2" type="object"
                                        string="Validate"
                                        icon="gtk-go-forward" colspan="4"
                                        states="draft"
                                />
                            </group>
                        </page>
                        <page string="Other Info">
                            <field name="amount_to_pay"/>
                            <field domain="[('partner_id', '=', partner_id)]" name="partner_bank_id" on_change="onchange_partner_bank(partner_bank_id)"/>
                            <field name="company_id"
                                   on_change="onchange_company_id(company_id, partner_id, type, invoice_line, currency_id, context)"
                                   widget="selection" groups="base.group_multi_company"/>
                            <newline/>
                            <field name="payment_term" widget="selection"/>
                            <field name="name"
                                   attrs="{'readonly': ['|',
                                                       ('state', '!=', 'draft'),
                                                       '&amp;', '&amp;', ('type', '=', 'in_invoice'), ('synced', '=', True), ('from_supply', '=', True)]}"/>
                            <newline/>
                            <field name="refunded_invoice_id" invisible="1"/>
                            <field name="origin" groups="base.group_extended"
                                   attrs="{'readonly': ['|', '|',
                                                        ('state', '!=', 'draft'),
                                                        ('refunded_invoice_id', '!=', False),
                                                        '&amp;', ('type', '=', 'in_invoice'), ('from_supply', '=', True)]}"/>
                            <field domain="[('partner_id','=',partner_id)]" name="address_contact_id" groups="base.group_extended"/>
                            <field name="user_id"
                                   attrs="{'readonly': ['|', ('state', '!=', 'draft'), '&amp;', ('type', '=', 'in_invoice'), ('synced', '=', True)]}"/>
                            <field name="move_id" groups="account.group_account_user"/>
                            <separator colspan="4" string="Additional Information"/>
                            <field colspan="4" name="comment" nolabel="1"/>
                        </page>
                        &payment_tab;
                        <page string="Down Payments">
                            <field name="down_payment_ids" nolabel="1" colspan="4">
                                <tree string="Down Payment">
                                    <field name="move_id"/>
                                    <field name="name" string="Description"/>
                                    <field name="ref"/>
                                    <field name="date"/>
                                    <field name="partner_type"/>
                                    <field name="reconcile_txt"/>
                                    <field name="debit_currency"/>
                                    <field name="credit_currency"/>
                                    <field name="amount_currency" sum="Total Amount"/>
                                    <field name="currency_id"/>
                                </tree>
                            </field>
                        </page>
                        <!-- display the Counterpart Invoice tab in SI, hide it in SR -->
                        <page string="Counterpart Invoice" attrs="{'invisible': [('type', '!=', 'in_invoice')]}">
                            <field name="from_supply" invisible="1"/>  <!-- make the field exportable -->
                            <field name="synced" readonly="1"/>  <!-- SI can never be ticked as "Synced" manually -->
                            <newline/>
                            <field name="counterpart_inv_number"/>
                            <field name="counterpart_inv_status"/>
                        </page>
                        &signature_template;
                    </notebook>
                </form>
            </field>
        </record>

        <record id="invoice_form" model="ir.ui.view">
            <field name="name">account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Stock Transfer Voucher" noteditable="state=='cancel'">
                    <group colspan="4" col="8">
                        <field name="journal_id" domain="[('inv_doc_type', '=', True), ('is_active', '=', True)]"/>
                        <field name="journal_type" invisible="1"/>
                        <field name="number"/>
                        <field name="type" invisible="1"/>
                        <field name="is_intermission" invisible="1"/>  <!-- for Payment tab -->
                        <field name="currency_id" width="50"/>
                        <button name="%(action_account_change_currency)d" type="action" icon="terp-stock_effects-object-colorize" string="Change" attrs="{'invisible':[('state','!=','draft')]}" groups="account.group_account_user"/>
                        <newline/>
                        <field string="Customer" name="partner_id"
                               domain="[('customer', '=', True)]"
                               on_change="onchange_partner_id(type, partner_id, date_invoice, payment_term, partner_bank_id, company_id, False, False, False, False, False, doc_type, from_supply)"
                               groups="base.group_user" context="{'search_default_customer': 1}"
                               attrs="{'readonly': ['|',
                                                    ('state', '!=', 'draft'),
                                                    '&amp;', '&amp;',
                                                    ('type', '=', 'out_invoice'),
                                                    ('from_supply', '=', True),
                                                    ('partner_type', 'in', ('intermission', 'section'))]}"/>
                        <field domain="[('partner_id','=',partner_id)]" name="address_invoice_id"/>
                        <newline/>
                        <field name="document_date"/>
                        <field name="date_invoice"/>
                        <group colspan="2" col="1" groups="account.group_account_user">
                        </group>
                    </group>
                    <group colspan="4" col="8" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}">
                            <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-check" context="context" colspan="4" attrs="{'invisible': [('analytic_distribution_id', '=', False)]}"/>
                            <button name="button_reset_distribution" string="Reset AD at line level" type="object" icon="gtk-undelete" colspan="4" states="draft"/>
                    </group>
                    <group colspan="4" col="8" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}">
                            <button name="button_analytic_distribution" string="Analytical Distribution" type="object" icon="terp-emblem-important" context="context" colspan="4" attrs="{'invisible': [('analytic_distribution_id', '!=', False)]}"/>
                            <button name="button_reset_distribution" string="Reset AD at line level" type="object" icon="gtk-undelete" colspan="4" states="draft"/>
                    </group>
                    <field name="analytic_distribution_id" invisible="1"/>
                    <group colspan="3"/>
                    <notebook colspan="4">
                        <page string="Invoice">
                            <field domain="[('company_id', '=', company_id), ('restricted_area', '=', 'out_invoice')]" name="account_id" />
                            <field name="name" attrs="{'readonly': ['|',
                                                                    ('state', '!=', 'draft'),
                                                                    '&amp;', '&amp;',
                                                                    ('type', '=', 'out_invoice'),
                                                                    ('from_supply', '=', True),
                                                                    ('partner_type', 'in', ('intermission', 'section'))]}"/>
                            <field name="payment_term" widget="selection"/>
                            <group name="import" string=" Import Lines " colspan="4" col="4"
                                attrs="{'invisible': [('state', '!=', 'draft'), ('type', '!=', 'out_invoice')]}">
                                <button name="import_invoice" string="Import Invoice Line" icon="gtk-execute" colspan="2" type="object"
                                    attrs="{'readonly': [('state', '!=', 'draft')],
                                    'invisible': [('type', '!=', 'out_invoice')]}"/>
                                <button name="export_invoice" string="Export Invoice Line" icon="gtk-execute" colspan="2" type="object"
                                    attrs="{'invisible': [('type', '!=', 'out_invoice')]}"
                                    force_editable="1"/>
                                <newline/>
                                <button name="wizard_import_si_line" string="Import lines" icon="gtk-dnd" colspan="4" type="object"
                                    attrs="{'invisible': [('state', '!=', 'draft')],
                                    'readonly': [('type', '=', 'out_invoice'),
                                    ('from_supply', '=', True),
                                    ('partner_type', 'in', ('intermission', 'section'))]}"/>
                            </group>
                            <field colspan="4" name="invoice_line" nolabel="1" context="{'fake': 1, 'from_inv_form': True}">
                                <tree string="Invoice Line"
                                      colors="red:analytic_distribution_state in ('invalid', 'invalid_small_amount') or inactive_product == True or not account_id;black:inactive_product == False and analytic_distribution_state in ('none', 'valid') and account_id"
                                      editable="both">
                                    <field name="invoice_type" invisible="1"/>
                                    <field name="line_synced" invisible="1"/>
                                    <field name="from_supply" invisible="1"/>
                                    <field name="partner_type" invisible="1"/>
                                    <field name="line_number" displayon="noteditable"/>
                                    <field name="is_corrected" invisible="1"/>
                                    <button name="button_open_analytic_lines" string="Have been corrected" type="object"
                                            icon="terp-mail-" attrs="{'invisible': [('is_corrected', '=', False)]}"/>
                                    <field name="inactive_product" invisible="1"/>
                                    <field name="product_id"
                                           on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, {'company_id': parent.company_id})"
                                           attrs="{'readonly': ['|',
                                                                '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                                '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"
                                    />
                                    <field name="account_id"
                                           domain="[('journal_id', '=', parent.journal_id), ('restricted_area', '=', 'invoice_lines')]"
                                           required="1"
                                           context="{'type': parent.type, 'journal_type': parent.journal_type}"
                                    />
                                    <button name="button_analytic_distribution" string="Analytical Distribution" type="object"
                                            icon="terp-stock_symbol-selection" context="context"
                                            attrs="{'invisible': [('is_allocatable', '=', False)]}"/>
                                    <field name="analytic_distribution_state_recap" readonly="1"/>
                                    <field name="analytic_distribution_state" invisible="1"/>
                                    <field name="is_allocatable" invisible="1"/>
                                    <field name="quantity"
                                           attrs="{'readonly': ['|',
                                                                '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                                '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"/>
                                    <field name="uos_id" string="UoM"
                                           on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.address_invoice_id, parent.currency_id, {'company_id': parent.company_id})"
                                           attrs="{'readonly': ['|',
                                                                '&amp;', ('invoice_type', '=', 'in_invoice'), '|', ('line_synced', '=', True), ('from_supply', '=', True),
                                                                '&amp;', '&amp;', ('invoice_type', '=', 'out_invoice'), ('from_supply', '=', True), ('partner_type', 'in', ('intermission', 'section'))]}"/>
                                    <field name="price_unit"
                                           attrs="{'readonly': [('invoice_type', '=', 'in_invoice'), ('line_synced', '=', True)]}"/>
                                    <field name="price_subtotal"/>
                                    <field name="name"/>
                                </tree>
                            </field>
                            <group col="1" colspan="2" />
                            <group col="8" colspan="4">
                                <label string="" colspan="3"/>
                                <field name="reconciled"/>
                                <field name="amount_total"/>
                                <label string="" colspan="3"/>
                                <field name="state"/>
                                <field name="residual"/>
                                <field name="is_debit_note" invisible="1"/>
                            </group>
                            <field name="partner_type" invisible="1"/>
                            <group col="8" colspan="4">

                                <field name="doc_type" invisible="1"/>

                                <button string="Cancel document" name="invoice_cancel"
                                        type="workflow" icon="gtk-cancel"
                                        confirm="Do you really want to cancel this document?"
                                        attrs="{'invisible': ['|', '|',
                                                              ('state', '!=', 'draft'),
                                                              ('type', '!=', 'out_invoice'),
                                                              ('from_supply', '=', False)]}"/>

                                <button name="button_split_invoice" type="object" string="Split Stock Transfer Voucher"
                                        icon="gtk-cut"
                                        context="{'from_stv': True}"
                                        attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('doc_type', '!=', 'stv')]}"/>

                                <button name="%(account.action_account_invoice_refund)d" type='action' string='Refund' icon="gtk-execute" attrs="{'invisible': ['|', ('state', 'in', ['draft']), ('type', 'in', ['in_refund', 'out_refund'])]}"/>
                                <!-- add a confirmation step only for STV (not for CR/STR)
                                     when the partner type is compatible with a synchro but "synced" isn't ticked -->
                                <button name="invoice_open" type="object" string="Validate"
                                        icon="gtk-go-forward"
                                        attrs="{'invisible': ['|',
                                                              ('state', '!=', 'draft'),
                                                              '&amp;',
                                                              ('doc_type', '=', 'stv'), ('partner_type', 'in', ('intermission', 'section')) ]}"/>
                                <button name="invoice_open_with_confirmation" type="object" string="Validate"
                                        icon="gtk-go-forward"
                                        confirm="Are you sure you want to validate this invoice without synchronization?"
                                        attrs="{'invisible': ['|', '|', '|',
                                                              ('state', '!=', 'draft'),
                                                              ('doc_type', '!=', 'stv'),
                                                              ('synced', '=', True),
                                                              ('partner_type', 'not in', ('intermission', 'section'))]}"/>

                                <button name="invoice_open_with_sync_confirmation" type="object" string="Validate"
                                        icon="gtk-go-forward"
                                        confirm="This invoice will sync to its counterpart instance."
                                        attrs="{'invisible': ['|', '|', '|',
                                                              ('state', '!=', 'draft'),
                                                              ('doc_type', '!=', 'stv'),
                                                              ('synced', '=', False),
                                                              ('partner_type', 'not in', ('intermission', 'section'))]}"/>
                                <button name="%(account.account_invoices)d" string="Print Invoice" type="action" icon="gtk-print" states="open,paid,inv_close,proforma,sale,proforma2"/>
                            </group>
                        </page>
                        <page string="Other Info">
                            <field name="company_id" on_change="onchange_company_id(company_id, partner_id, type, invoice_line, currency_id, context)"
                                   widget="selection" groups="base.group_multi_company"/>
                            <newline/>
                            <field name="date_due"/>
                            <field name="user_id" attrs="{'readonly': ['|',
                                                                       ('state', '!=', 'draft'),
                                                                       '&amp;', '&amp;',
                                                                       ('type', '=', 'out_invoice'),
                                                                       ('from_supply', '=', True),
                                                                       ('partner_type', 'in', ('intermission', 'section'))]}"/>
                            <newline/>
                            <field domain="[('partner_id.ref_companies', 'in', [company_id])]" name="partner_bank_id"
                                groups="base.group_extended"/>
                            <field name="refunded_invoice_id" invisible="1"/>
                            <field name="origin" attrs="{'readonly': ['|', '|',
                                                                      ('state', '!=', 'draft'),
                                                                      ('refunded_invoice_id', '!=', False),
                                                                      '&amp;', '&amp;',
                                                                      ('type', '=', 'out_invoice'),
                                                                      ('from_supply', '=', True),
                                                                      ('partner_type', 'in', ('intermission', 'section'))]}"/>
                            <field colspan="4" domain="[('partner_id','=',partner_id)]" name="address_contact_id"
                                groups="base.group_extended"/>
                            <field name="move_id" groups="account.group_account_user"/>
                            <separator colspan="4" string="Additional Information"/>
                            <field colspan="4" name="comment" nolabel="1"/>
                        </page>
                        &payment_tab;
                        <!-- display the Counterpart Invoice tab in STV, hide it in CR/STR -->
                        <page string="Counterpart Invoice" attrs="{'invisible': [('type', '!=', 'out_invoice')]}">
                            <field name="from_supply" invisible="1"/>
                            <field name="synced"
                                   attrs="{'readonly': ['|', ('from_supply', '=', True), ('state', '!=', 'draft')]}"
                                   on_change="onchange_synced(synced, partner_id)"/>
                            <newline/>
                            <field name="counterpart_inv_number"/>
                            <field name="counterpart_inv_status"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record id="view_account_invoice_filter" model="ir.ui.view">
            <field name="name">account.invoice.select</field>
            <field name="model">account.invoice</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Invoice">
                   <group col="10" colspan="4">
                        <filter name="draft" icon="terp-document-new" string="Draft" domain="[('state','=','draft')]" help="Draft Invoices"/>
                        <filter name="unpaid" icon="terp-dolar_ok!" string="Open" domain="[('state','=','open')]" help="Open Invoices"/>
                        <filter name="paid" icon="terp-dolar" string="Paid" domain="[('state', '=', 'paid')]"/>
                        <filter name="closed" icon="terp-dialog-close" string="Closed" domain="[('state', '=', 'inv_close')]" />
                        <filter name="cancel_state" icon="terp-gtk-stop" string="Cancelled" domain="[('state', '=', 'cancel')]"/>
                        <separator orientation="vertical"/>
                        <filter name="not_imported" icon="gtk-cancel" string="Not imported" domain="[('imported_state', '=', 'not')]"/>
                        <filter name="partial" icon="terp-dolar_ok!" string="Partially imported" domain="[('imported_state', '=', 'partial')]"/>
                        <filter name="imported" icon="gtk-apply" string="Imported" domain="[('imported_state', '=', 'imported')]"/>
                        <separator orientation="vertical"/>
                        <filter name="open_fy" icon="terp-go-year" string="Open FY" domain="[('open_fy', '=', True)]"/>
                        <separator orientation="vertical"/>
                        <filter name="draft_cp" icon="terp-document-new" string="Draft Counterparts" domain="[('counterpart_inv_status','=','draft')]" help="Draft Counterparts Invoices"/>
                        <filter name="open_cp" icon="terp-dolar_ok!" string="Open Counterparts" domain="[('counterpart_inv_status','=','open')]" help="Open Counterparts Invoices"/>
                        <filter name="paid_cp" icon="terp-dolar" string="Paid Counterparts" domain="[('counterpart_inv_status', '=', 'paid')]"/>
                        <filter name="closed_cp" icon="terp-dialog-close" string="Closed Counterparts" domain="[('counterpart_inv_status', '=', 'inv_close')]" />

                        <separator orientation="vertical"/>
                        <field name="number"/>
                        <field name="partner_id"/>
                        <field name="origin"/>
                    </group>

                    <newline/>
                    <group col="10" colspan="4">
                        <field name="currency_id" string="Booking Currency" select='1' />
                        <field name="period_id" select='1' string="Period" domain="[('state', 'not in', ['done', 'created'])]"/>
                        <field name="supplier_reference"/>
                        <field name="name"/>
                        <field name="amount_total"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Journal" icon="terp-folder-orange" domain="[]" context="{'group_by':'journal_id'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]"  context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Period" icon="terp-go-month" domain="[]" context="{'group_by':'period_id'}"/>
                        <filter string="Invoice Date" icon="terp-go-month" domain="[]"  context="{'group_by':'date_invoice'}"/>
                        <filter string="Due Date" icon="terp-go-month" domain="[]"  context="{'group_by':'date_due'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="action_invoice_tree" model="ir.actions.act_window">
            <field name="name">Invoices</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="view_id" ref="invoice_tree"/>
            <field name="context">{'type':'out_invoice'}</field>
            <field name="search_view_id" ref="view_account_invoice_filter"/>
        </record>

        <record id="action_invoice_tree_pending_invoice" model="ir.actions.act_window">
            <field name="name">Pending Invoice</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="view_id" ref="invoice_tree"/>
            <field name="context">{'type':'out_invoice'}</field>
            <field name="domain">[('state','=','draft')]</field>
           <!-- <field name="search_view_id" ref="view_account_invoice_filter"/>-->
        </record>

        <record id="action_invoice_tree_view1" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="act_window_id" ref="action_invoice_tree"/>
        </record>

        <record id="action_invoice_tree_view2" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="invoice_form"/>
            <field name="act_window_id" ref="action_invoice_tree"/>
        </record>

    <!-- Fix customer invoice display with a bypass on 'is_debit_note' set to True -->
        <record id="account.action_invoice_tree1" model="ir.actions.act_window">
            <field name="name">Customer Invoices</field>  <!-- Stock Transfer Vouchers -->
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('doc_type', '=', 'stv')]</field>
            <field name="context">{'doc_type': 'stv', 'type': 'out_invoice', 'journal_type': 'sale', 'from_inv_form': True, 'search_default_draft': 1, 'search_default_unpaid': 1, 'search_default_paid': 1, 'search_default_closed': 1, 'search_default_open_fy': 1}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="help">With Customer Invoices you can create and manage sales invoices issued to your customers. OpenERP can also generate draft invoices automatically from sales orders or deliveries. You should only confirm them before sending them to your customers.</field>
        </record>


        <record id="action_invoice_tree1_view1" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="act_window_id" ref="action_invoice_tree1"/>
        </record>

        <record id="action_invoice_tree1_view2" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="invoice_form"/>
            <field name="act_window_id" ref="action_invoice_tree1"/>
        </record>

        <!-- STV -->
        <menuitem action="action_invoice_tree1" id="menu_action_invoice_tree1" parent="menu_finance_receivables" sequence="3"/>

          <!-- Fix supplier invoice display with a bypass on 'is_inkind_donation' set to True -->
        <record id="account.action_invoice_tree2" model="ir.actions.act_window">
            <field name="name">Supplier Invoices</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <!-- US-2704 if the domain change, do not forget to update the domain of account_board_supplier_invoice_draft in finance/board_account_view.xml -->
            <field name="domain">[('doc_type', '=', 'si')]</field>
            <field name="context">{'doc_type': 'si', 'type': 'in_invoice', 'journal_type': 'purchase', 'from_inv_form': True}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="help">With Supplier Invoices you can enter and manage invoices issued by your suppliers.
                OpenERP can also generate draft invoices automatically from purchase orders or receipts. This way, you can control the invoice
                from your supplier according to what you purchased or received.</field>
        </record>

        <menuitem action="action_invoice_tree2" id="menu_action_invoice_tree2" parent="menu_finance_payables" sequence="10"/>

        <record id="action_invoice_tree3" model="ir.actions.act_window">
            <field name="name">Customer Refunds</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('doc_type', '=', 'cr')]</field>
            <field name="context">{'doc_type': 'cr', 'type': 'out_refund', 'journal_type': 'sale_refund'}</field>
            <field name="search_view_id" ref="view_account_invoice_filter"/>
            <field name="help">With Customer Refunds you can manage the credit notes for your customers. A refund is a document that credits an invoice completely or partially. You can easily generate refunds and reconcile them directly from the invoice form.</field>
        </record>

        <record id="action_invoice_tree3_view1" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="act_window_id" ref="action_invoice_tree3"/>
        </record>

        <record id="action_invoice_tree3_view2" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="invoice_form"/>
            <field name="act_window_id" ref="action_invoice_tree3"/>
        </record>
        <!-- Customer Refunds Menu -->
        <menuitem action="action_invoice_tree3" id="menu_action_invoice_tree3" parent="menu_finance_receivables" sequence="6"/>

        <record id="action_invoice_tree4" model="ir.actions.act_window">
            <field name="name">Supplier Refunds</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('doc_type', '=', 'sr')]</field>
            <field name="context">{'doc_type': 'sr', 'type': 'in_refund', 'journal_type': 'purchase_refund'}</field>
            <field name="search_view_id" ref="view_account_invoice_filter"/>
            <field name="help">With Supplier Refunds you can manage the credit notes you receive from your suppliers. A refund is a document that credits an invoice completely or partially. You can easily generate refunds and reconcile them directly from the invoice form.</field>
        </record>
        <menuitem action="action_invoice_tree4" id="menu_action_invoice_tree4" parent="menu_finance_payables" sequence="15"/>


        <record id="generic_invoice_tree" model="ir.ui.view">
            <field name="name">account.invoice.generic.tree</field>
            <field name="model">account.invoice</field>
            <field name="type">tree</field>
            <field name="priority" eval="100" />
            <field name="arch" type="xml">
                <tree colors="blue:state in ('draft');black:state in ('proforma','proforma2','open');gray:state in ('cancel')" string="Invoice" hide_new_button="1" hide_edit_button="1" hide_delete_button="1">
                    <button name="invoice_open_form_view" string="Display Invoice" icon="gtk-go-forward" type="object"/>
                    <field name="doc_type"/>
                    <field name="date_invoice"/>
                    <field name="number"/>
                    <field name="partner_id"/>
                    <field name="name"/>
                    <field name="date_due"/>
                    <field name="origin"/>
                    <field name="line_count"/>
                    <field name="currency_id"/>
                    <field name="residual" sum="Residual Amount"/>
                    <field name="amount_untaxed" sum="Untaxed Amount"/>
                    <field name="amount_total" sum="Total Amount"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <act_window context="{'search_default_partner_id': [active_id], 'generic_invoice': True}" id="act_res_partner_2_account_invoice_opened" name="Invoices" res_model="account.invoice" src_model="res.partner" view_id="generic_invoice_tree" view_mode="tree" search_view_id="view_account_invoice_filter"/>


        <act_window
           id="act_account_journal_2_account_invoice_opened"
           name="Unpaid Invoices"
           context="{'search_default_journal_id':active_id, 'search_default_unpaid':1,}"
           res_model="account.invoice"
           src_model="account.journal"/>

        <!-- STOCK TRANSFER REFUNDS -->
        <record id="action_str" model="ir.actions.act_window">
            <field name="name">Stock Transfer Refunds</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('doc_type', '=', 'str')]</field>
            <field name="context">{'doc_type': 'str', 'type': 'out_refund', 'from_inv_form': True}</field>
            <field name="search_view_id" ref="view_account_invoice_filter"/> <!-- as for Customer Refunds -->
        </record>
        <record id="action_str_tree" model="ir.actions.act_window.view">
            <field eval="30" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="invoice_tree"/> <!-- as for Customer Refunds (default tree view) -->
            <field name="act_window_id" ref="action_str"/>
        </record>
        <record id="action_str_form" model="ir.actions.act_window.view">
            <field eval="35" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="invoice_form"/>  <!-- as for Customer Refunds -->
            <field name="act_window_id" ref="action_str"/>
        </record>
        <menuitem action="action_str" id="menu_action_str" parent="menu_finance_receivables" sequence="4"/>

        <!-- INTERSECTION SUPPLIER INVOICES -->
        <record id="action_isi" model="ir.actions.act_window">
            <field name="name">Intersection Supplier Invoices</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('doc_type', '=', 'isi')]</field>
            <field name="context">{'doc_type': 'isi', 'type': 'in_invoice', 'from_inv_form': True, 'search_default_open_fy': 1}</field>
            <field name="search_view_id" ref="view_account_invoice_filter"/> <!-- as for Supplier Invoices -->
        </record>
        <record id="action_isi_tree" model="ir.actions.act_window.view">
            <field eval="40" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="invoice_tree"/> <!-- default tree view -->
            <field name="act_window_id" ref="action_isi"/>
        </record>
        <record id="action_isi_form" model="ir.actions.act_window.view">
            <field eval="45" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="invoice_supplier_form"/>
            <field name="act_window_id" ref="action_isi"/>
        </record>
        <menuitem action="action_isi" id="menu_action_isi" parent="menu_finance_payables" sequence="20"/>

        <!-- INTERSECTION SUPPLIER REFUNDS -->
        <record id="action_isr" model="ir.actions.act_window">
            <field name="name">Intersection Supplier Refunds</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('doc_type', '=', 'isr')]</field>
            <field name="context">{'doc_type': 'isr', 'type': 'in_refund', 'from_inv_form': True}</field>
            <field name="search_view_id" ref="view_account_invoice_filter"/> <!-- as for Supplier Refunds -->
        </record>
        <record id="action_isr_tree" model="ir.actions.act_window.view">
            <field eval="50" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="invoice_tree"/> <!-- default tree view -->
            <field name="act_window_id" ref="action_isr"/>
        </record>
        <record id="action_isr_form" model="ir.actions.act_window.view">
            <field eval="55" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="invoice_supplier_form"/>
            <field name="act_window_id" ref="action_isr"/>
        </record>
        <menuitem action="action_isr" id="menu_action_isr" parent="menu_finance_payables" sequence="22"/>

    </data>
</openerp>
