<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="tender_form" model="ir.ui.view">
            <field name="name">tender.form</field>
            <field name="model">tender</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Tender">
                    <group col="6" colspan="4">
                        <field name="creator" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="creation_date" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="requested_date" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="name" />
                        <field name="sale_order_id" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="warehouse_id" widget="selection" on_change="onchange_warehouse(warehouse_id)" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="location_id" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="company_id" invisible="True" />
                        <field name="categ" attrs="{'readonly': [('state', '!=', 'draft')]}"
                            on_change="onchange_categ(categ)"/>
                        <field name="priority" attrs="{'readonly': [('state', '!=', 'draft')]}" />
                        <field name="delivery_address" attrs="{'readonly': [('state', '!=', 'draft')]}" domain="[('dest_address', '=', company_id)]"/>
                        <group col="4" colspan="2">
                            <field name="currency_id" colspan="1" attrs="{'readonly': [('state', '!=', 'comparison')]}" />
                            <button name="change_currency" string="Change Cur." icon="terp-dolar" type="object" attrs="{'invisible': [('state', '!=', 'comparison')]}" />
                        </group>
                        <field name="details" />
                    </group>
                    <notebook colspan="5">
                        <page string="Tender Lines">
                            <field colspan="4" mode="tree,form,graph" name="tender_line_ids" nolabel="1" widget="one2many_list">
                                <tree string="Tender Lines" editable="top" hide_delete_button="1" noteditable="line_state in ['cancel', 'done']" colors="blue: line_state=='cancel'">
                                    <field name="product_default_code" displayon="noteditable"/>
                                    <field name="product_name" displayon="noteditable"/>
                                    <field name="product_id" on_change="on_product_change(product_id, product_uom, qty, parent.categ)" attrs="{'readonly': [('state', '!=', 'draft')]}" context="{'available_for_restriction': 'tender', 'search_default_not_restricted': 1}" displayon="editable" />
                                    <field name="comment" />
                                    <field name="qty" attrs="{'readonly': [('state', '!=', 'draft')]}" 
                                        on_change="onchange_uom_qty(product_uom, qty)" />
                                    <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft')]}" domain="[('uom_by_product', '=', product_id)]"/>
                                    <field name="price_unit" />
                                    <field name="total_price" />
                                    <field name="currency_id" />
                                    <field name="supplier_id" />
                                    <field name="purchase_order_id" />
                                    <field name="purchase_order_line_number" />
                                    <field name="created_by_rfq" invisible="0" readonly="1" />
                                    <field name="delivery_confirmed_date" />
                                    <field name="state" invisible="1" />
                                    <field name="line_state" invisible="1" />
                                    <button name="ask_unlink" type="object" string="Cancel" icon="gtk-del" attrs="{'invisible': ['|', ('state', '=', 'done'), ('line_state', 'in', ['done', 'cancel'])]}" />
                                </tree>
                            </field>
                            <newline/>
                            <group col="13" colspan="10">
                            </group>
                        </page>
                        <page string="Suppliers">
                            <field colspan="4" mode="tree,form,graph" name="supplier_ids" nolabel="1" attrs="{'readonly': ['|', ('state', 'not in', ['draft', 'comparison']), ('internal_state', '=', 'updated')]}" domain="[('check_partner_rfq', '=', active_id),('partner_not_int','in', { 'type':'tender', 'ids':[active_id] } )]" context="{'tender_id': parent_id}"  on_change="change_supplier(supplier_ids)">
                                <tree string="Suppliers" hide_delete_button="1">
                                    <field name="name" />
                                    <field name="partner_type" />
                                    <field name="city" />
                                    <field name="country" />
                                    <field name="is_rfq_generated" invisible="1"/>
                                    <button name="deletem2m" string="Delete" special="deletem2m" icon="gtk-del" attrs="{'invisible': [('is_rfq_generated', '=', True)]}"/>
                                </tree>
                            </field>
                        </page>
                        <page string="RfQs">
                            <field colspan="4" mode="tree,form,graph" name="rfq_ids" nolabel="1" attrs="{'readonly': [('state', '!=', 'draft')]}"
                                context="{'rfq_ok': True}" >
                                <tree string="RfQs">
                                    <field name="name" />
                                    <field name="partner_id" />
                                    <field name="notes" />
                                    <field name="amount_total" />
                                    <field name="currency_id" />
                                    <field name="amount_total_tender_currency" />
                                    <field name="rfq_state" />
                                </tree>
                            </field>
                        </page>
                        <page string="Notes">
                            <field name="notes" nolabel="1" />
                        </page>
                    </notebook>
                    <group col="13" colspan="4">
                        <field name="state" />
                        <field name="internal_state" invisible="True"/>
                        <field name="diff_nb_rfq_supplier" invisible="True"/>
                        <button name="cancel_tender" type="object" string="Cancel" icon="gtk-cancel" attrs="{'invisible':[('state', 'in', ['cancel', 'done'])]}" />
                        <button name="button_generate" string="Generate RfQs" icon="gtk-convert" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'comparison']), '&amp;', ('state', '=', 'comparison'), ('diff_nb_rfq_supplier', '=', False)]}"/>
                        <button name="compare_rfqs" string="Compare RfQs" type="object" icon="gtk-find" attrs="{'invisible': ['|', ('state', '!=', 'comparison'), ('diff_nb_rfq_supplier', '=', True)]}" />
                        <button name="update_supplier_info" states="comparison" string="Update Product's Suppliers" type="object" icon="gtk-edit"
                            attrs="{'invisible':['|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison')]}" />
                        <button name="continue_sourcing" states="comparison" type="object" string="Continue Sourcing Process" icon="gtk-go-forward"
                            attrs="{'invisible':['|', '|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'), ('sale_order_id','=', False)]}" />
                        <button name="create_po" states="comparison" string="Create PO" type="object" icon="gtk-add"
                            attrs="{'invisible':['|', '|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'), ('sale_order_id','!=', False)]}" />
                        <button name="check_update_for_done" string="Closed" type="object" icon="gtk-go-forward"
                            attrs="{'invisible':['|', '|', ('internal_state','!=', 'updated'), ('state', '!=', 'comparison'), ('sale_order_id','!=', False)]}" />
                    </group>
                </form>
            </field>
        </record>

        <record id="tender_tree" model="ir.ui.view">
            <field name="name">tender.tree</field>
            <field name="model">tender</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Tender">
                    <field name="name" />
                    <field name="priority" />
                    <field name="categ" />
                    <field name="creation_date" />
                    <field name="requested_date" />
                    <field name="sale_order_id" />
                    <field name="state" />
                </tree>
            </field>
        </record>

        <record id="tender_search_form_view" model="ir.ui.view">
            <field name="name">tender.search.form</field>
            <field name="model">tender</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Tender">
                    <filter name="draft" icon="gtk-file" string="Draft"
                            domain="[('state', '=', 'draft')]" />
                    <filter name="comparison" icon="gtk-sort-descending" string="Comparison"
                            domain="[('state', '=', 'comparison')]" />
                    <filter name="done" icon="gtk-apply" string="Closed"
                            domain="[('state', '=', 'done')]" />
                    <filter name="cancel" icon="gtk-cancel" string="Cancelled"
                            domain="[('state', '=', 'cancel')]" />
                    <field name="name" />
                    <field name="supplier_ids" string="Supplier" widget="many2one" />
                    <field name="product_id" />
                    <field name="sale_order_id" string="Sale Order" />
                    <field name="creator" />
                    <field name="creation_date" />
                    <newline />
                    <group string="Priority" expand="0">
                      <filter icon="gtk-dialog-warning" string="Emergency" domain="[('priority','=','emergency')]"/>
                      <filter icon="gtk-yes" string="Normal" domain="[('priority','=','normal')]"/>
                      <filter icon="gtk-info" string="Priority" domain="[('priority','=','priority')]"/>
                    </group>

                    <newline />

                    <group string="Category" expand="0">
                      <filter icon="gtk-color-picker" string="Medical" domain="[('categ','=','medical')]"/>
                      <filter icon="terp-stock" string="Logistic" domain="[('categ','=','log')]"/>
                      <filter icon="terp-purchase" string="Service" domain="[('categ','=','service')]"/>
                      <filter icon="gtk-harddisk" string="Other" domain="[('categ','=','other')]"/>
                    </group> 

                    <newline />

                    <group expand="0" string="Group By..." colspan="11" col="11">
                        <filter string="Priority" icon="terp-project" domain="[]" context="{'group_by': 'priority'}" />
                        <separator orientation="vertical" />
                        <filter string="Category" icon="terp-translate" domain="[]" context="{'group_by':'categ'}"/>
                        <separator orientation="vertical" />
                        <filter string="Sale Order" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'sale_order_id'}"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical" />
                        <filter string="Order Date" icon="terp-go-month" domain="[]" context="{'group_by':'creation_date'}"/>
                        <filter string="Expected Date" icon="terp-go-month" domain="[]" context="{'group_by':'requested_date'}" />
                    </group>
                </search>
            </field>
        </record>

        <record id="tender_line_tree_view" model="ir.ui.view">
            <field name="name">tender.line.tree.view</field>
            <field name="model">tender.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Tender Lines" editable="top">
                    <!-- <field name="date_planned" /> -->
                    <field name="product_id" on_change="on_product_change(product_id, product_uom, qty)" attrs="{'readonly': [('state', '!=', 'draft')]}" context="{'available_for_restriction': 'tender', 'search_default_not_restricted': 1}" />
                    <field name="comment" />
                    <field name="qty" attrs="{'readonly': [('state', '!=', 'draft')]}" 
                           on_change="onchange_uom_qty(product_uom, qty)" />
                    <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft')]}" domain="[('uom_by_product', '=', product_id)]"/>
                    <field name="supplier_id" />
                    <field name="price_unit" />
                    <field name="total_price" />
                    <field name="currency_id" />
                    <field name="purchase_order_id" />
                    <field name="purchase_order_line_number" />
                    <field name="state" invisible="1" />
                </tree>
            </field>
        </record>

        <record id="tender_action" model="ir.actions.act_window">
            <field name="name">Tenders</field>
            <field name="res_model">tender</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[]</field>
            <field name="search_view_id" ref="tender_search_form_view" />
        </record>

        <menuitem icon="STOCK_INDENT" action="tender_action"
            id="menu_tender" parent="purchase.menu_procurement_management" sequence="3" />

        <record id="tender_action_dashboard" model="ir.actions.act_window">
            <field name="name">Tenders</field>
            <field name="res_model">tender</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state', 'not in', ['done', 'cancel'])]</field>
            <field name="search_view_id" ref="tender_search_form_view" />
        </record>

       <record id="product_supplierinfo_form_view" model="ir.ui.view">
            <field name="name">product.supplierinfo.form.view</field>
            <field name="model">product.supplierinfo</field>
            <field name="type">form</field>
            <field name="priority">35</field>
            <field name="inherit_id" ref="supplier_catalogue.product_supplierinfo_form_view" />
            <field name="arch" type="xml">
                <data>

                    <xpath expr="//field[@name='pricelist_ids']" position="attributes">
                        <attribute name="context">{'partner_id': name}</attribute>
                    </xpath>

                    <xpath expr="//tree[@string='Pricelist']/field[@name='rounding']" position="after">
                        <field name="partner_id" />
                        <field name="currency_id" domain="[('partner_currency', '=', partner_id)]" />
                    </xpath>

                    <xpath expr="//tree[@string='Pricelist']/field[@name='valid_from']" position="after">
                        <field name="valid_till" />
                        <field name="comment" />
                        <field name="purchase_order_id" />
                        <field name="purchase_order_line_number" />
                        <field name="purchase_order_line_id" />
                    </xpath>
                 </data>
            </field>
        </record>

        <record id="product_supplierinfo_form_view2" model="ir.ui.view">
            <field name="name">product.supplierinfo.form.view</field>
            <field name="model">product.supplierinfo</field>
            <field name="type">form</field>
            <field name="priority">20</field>
            <field name="inherit_id" ref="product.product_supplierinfo_form_view" />
            <field name="arch" type="xml">
                <data>
                    <!-- Modificaiton of lines -->
                    <xpath expr="//form/field[@name='price']" position="after">
                        <field name="partner_id" />
                        <field name="currency_id" domain="[('partner_currency', '=', partner_id)]" />
                        <field name="valid_till" />
                        <field name="purchase_order_id" />
                        <field name="purchase_order_line_number" />
                        <field name="purchase_order_line_id" />
                    </xpath>

                </data>
            </field>
        </record>

        <record id="view_rfq_form" model="ir.ui.view">
            <field name="name">request.for.quotation.form</field>
            <field name="model">purchase.order</field>
            <field name="type">form</field>
            <field name="priority">21</field>
            <field name="arch" type="xml">
                <form string="Request for Quotation">
                    <group col="6" colspan="4">
                        <field name="name" readonly="True"/>
                        <field name="date_order" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="invoiced" attrs="{'invisible': [('rfq_state', '=', 'draft')]}"/>
                        <newline/>
                        <field name="warehouse_id" on_change="onchange_warehouse_id(warehouse_id,order_type,dest_address_id)" widget="selection" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="partner_ref" attrs="{'readonly': ['|', ('partner_type', 'not in', ['external', 'esc']), ('rfq_state', '!=', 'draft')]}"/>
                        <field name="shipped" attrs="{'invisible': [('rfq_state', '=', 'draft')]}"/>
                        <field name="push_fo" invisible="1"/>
                        <field name="order_type" on_change="onchange_internal_type(order_type, partner_id, categ, dest_partner_id, warehouse_id, delivery_requested_date)" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="priority" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <newline />
                        <field name="categ" on_change="onchange_categ(categ, warehouse_id, cross_docking_ok, location_id)" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="details" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="parent_order_name" readonly="True" attrs="{'invisible': [('parent_order_name', '=', False)]}" />
                        <newline />
                        <field name="valid_till" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="tender_id" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="loan_duration" attrs="{'invisible': [('order_type', 'not in', ['loan', 'loan_return'])], 'required': [('order_type', 'in', ['loan', 'loan_return'])], 'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}" />
                        <field name="rfq_delivery_address" attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}"/>
                        <field name="from_procurement" invisible="1"/>
                    </group>
                    <notebook colspan="4">
                        <page string="Request for Quotation">
                            <group attrs="{'readonly': [('rfq_state', 'in', ['updated','done','cancel'])]}">
                                <field name="partner_id" on_change="onchange_partner_id(partner_id)" context="{'search_default_supplier':1}" domain="[('id', '!=', company_id)]" />
                                <field name="partner_type"/>
                                <field name="allocation_setup" invisible="1" />
                                <field name="partner_address_id"/>
                                <field name="origin" groups="base.group_extended" widget="char"/>
                                <field name="internal_type"/>
                                <field name="customer_ref" widget="char"/>
                                <group colspan="4">
                                    <field name="pricelist_id" string="Currency"/>
                                    <button name="change_currency" string="Change currency" icon="terp-dolar" type="object" attrs="{'invisible': [('state', 'in', ['rfq_updated', 'done', 'cancel'])]}" />
                                </group>
                            </group>
                            <button colspan="4" string="Round Qty to SoQ" type="object" name="round_to_soq" icon="gtk-execute" attrs="{'invisible': [('rfq_state', '!=', 'draft')]}" />
                            <newline/>
                            <button name="wizard_import_po_line" string="Import RfQ lines" colspan="4" icon="gtk-dnd" type="object" attrs="{'invisible':[('rfq_state', 'not in', ['sent', 'done'])]}"/>
                            <field colspan="4" name="order_line" nolabel="1" mode="tree,form" attrs="{'readonly': [('rfq_state', 'in', ['updated', 'done', 'cancel'])]}" context="{'rfq_ok': 1}">
                                <tree string="Lines" hide_delete_button="True" colors="red:to_correct_ok == True or inactive_product == True or red_color == True or (not default_code and not nomenclature_description); #C8C8C8: fake_state == 'cancel'; orange:product_qty == 0.00;blue: soq_updated == True" editable="both">
                                    <field name="line_number" readonly="1"/>
                                    <field name="default_code" displayon="noteditable"/>
                                    <field name="default_name" displayon="noteditable"/>
                                    <field name="product_id" context="partner_id=parent.partner_id,quantity=product_qty,pricelist=parent.pricelist_id,uom=product_uom,warehouse=parent.warehouse_id, available_for_restriction=parent.partner_type,search_default_not_restricted=1,categ=parent.categ" on_change="product_id_on_change(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id, parent.date_order,parent.fiscal_position,date_planned,name,price_unit,notes,parent.state,old_price_unit,nomen_manda_0,comment,context,False,False,linked_sol_id,po_order_type)" attrs="{'readonly': [('tender_line_id', '!=', False)], 'required': [('comment', '=', False)]}" default_focus="1" displayon="editable"/>
                                    <field name="comment" attrs="{'required':[('product_id', '=', False)]}"/>
                                    <field name="nomenclature_description" readonly="1"/>
                                    <button name="openform"
                                        special="openform"
                                        string="Configurator"
                                        attrs="{'invisible': ['|', '|', ('default_code', '!=', False), ('fake_state', 'not in', ['draft', 'draft_p', 'validated_n', 'validated']), ('rfq_state', 'in', ['updated', 'done', 'cancel'])]}"
                                        context="{'nom_configurator': True}"
                                        icon="terp-go-week" />
                                    <field name="product_qty" string="Qty" context="partner_id=parent.partner_id,quantity=product_qty,pricelist=parent.pricelist_id,uom=product_uom,warehouse=parent.warehouse_id" on_change="product_qty_change(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id,parent.date_order,parent.fiscal_position,date_planned,name,price_unit,notes,parent.state,old_price_unit,nomen_manda_0,comment, context)"/>
                                    <field name="product_uom" on_change="product_uom_change(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id, parent.date_order,parent.fiscal_position,date_planned,name,price_unit,notes)" domain="[('uom_by_product', '=', product_id)]"/>
                                    <field name="price_unit" on_change="price_unit_change(fake_id, price_unit, product_id, product_uom, product_qty, parent.pricelist_id, parent.partner_id, parent.date_order, change_price_ok, parent.state, old_price_unit, nomen_manda_0, comment, context)"/>
                                    <field name="price_subtotal" readonly="1"/>
                                    <field name="currency_id" readonly="1"/>
                                    <field name="date_planned" attrs="{'readonly': [('fake_state', 'not in', ('', 'draft', 'validated_n', 'validated'))]}"/>
                                    <field name="confirmed_delivery_date" readonly="1"/>
                                    <field name="stock_take_date" attrs="{'readonly': [('fake_state', 'not in', ['', 'draft'])]}"/>
                                    <field name="tender_line_id" invisible="1" />
                                    <field name="to_correct_ok" invisible="1"/>
                                    <field name="inactive_product" invisible="1" />
                                    <field name="red_color" invisible="1" />
                                    <field name="soq_updated" invisible="1" readonly="1" />
                                    <field name="fake_id" invisible="1"/>
                                    <field name="change_price_ok" invisible="1"/>
                                    <field name="old_price_unit" invisible="1"/>
                                    <field name="nomen_manda_0" invisible="1"/>
                                    <field name="fake_state" invisible="1"/>
                                    <field name="rfq_line_state_to_display"/>
                                    <button string="Cancel" icon="gtk-del" type="object" name="ask_unlink" attrs="{'invisible': ['|', ('fake_state', 'in', ['cancel', 'cancel_r', 'done']), ('rfq_state', 'in', ['updated', 'done', 'cancel'])]}" />
                                </tree>
                            </field>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="notes" nolabel="1"/>
                            <separator colspan="4" string="Message ESC" />
                            <field name="message_esc" colspan="4" nolabel="1" readonly="1" attrs="{'invisible': [('partner_type', '!=', 'esc')]}" />
                            <separator colspan="4" string="Project info" />
                            <field name="project_ref" readonly="1" />
                        </page>
                    </notebook>
                    <group col="12" colspan="4">
                        <field name="currency_id"/>
                        <field name="amount_untaxed" sum="Untaxed amount"/>
                        <field name="amount_tax"/>
                        <field name="amount_total" sum="Total amount"/>
                        <button name="button_dummy" string="Compute" attrs="{'invisible': [('rfq_state', '!=', 'draft')]}" type="object" icon="gtk-execute"/>
                        <newline/>
                        <field name="functional_currency_id"/>
                        <field name="functional_amount_untaxed"/>
                        <field name="functional_amount_tax"/>
                        <field name="functional_amount_total"/>
                    </group>
                    <group col="11" colspan="4">
                        <field name="state" invisible="1"/>
                        <field name="rfq_state" readonly="1"/>
                        <button name="purchase_cancel"  type="object" attrs="{'invisible': [('rfq_state', 'not in', ['draft', 'sent'])]}" string="Cancel" icon="gtk-cancel"/>
                        <button name="rfq_sent" type="object" string="Send RfQ" icon="gtk-go-forward" attrs="{'invisible': [('rfq_state', '!=', 'draft')]}" />
                        <button name="check_rfq_updated" type="object" string="RfQ Updated" icon="gtk-go-forward" attrs="{'invisible': [('rfq_state', '!=', 'sent')]}" />
                        <button name="generate_po_from_rfq" type="object" string="Generate Po" icon="gtk-dnd-multiple" attrs="{'invisible': ['|', '|', ('tender_id', '!=', False), ('rfq_state', '!=', 'updated'), ('from_procurement', '=', True)], 'readonly': [('amount_total', '=', 0.00)]}" />
                        <button name="rfq_closed" string="RfQ Closed" type="object" icon="gtk-go-forward" attrs="{'invisible': ['|', '|', ('tender_id', '!=', False), ('rfq_state', '!=', 'updated'), ('from_procurement', '=', True)]}" />
                        <button name="continue_sourcing" type="object" string="Continue sourcing" icon="gtk-go-forward" attrs="{'invisible': ['|', '|', ('tender_id', '!=', False), ('rfq_state', '!=', 'updated'), ('from_procurement', '=', False)]}" />
                    </group>
                </form>
            </field>
        </record>

        <record id="view_rfq_filter" model="ir.ui.view">
            <field name="name">purchase.order.rfq.list.select</field>
            <field name="model">purchase.order</field>
            <field name="type">search</field>
            <field name="priority">17</field>
            <field name="arch" type="xml">
                <search string="Search Purchase Order">
                  <group col='10' colspan='4'>
                    <filter icon="terp-document-new" name="draft_rfq" string="Draft" domain="[('rfq_state','=','draft')]" separator="1" help="Requests for Quotation which are in draft state"/>
                    <filter icon="gtk-apply" name="sent" string="Sent" domain="[('rfq_state','=','sent')]" separator="1" />
                    <filter icon="terp-camera_test" name="updated" string="Updated" domain="[('rfq_state','=','updated')]" separator="1" />
                    <filter icon="gtk-yes" name="done" string="Closed" domain="[('rfq_state','=','done')]" separator="1" />
                    <filter icon="gtk-cancel" name="cancelled" string="Cancelled" domain="[('rfq_state','=','cancel')]" separator="1" />
                    <field name="partner_id" select="1" string="Supplier" />
                    <field name="product_id" select="1" />
                    <field name="origin" />
                    <field name="create_uid" select="1"/>
                    <field name="date_order" string="Creation date"/>
                    <newline />
                    <group string="Type" expand="0">
                            <filter icon="terp-check" string="Regular" domain="[('order_type','=','regular')]" />
                            <filter icon="terp-stage" string="Donation before expiry" domain="[('order_type','=','donation_exp')]" />
                            <filter icon="terp-gtk-jump-to-ltr" string="Standard Donation" domain="[('order_type','=','donation_st')]" />
                            <filter icon="terp-partner" string="Loan" domain="[('order_type','=','loan')]" />
                            <filter icon="terp-gtk-jump-to-rtl" string="In-Kind donation" domain="[('order_type','=','in_kind')]" />
                            <filter icon="terp-purchase" string="Purchase List" domain="[('order_type','=','purchase_list')]" />
                            <filter icon="terp-crm" string="Direct PO" domain="[('order_type','=','direct')]" />
                        </group>
                        <newline />
                        <group string="Priority" expand="0">
                            <filter icon="gtk-dialog-warning" string="Emergency" domain="[('priority','=','emergency')]"/>
                            <filter icon="gtk-yes" string="Normal" domain="[('priority','=','normal')]"/>
                            <filter icon="gtk-info" string="Priority" domain="[('priority','=','priority')]"/>
                        </group>
                        <newline />
                        <group string="Category" expand="0">
                            <filter icon="gtk-color-picker" string="Medical" domain="[('categ','=','medical')]"/>
                            <filter icon="terp-stock" string="Logistic" domain="[('categ','=','log')]"/>
                            <filter icon="terp-purchase" string="Service" domain="[('categ','=','service')]"/>
                            <filter icon="gtk-harddisk" string="Other" domain="[('categ','=','other')]"/>
                        </group>
                        <newline />
                </group>
                <newline/>
                <group expand="0" string="Group By..." colspan="4" col="10">
                  <filter string="Order Type" icon="terp-rating-rated" domain="[]" context="{'group_by':'order_type'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Priority" icon="terp-project" domain="[]" context="{'group_by':'priority'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Category" icon="terp-translate" domain="[]" context="{'group_by':'categ'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Supplier" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Origin" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'origin'}"/>
                  <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                  <separator orientation="vertical"/>
                  <filter string="Creation Date" icon="terp-go-month" domain="[]" context="{'group_by':'date_order'}"/>
                  <filter string="Expected Date" icon="terp-go-month" domain="[]" context="{'group_by':'delivery_requested_date'}"/>
                </group>
              </search>
            </field>
        </record>

        <record id="view_rfq_tree" model="ir.ui.view">
            <field name="name">view.rfq.tree</field>
            <field name="model">purchase.order</field>
            <field name="type">tree</field>
            <field name="priority" eval="300" />
            <field name="arch" type="xml">
                <tree string="Requests for Quotation">
                    <field name="name" />
                    <field name="order_type" />
                    <field name="priority" />
                    <field name="categ" />
                    <field name="date_order" string="Creation date"/>
                    <field name="partner_id" />
                    <field name="delivery_requested_date" />
                    <field name="origin" />
                    <field name="amount_total" />
                    <field name="rfq_state" />
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="purchase.purchase_rfq" model="ir.actions.act_window">
            <field name="name">Requests for Quotation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_type">form</field>
            <field name="context">{'rfq_ok': True, 'request_for_quotation': True}</field>
            <field name="domain">[('rfq_ok', '=', True)]</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="search_view_id" ref="view_rfq_filter"/>
            <field name="help">You can create a request for quotation when you want to buy products to a supplier but the purchase is not confirmed yet. Use also this menu to review requests for quotation created automatically based on your logistic rules (minimum stock, MTO, etc). You can convert the request for quotation into a purchase order once the order is confirmed. If you use the extended interface (from user's preferences), you can select the way to control your supplier invoices: based on the order, based on the receptions or manual encoding.</field>
        </record>

        <record id="purchase_rfq_tree_view_action" model="ir.actions.act_window.view">
            <field name="act_window_id" ref="purchase.purchase_rfq" />
            <field name="sequence">1</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_rfq_tree" />
        </record>

        <record id="act_relate_tender_rfq" model="ir.actions.act_window">
            <field name="name">Requests for Quotation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="src_model">tender</field>
            <field name="key2">client_action_relate</field>
            <field name="view_type">form</field>
            <field name="context">{'rfq_ok': True, 'request_for_quotation': True}</field>
            <field name="domain">[('rfq_ok', '=', True), ('tender_id', '=', active_id)]</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="search_view_id" ref="view_rfq_filter"/>
        </record>
        <record model="ir.values" id="relate_tender_rfq_values">
            <field name="object" eval="1" />
            <field name="name">Requests for Quotations</field>
            <field name="key2">client_action_relate</field>
            <field name="value" eval="'ir.actions.act_window,' + str(ref('act_relate_tender_rfq'))" />
            <field name="key">action</field>
            <field name="model">tender</field>
        </record>

        <record id="act_relate_tender_purchase_order" model="ir.actions.act_window">
            <field name="name">Purchase Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="src_model">tender</field>
            <field name="key2">client_action_relate</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="context">{'search_default_approved': 1,'search_default_create_uid':uid, 'purchase_order': True}</field>
            <field name="domain">[('rfq_ok', '=', False), ('origin_tender_id', '=', active_id)]</field>
            <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
        </record>
        <record model="ir.values" id="relate_tender_purchase_order_values">
            <field name="object" eval="1" />
            <field name="name">Purchase Orders</field>
            <field name="key2">client_action_relate</field>
            <field name="value" eval="'ir.actions.act_window,' + str(ref('act_relate_tender_purchase_order'))" />
            <field name="key">action</field>
            <field name="model">tender</field>
        </record>

        <record id="tender_line_cancel_wizard_form_view" model="ir.ui.view">
            <field name="name">tender.line.cancel.wizard.form.view</field>
            <field name="model">tender.line.cancel.wizard</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Tender line cancellation">
                    <field name="last_line" invisible="1" />
                    <field name="only_exp" invisible="1" />
                    <field name="tender_line_has_rfq_lines" invisible="1" />
                    <group colspan="4" col="1" attrs="{'invisible': [('only_exp', '=', True)]}">
                        <html>
                            <h4 style="text-align: center; margin: 10px"><translate>Would you re-source the needs sourced by this tender line ?</translate></h4>
                        </html>
                    </group>
                    <group colspan="6" attrs="{'invisible': [('tender_line_has_rfq_lines', '=', False)]}">
                        <html>
                            <h4 style="text-align: center; margin: 10px"><translate>
                                The tender line(s) you are about to cancel are linked to open RfQ line(s). They will be cancelled as well if you proceed.
                            </translate></h4>
                        </html>
                    </group>
                    <group colspan="6" attrs="{'invisible': [('last_line', '=', False)]}">
                        <html>
                            <p id="view_last_line_message"
                               style="text-align:center; color: red; font-weight: bold; font-size: 1.2em">
                               WARNING! You are about to cancel/delete a line. This action once done cannot be changed, and it will mean all related POs will be confirmed. Therefore if you wish to add another product to this tender you should do this BEFORE deleting this line. To add another product click "Close window".

                           </p>
                        </html>
                    </group>
                    <newline />
                    <group colspan="4" col="4" attrs="{'invisible': [('only_exp', '=', True)]}">
                        <separator string="Actions" colspan="4" />
                        <button name="just_cancel" string="Cancel only" type="object" icon="gtk-cancel" colspan="2" context="{'has_to_be_resourced': False}" />
                        <button name="cancel_and_resource" string="Cancel &amp; Resource" type="object" icon="gtk-cancel" colspan="2" />
                    </group>
                    <group colspan="4" col="2" attrs="{'invisible': [('only_exp', '=', False)]}">
                        <separator string="Actions" colspan="2" />
                        <button name="just_cancel" string="Cancel only" type="object" icon="gtk-cancel" colspan="2" context="{'has_to_be_resourced': False}" />
                    </group>
                </form>
            </field>
        </record>

        <record id="ask_tender_cancel_wizard_form_view" model="ir.ui.view">
            <field name="name">ask.tender.cancel.wizard.form.view</field>
            <field name="model">tender.cancel.wizard</field>
            <field name="type">form</field>
            <field name="priority" eval="99" />
            <field name="arch" type="xml">
                <form string="Tender cancellation">
                    <group colspan="4" col="1">
                        <html>
                            <h4 style="text-align: center; margin: 10px">All lines of this tender have been canceled. Would you also cancel this tender ?</h4>
                        </html>
                    </group>
                    <newline />
                    <separator string="Actions" colspan="4" />
                    <button name="close_window" string="No" type="object" icon="gtk-execute" colspan="2" />
                    <button name="just_cancel" string="Yes" type="object" icon="gtk-execute" colspan="2" context="{'has_to_be_resourced': False}" />
                </form>
            </field>
        </record>

        <record id="tender_cancel_wizard_form_view" model="ir.ui.view">
            <field name="name">tender.cancel.wizard.form.view</field>
            <field name="model">tender.cancel.wizard</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Tender cancellation">
                    <field name="not_draft" invisible="1" />
                    <field name="tender_source" invisible="1" />
                    <group colspan="4" col="1" attrs="{'invisible': [('not_draft', '=', False)]}">
                        <html>
                            <h4 style="text-align: center; margin: 10px">
                                <translate>Some Requests for Quotation have been generated by this tender. All these RfQs will be canceled if you cancel the tender.</translate>
                            </h4>
                        </html>
                    </group>
                    <group colspan="4" col="1" attrs="{'invisible': [('tender_source', '=', False)]}">
                        <html>
                            <h4 style="text-align: center; margin: 10px">
                                <translate>If you click on 'Cancel &amp; Resource' button, all Field Order lines or Internal Request lines attached to this tender will be re-sourced.</translate>
                            </h4>
                        </html>
                    </group>
                    <newline />
                    <separator string="Actions" />
                    <button name="just_cancel" string="Cancel only" type="object" icon="gtk-cancel" colspan="2" context="{'has_to_be_resourced': False}" />
                    <button name="cancel_and_resource" string="Cancel &amp; Resource" type="object" icon="gtk-cancel" colspan="2" attrs="{'invisible': [('tender_source', '=', False)]}" />
                </form>
            </field>
        </record>

        <record id="rfq_cancel_wizard_form_view" model="ir.ui.view">
            <field name="name">rfq.cancel.wizard.form.view</field>
            <field name="model">purchase.order.cancel.wizard</field>
            <field name="type">form</field>
            <field name="priority" eval="101" />
            <field name="arch" type="xml">
                <form string="Cancel Request for Quotation">
                    <field name="has_linked_line" invisible="1" />
                    <field name="cancel_linked_tender" invisible="1" />
                    <group colspan="4" col="1">
                        <html>
                            <h3 style="text-align: center; margin: 13px"><translate>Please confirm that you want to cancel all lines of this RfQ</translate></h3>
                        </html>
                    </group>
                    <group colspan="4" col="1" attrs="{'invisible': [('has_linked_line', '=', False)]}">
                        <html>
                            <h3 style="text-align: center; margin: 10px"><translate>If you click on 'Cancel &amp; Resource' button, all Field Order lines or Internal Request lines sourced by this Request for Quotation will be re-sourced.</translate></h3>
                        </html>
                    </group>
                    <group colspan="4" col="1" attrs="{'invisible': [('cancel_linked_tender', '=', False)]}">
                        <html>
                            <h3 style="text-align: center; margin: 10px"><translate>This RfQ is the only non-cancelled one linked to a Tender. You can cancel it as well by clicking 'Cancel only both' or 'Cancel both &amp; Resource the Tender'.</translate></h3>
                        </html>
                    </group>
                    <newline />
                    <separator string="Actions" />
                    <button name="cancel_po" string="Cancel only" type="object" icon="gtk-cancel" colspan="1" />
                    <button name="cancel_and_cancel_tender" string="Cancel only both" type="object" icon="gtk-cancel" colspan="1" attrs="{'invisible': [('cancel_linked_tender', '=', False)]}" />
                    <button name="cancel_and_resource" string="Cancel &amp; Resource" type="object" icon="gtk-cancel" colspan="1" attrs="{'invisible': [('has_linked_line', '=', False)]}" />
                    <button name="cancel_and_resource_tender" string="Cancel both &amp; Resource the Tender" type="object" icon="gtk-cancel" colspan="1" attrs="{'invisible': [('cancel_linked_tender', '=', False), ('order_id.tender_id.sale_order_id', '!=', False)]}" />
                </form>
            </field>
        </record>

        <record id="ask_rfq_cancel_wizard_form_view" model="ir.ui.view">
            <field name="name">ask.rfq.cancel.wizard.form.view</field>
            <field name="model">purchase.order.cancel.wizard</field>
            <field name="type">form</field>
            <field name="priority" eval="100" />
            <field name="arch" type="xml">
                <form string="Cancel Request for Quotation">
                    <group colspan="4" col="1">
                        <html>
                            <h4 style="text-align: center; margin: 10px">You removed all lines of this request for quotation, would you cancel it ?</h4>
                        </html>
                    </group>
                    <newline />
                    <separator string="Actions" colspan="4" />
                    <button colspan="1" type="object" icon="gtk-cancel" name="close_window" string="Close window" />
                    <button colspan="2" type="object" icon="gtk-execute" name="cancel_po" string="Cancel RfQ" />
                </form>
            </field>
        </record>

        <record id="check_products_supplier_updated_wizard" model="ir.ui.view">
            <field name="name">check.products.supplier.updated.wizard</field>
            <field name="model">check.products.supplier.updated.wizard</field>
            <field name="arch" type="xml">
                <form string="Warning!">
                    <group colspan="4" col="1">
                        <html>
                            <h3 style="text-align: center; margin: 10px; font-weight: normal"><translate>
                                You are about to close this Tender without the details being sent to update the Product Supplier information, are you sure you wish to continue ?
                            </translate></h3>
                        </html>
                    </group>
                    <newline />
                    <group colspan="4" col="1">
                        <html>
                            <span style="text-align: left; margin: 10px; font-weight: normal"><translate>
                                Comment :
                            </translate></span>
                        </html>
                        <field name="comment" nolabel="1" colspan="4" />
                    </group>
                    <newline />
                    <button name="yes_close_tender" string="Continue" type="object" icon="terp-check" colspan="1" />
                    <button name="no_close_tender" string="Return to previous screen" type="object" icon="gtk-cancel" colspan="1" />
                </form>
            </field>
        </record>

    </data>
</openerp>
