<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="signature_follow_up_search" model="ir.ui.view">
            <field name="name">signature_follow_up_tree</field>
            <field name="model">signature.follow_up</field>
            <field name="type">search</field>
            <field name="priority">15</field>
            <field name="arch" type="xml">
                <search>
                    <filter name="my_sign" string="My Signatures" icon="terp-personal" domain="[('user_id', '=', uid)]" />
                    <separator orientation="vertical"/>
                    <filter name="to_sign" string="To be signed" icon="gtk-paste"  domain="['&amp;', '&amp;', ('signed', '=', False), ('signature_is_closed', '=', False), ('wait_prio', '=', False)]"  />
                    <filter name="signed" string="Signed" icon="gtk-paste-v"  domain="[('signed', '=', True)]"  />
                    <separator orientation="vertical"/>
                    <filter name="open" string="Open" icon="terp-check" domain="[('status', '=', 'open')]" />
                    <filter name="partial" string="Partially Signed" icon="terp-document-new" domain="[('status', '=', 'partial')]" />
                    <filter name="fully" string="Fully Signed" icon="terp-camera_test" domain="[('status', '=', 'signed')]" />
                    <separator orientation="vertical"/>
                    <filter name="supply_doc" string="Supply" icon="terp-product" domain="[('doc_type', 'in', ['purchase.order', 'sale.order.fo', 'sale.order.ir', 'stock.picking.in', 'stock.picking.out', 'stock.picking.pick'])]" />
                    <filter name="Finance_doc" string="Finance" icon="terp-stock_format-default" domain="[('doc_type', 'in', ['account.bank.statement.cash', 'account.bank.statement.bank', 'account.invoice.si', 'account.invoice.donation'])]" />
                    <separator orientation="vertical"/>
                    <field name="user_id" />
                    <field name="doc_name" />
                    <field name="doc_type" />
                    <field name="signature_is_closed" />
                </search>
            </field>
        </record>

        <record id="signature_follow_up_tree" model="ir.ui.view">
            <field name="name">signature_follow_up_tree</field>
            <field name="model">signature.follow_up</field>
            <field name="type">tree</field>
            <field name="priority">16</field>
            <field name="arch" type="xml">
                <tree hide_new_button="1" hide_edit_button="1" hide_delete_button="1">
                    <field name="user_id" />
                    <field name="doc_name" />
                    <field name="doc_state" />
                    <button name="open_doc" string="Open Document" type="object" icon="terp-gtk-go-back-rtl" />
                    <field name="doc_type" />
                    <field name="roles" />
                    <field name="status" />
                    <field name="signed" widget="boolean"/>
                    <field name="signature_date" />
                    <field name="signature_is_closed" />
                </tree>
            </field>
        </record>

        <record id="signature_follow_up_action" model="ir.actions.act_window">
            <field name="name">Signatures Follow Up</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">signature.follow_up</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="signature_follow_up_tree"/>
            <field name="search_view_id" ref="signature_follow_up_search"/>
            <field name="context">{}</field>
        </record>

        <menuitem id="signature_follow_up_menu" action="signature_follow_up_action" parent="base.signature_menu" sequence="2"/>

        <record id="res_users_my_signature_form" model="ir.ui.view">
            <field name="name">my_Signature_form</field>
            <field name="model">res.users</field>
            <field name="type">form</field>
            <field name="priority">201</field>
            <field name="arch" type="xml">
                <form hide_new_button="1" hide_save_button="1" hide_duplicate_button="1" hide_delete_button="1" hide_cancel_button="1" string="My Signature">
                    <group colspan="2" col="4">
                    <field name="name" readonly="1" />
                    <field name="login" readonly="1" />
                    <newline />
                        <field name="signature_from" readonly="1"/>
                        <field name="signature_to" readonly="1" />
                        <field name="current_signature" widget="image" height="100" nolabel="1" colspan="4"/>
                        <field name="new_signature_required" invisible="1" />
                        <field name="has_valid_signature" invisible="1" />
                        <button type="object" string="Replace Signature" name="replace_signature" icon="gtk-edit" colspan="2" attrs="{'invisible': [('new_signature_required', '=', True), ('has_valid_signature', '=', False)]}"/>
                        <button type="object" string="Inactivate Signature" name="delete_signature" icon="gtk-del" colspan="2" attrs="{'invisible': [('new_signature_required', '=', True), ('has_valid_signature', '=', False)]}"/>
                        <button type="object" string="Create Signature" name="add_signature" icon="gtk-edit" colspan="2" attrs="{'invisible': ['|', ('new_signature_required', '=', False), ('has_valid_signature', '=', True)]}" />

                        <field name="signature_history_ids" colspan="4" mode="tree" readonly="1" nolabel="1">
                            <tree string="De-activated Signatures">
                                <field name="legal_name" />
                                <field name="user_name" />
                                <field name="create_date" />
                                <field name="inactivation_date" />
                                <field name="image" widget="image" height="50"/>
                            </tree>
                        </field>
                    </group>
                    <label colspan="2"/>
                </form>
            </field>
        </record>

        <record id="my_signature_server_action" model="ir.actions.server">
           <field name="name">My Signature</field>
            <field name="model_id" ref="base.model_res_users"/>
            <field name="state">code</field>
            <field name="code">
action = self.open_my_signature(cr, uid, context=context)
            </field>
        </record>

        <menuitem id="my_signature_menu" name="My Signature" action="my_signature_server_action" type="server" parent="base.signature_menu" sequence="3"/>

        <function model="ir.ui.view" name="generate_button_access_rules">
            <function model="ir.ui.view" name="search" eval="[[('id', '=', ref('base.view_users_form'))]]"/>
        </function>

        <function model="ir.ui.view" name="generate_button_access_rules">
            <function model="ir.ui.view" name="search" eval="[[('id', '=', ref('base.signature_change_date_form'))]]"/>
        </function>



    </data>
</openerp>
