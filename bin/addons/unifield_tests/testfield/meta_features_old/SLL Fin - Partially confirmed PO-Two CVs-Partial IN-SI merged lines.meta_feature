Feature: SLL - Partially confirmed PO-Two CVs-Partial IN-SI merged lines

@finance @po @po_manual @commitment @supplierinvoice @SLL
 
Scenario: SLL - Partially confirmed PO-Two CVs-Partial IN-SI merged lines (US-3185)

    #######################################################################################
    # Create PO and confirm first PO line
    #######################################################################################

    I log into instance "HQ1C1"
    I open tab menu "PURCHASES"
    I click on menu "Purchase Orders"
    I click on "New"

    I fill "Creation Date" with "16/May/2017"
    I fill "Supplier" with "Local Market"
    I click on "New" and open the window
    I fill "Product" with "[ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer"
    I fill "Quantity" with "10.00"
    I fill "Unit Price" with "4.93"
    I click on "Save & Close" and close the window 
    I click on "New" and open the window
    I fill "Product" with "[ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male"
    I fill "Quantity" with "5.00"
    I fill "Unit Price" with "1.37"
    I click on "Save & Close" and close the window
    
    I click "Analytical distribution" on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "New"
    I fill "SUP" within column "Destination"
    I fill "HT101" within column "Cost Center"
    I validate the line
    I click on "Save" and close the window
    
    I click "Edit" on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I fill "Delivery Confirmed Date" with "17/May/2017"
    I click on "Save & Close" and close the window 

    I click "Validate" on line:
    | Product Code |
    | ADAPCABL1P- |
    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL1P- |

    I click on menu "Purchase Orders"
    I store column "Reference" in "MYCODE" for line:
        | Total | 
        | 56.15 | 

    #######################################################################################
    # Validate first Commitment Voucher
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Commitments"
    I click on menu "Commitment Voucher"
    
    I click "Edit" on line:
    | Commitment Date | Source Document | Total | State |
    | 17/May/2017 | {{MYCODE}} | 49.30 | Draft |

    I click "Analytical Distribution" on line and open the window:
    | Account |
    | 61150 - IT & office equipment |
    I should see in the main table the following data:
    | Destination | Cost Center | Funding Pool | Percentage | Amount |
    | SUP | HT101 | PF | 100.00 | 49.30 |
    I click on "Cancel" and close the window

    I click on "Validate"

    #######################################################################################
    # Confirm second PO line
    #######################################################################################

    I open tab menu "Purchases"
    I click on menu "Purchase Orders"
    I click "Edit" on line:
    | Reference |
    | {{MYCODE}} |
    
    I click "Analytical distribution" on line and open the window:
    | Product Code |
    | ADAPCABL2S- |
    I click on "New"
    I fill "OPS" within column "Destination"
    I fill "HT111" within column "Cost Center"
    I validate the line
    I click on "Save" and close the window

    I click "Edit" on line and open the window:
    | Product Code |
    | ADAPCABL2S- |
    I fill "Delivery Confirmed Date" with "18/May/2017"
    I click on "Save & Close" and close the window 

    I click "Validate" on line:
    | Product Code |
    | ADAPCABL2S- |
    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL2S- |

    I should see "Confirmed" in "Order State"

    #######################################################################################
    # Validate second Commitment Voucher
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Commitments"
    I click on menu "Commitment Voucher"
    
    I click "Edit" on line:
    | Commitment Date | Source Document | Total | State |
    | 18/May/2017 | {{MYCODE}} | 6.85 | Draft |

    I click "Analytical Distribution" on line and open the window:
    | Account |
    | 61150 - IT & office equipment |
    I should see in the main table the following data:
    | Destination | Cost Center | Funding Pool | Percentage | Amount |
    | OPS | HT111 | PF | 100.00 | 6.85 |
    I click on "Cancel" and close the window

    I click on "Validate"

    #######################################################################################
    # Process partial Incoming Shipment
    #######################################################################################
    
    I open tab menu "WAREHOUSE"
    I click on menu "Incoming Shipments"
    I fill "Origin" with "{{MYCODE}}"
    I click on "Search"
    I click "Edit" on line:
    | Origin |
    | {{MYCODE}} |

    I click on "Process" and open the window
    I click "Edit" on line:
    | Product |
    | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer |
    I fill "9" within column "Quantity to Process"
    I validate the line
    I click "Edit" on line:
    | Product |
    | [ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male |
    I fill "4" within column "Quantity to Process"
    I validate the line
    I click on "Process" and close the window 
    
    #######################################################################################
    # Verify CV amounts have not been adjusted
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Commitments"
    I click on menu "Commitment Voucher"

    I click "Edit" on line:
    | Commitment Date | Source Document |
    | 17/May/2017 | {{MYCODE}} |
    I should see in the main table the following data:
    | Account | Initial Amount | Amount Left |
    | 61150 - IT & office equipment | 49.30 | 49.30 |

    I click on menu "Commitment Voucher"
    I click "Edit" on line:
    | Commitment Date | Source Document |
    | 18/May/2017 | {{MYCODE}} |
    I should see in the main table the following data:
    | Account | Initial Amount | Amount Left |
    | 61150 - IT & office equipment | 6.85 | 6.85 |
  

    #######################################################################################
    # Validate Supplier Invoice Merge Lines
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Suppliers"
    I click on menu "Supplier Invoices"
    I fill "Source Document" with "{{MYCODE}}"
    I click on "Search"
    I click "Edit" on line:
    | Source Document |
    | *{{MYCODE}} |
    I fill "Document Date" with "18/May/2017"
    I fill "Posting Date" with "18/May/2017"
        
    I click on "Merge Lines by Account"
    I click "Edit" on line and open the window:
    | Account |
    | 61150 - IT & office equipment |
    
    I fill "Description" with "SSL test"
    I click on "Save & Close" and close the window
    I click on "Analytical Distribution" and open the window
    I click on "Switch entry mode"
    I click on "New"
    I fill "SUP" within column "Destination"
    I fill "HT101" within column "Cost Center"
    I fill "PF" within column "Funding Pool"
    I fill "44.37" within column "Amount"
    I validate the line
    I fill "OPS" within column "Destination"
    I fill "HT111" within column "Cost Center"
    I fill "PF" within column "Funding Pool"
    I fill "5.48" within column "Amount"
    I validate the line
    I click on "Save" and close the window

    I click on "Validate"
     
    #######################################################################################
    # Verify Commitment Vouchers have been updated
    #######################################################################################
    
    I open accordion menu "Commitments"
    I click on menu "Commitment Voucher"
    I toggle off "Except Done"

    I click "Edit" on line:
    | Commitment Date | Source Document | Total | State |
    | 17/May/2017 | {{MYCODE}} | 0.00 | Done |
    I should see in the main table the following data:
    | Account | Initial Amount | Amount Left |
    | 61150 - IT & office equipment | 49.30 | 0.00 |

    I click on menu "Commitment Voucher"
    I click "Edit" on line:
    | Commitment Date | Source Document | Total | State |
    | 18/May/2017 | {{MYCODE}} | 6.30 | Validated |
    I should see in the main table the following data:
    | Account | Initial Amount | Amount Left |
    | 61150 - IT & office equipment | 6.85 | 6.30 |
   
    #######################################################################################
    # Process remaining IN
    #######################################################################################
  
    I open tab menu "WAREHOUSE"
    I click on menu "Incoming Shipments"
    I fill "Origin" with "{{MYCODE}}"
    I click on "Search"
    I click "Edit" on line:
    | Origin |
    | {{MYCODE}} |
    I click on "Process" and open the window
    I click on "Copy all"
    I click on "Process" and close the window

    #######################################################################################
    # Validate second Supplier Invoice
    #######################################################################################
    
    I open tab menu "ACCOUNTING"
    I open accordion menu "Suppliers"
    I click on menu "Supplier Invoices"
    I fill "Source Document" with "{{MYCODE}}"
    I click on "Search"
    I click "Edit" on line:
    | Source Document | Total | State |
    | *{{MYCODE}} | 6.30 | Draft |
    I fill "Document Date" with "18/May/2017"
    I fill "Posting Date" with "18/May/2017"

     I click "Analytical Distribution" on line and open the window:
    | Product |
    | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer |
    I should see in the main table the following data:
    | Destination | Cost Center | Funding Pool | Percentage | Amount |
    | SUP | HT101 | PF | 100.00 | 4.93 |
    I click on "Cancel" and close the window

    I click "Analytical Distribution" on line and open the window:
    | Product |
    | [ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male |
    I should see in the main table the following data:
    | Destination | Cost Center | Funding Pool | Percentage | Amount |
    | OPS | HT111 | PF | 100.00 | 1.37 |
    I click on "Cancel" and close the window
    
    I click on "Validate"

    #######################################################################################
    # Verify Commitment Voucher has been updated
    #######################################################################################
    
    I open accordion menu "Commitments"
    I click on menu "Commitment Voucher"
    I toggle off "Except Done"

    I click "Edit" on line:
    | Commitment Date | Source Document | Total | State |
    | 18/May/2017 | {{MYCODE}} | 0.00 | Done |
    I should see in the main table the following data:
    | Account | Initial Amount | Amount Left |
    | 61150 - IT & office equipment | 6.85 | 0.00 |
