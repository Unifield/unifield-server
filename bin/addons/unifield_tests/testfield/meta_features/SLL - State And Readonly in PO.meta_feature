Feature: SLL - State propagation and readonly checks in Purchase Orders 

@po @po_manual @SLL
 
Scenario: SLL - State propagation and readonly checks in Purchase Orders

    ##########################################################
    # Create PO with 2 products
    ##########################################################

    I log into instance "HQ1C1"
    I open tab menu "PURCHASES"
    I click on menu "Purchase Orders"
    I click on "New"

    I should see "Draft" in "Order State"
    I should see "Order State" as readonly
    I should see "Order Reference" as readonly
    I should see "Creation Date" as editable
    I should see "Supplier" as editable
    I should see "Warehouse" as editable
    I should see "Order Type" as editable
    I should see "Order category" as editable

    I fill "Creation Date" with "16/May/2017"
    I fill "Supplier" with "Local Market"
    I click on "New" and open the window
    I fill "Product" with "[ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer"
    I fill "Quantity" with "10.00"
    I fill "Unit Price" with "4.93"
    I click on "Save & Close" and close the window 
    I click on "New" and open the window
    I fill "Product" with "[ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male"
    I fill "Quantity" with "5.00"
    I fill "Unit Price" with "1.37"
    I click on "Save & Close" and close the window

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window
 
    I click "Edit" on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I should see "Product" as editable
    I should see "Quantity" as editable
    I should see "Delivery Requested Date" as editable
    I click on "Cancel" and close the window

    ##########################################################
    # Fill AD and delivery date
    ##########################################################
  
	I click on "Analytical Distribution" and open the window
	I click on "New"
	I fill "SUP" within column "DESTINATION"
	I fill "HT101" within column "COST CENTER"
	I validate the line
	I click on "Save" and close the window

	I open tab "Delivery"
	I fill "Delivery Confirmed Date" with "28/May/2017"
	
    I click on "Apply to all lines" and open the window
	I click on "Yes" and close the window	

    ##########################################################
    # Validate and confirm first line
    ##########################################################
 
	I open tab "Purchase Order"

    I click "Validate" on line:
    | Product Code |
    | ADAPCABL1P- |

    # Check the editability of the line
    I click "Edit" on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I should see "Product" as editable
    I should see "Quantity" as editable
    I should see "Delivery Requested Date" as editable
    I click on "Cancel" and close the window

    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL1P- |

    I should see "Draft-p" in "Order State"
    I should see "Creation Date" as editable
    I should see "Supplier" as readonly
    I should see "Warehouse" as editable
    I should see "Order Type" as readonly
    I should see "Order category" as editable

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window
    
    I click on "Save & Edit"

    I should see "Draft-p" in "Order State"
    I should see "Creation Date" as editable
    I should see "Supplier" as readonly
    I should see "Warehouse" as editable
    I should see "Order Type" as readonly
    I should see "Order category" as editable

    I click on "Save"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window

    ##########################################################
    # Validate and confirm second line
    ##########################################################

    I click on "Edit"

    I click "Validate" on line:
    | Product Code |
    | ADAPCABL2S- |

    I should see "Validated-p" in "Order State"
    I should see "Creation Date" as editable
    I should see "Supplier" as readonly
    I should see "Warehouse" as editable
    I should see "Order Type" as readonly
    I should see "Order category" as editable

    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL2S- |

    I should see "Confirmed" in "Order State"
    I should see "Creation Date" as readonly
    I should see "Supplier" as readonly
    I should see "Warehouse" as readonly
    I should see "Order Type" as readonly
    I should see "Order category" as readonly

    I click on "Save"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window

    ##########################################################
    # Create another PO with same 2 products
    ##########################################################

    I click on "Duplicate"

    I should see "Draft" in "Order State"
    I should see "Order State" as readonly
    I should see "Order Reference" as readonly
    I should see "Creation Date" as editable
    I should see "Supplier" as editable
    I should see "Warehouse" as editable
    I should see "Order Type" as editable
    I should see "Order category" as editable

    ##########################################################
    # Fill AD and delivery date
    ##########################################################
  
	I click on "Analytical Distribution" and open the window
	I click on "New"
	I fill "SUP" within column "DESTINATION"
	I fill "HT101" within column "COST CENTER"
	I validate the line
	I click on "Save" and close the window

	I open tab "Delivery"
	I fill "Delivery Confirmed Date" with "28/May/2017"
	
    I click on "Apply to all lines" and open the window
	I click on "Yes" and close the window	

    I click on "Save"

    I should see "Draft" in "Order State"
	
    I open tab "Purchase Order"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window

    I click "Validate" on line:
    | Product Code |
    | ADAPCABL1P- |
    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL1P- |

    # FIXME : This doesn't work inside Selenium.. but works when done in real 
    # life. Can't investigate at the moment because console.log() don't appear
    # in Firefox ? :/
    #I should see "Draft-p" in "Order State"

    I click "Validate" on line:
    | Product Code |
    | ADAPCABL2S- |

    # FIXME : This doesn't work inside Selenium.. but works when done in real 
    # life. Can't investigate at the moment because console.log() don't appear
    # in Firefox ? :/
    #I should see "Validated-p" in "Order State"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window

    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL2S- |

    # FIXME : This doesn't work inside Selenium.. but works when done in real 
    # life. Can't investigate at the moment because console.log() don't appear
    # in Firefox ? :/
    #I should see "Confirmed" in "Order State"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "Cancel" and close the window
    
