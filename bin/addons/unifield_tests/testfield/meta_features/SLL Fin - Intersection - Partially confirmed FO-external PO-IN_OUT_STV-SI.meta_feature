Feature: SLL - Intersection - Partially confirmed FO-external PO-IN/OUT-STV-SI

@finance @po @po_manual @commitment @supplierinvoice @SLL
 
Scenario: SLL - Intersection - Partially confirmed FO-external PO-IN/OUT-STV-SI(US-3185)

    #######################################################################################
    # Create PO in HQ2C1 to HQ1C1
    #######################################################################################

    I log into instance "HQ2C1"
    I open tab menu "PARTNERS"
    I click on menu "Suppliers"
    I click "Edit" on line:
    | Name |
    | *HQ1C1 |
    I fill "Order creation mode" with "Requirements by Order"
    I click on "Save"

    I open tab menu "PURCHASES"
    I click on menu "Purchase Orders"
    I click on "New"

    I fill "Creation Date" with "16/May/2017"
    I fill "Supplier" with "HQ1C1"
    I click on "New" and open the window
    I fill "Product" with "[ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer"
    I fill "Quantity" with "10.00"
    I fill "Unit Price" with "4.93"
    I click on "Save & Close" and close the window 
    I click on "New" and open the window
    I fill "Product" with "[ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male"
    I fill "Quantity" with "5.00"
    I fill "Unit Price" with "1.37"
    I click on "Save & Close" and close the window
    
    I click "Analytical distribution" on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I click on "New"
    I fill "SUP" within column "Destination"
    I fill "HT101" within column "Cost Center"
    I validate the line
    I click on "Save" and close the window
    
    I click "Analytical distribution" on line and open the window:
    | Product Code |
    | ADAPCABL2S- |
    I click on "New"
    I fill "OPS" within column "Destination"
    I fill "HT101" within column "Cost Center"
    I validate the line
    I click on "Save" and close the window

    I click on "Validate lines"
   
    I click on menu "Purchase Orders"
    I store column "Reference" in "MYCODE" for line:
    | Supplier | Total | 
    | *HQ1C1 | 56.15 | 
      
    I log out
    I synchronize "HQ2C1"
    I synchronize "HQ1C1"

    #######################################################################################
    # Validate first line of FO in HQ1C1 
    #######################################################################################

    I log into instance "HQ1C1"
    I open tab menu "PARTNERS"
    I click on menu "Suppliers"
    I click "Edit" on line:
    | Name |
    | Local Market |
    I fill "Order creation mode" with "Requirements by Order"
    I click on "Save"

    I open tab menu "ORDERS"
    I click on menu "Field Orders"
    I click "Edit" on line:
    | Customer Reference |
    | *{{MYCODE}} |
    
    I fill "Ordered Date" with "25/May/2017"
    I click on "Analytical Distribution" and open the window
    I click on "New"
    I fill "SUP" within column "Destination"
    I fill "HT101" within column "Cost Center"
    I validate the line
    I click on "Save" and close the window 
        
    I open tab "Order dates"
    I fill "Delivery Confirmed Date" with "25/May/2017"
    I click on "Update lines" and open the window
    I click on "Yes" and close the window

    I open tab "Field Order"
    
    I click "Validate" on line:
    | Product Code |
    | ADAPCABL1P- |

    I click on menu "Field Orders"
    I store column "Order Reference" in "MYCODE" for line:
    | Customer |
    | *HQ2C1 |

    I click on menu "Orders Sourcing Tool"
    I click "Edit" on line:
    | Order |
    | {{MYCODE}} |
    I fill "Local Market" within column "Supplier"
    I validate the line
    I click "Source Line" on line:
    | Order |
    | {{MYCODE}} |
        
    #######################################################################################
    # Confirm external PO
    #######################################################################################

    I open tab menu "Purchases"
    I click on menu "Purchase Orders"
    I click "Edit" on line:
    | Source Document |
    | *{{MYCODE}} |

    I fill "Creation Date" with "25/May/2017"
    I open tab "Delivery"
    I fill "Delivery Requested Date" with "25/May/2017"
    I click on "Update Lines" and open the window
    I click on "Yes" and close the window

    I open tab "Purchase Order"

    I click "Edit" on line and open the window:
    | Product Code |
    | ADAPCABL1P- |
    I fill "Delivery Confirmed Date" with "25/May/2017"
    I click on "Save & Close" and close the window
    I click "Validate" on line:
    | Product Code |
    | ADAPCABL1P- |
    I click "Confirm" on line:
    | Product Code |
    | ADAPCABL1P- |


    #######################################################################################
    # Validate Commitment Voucher
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Commitments"
    I click on menu "Commitment Voucher"
    I click "Edit" on line:
    | Commitment Date | Supplier | Total |
    | 25/May/2017 | Local Market | 49.30 |
    I click on "Validate"
  
    #######################################################################################
    # Process Incoming Shipment
    #######################################################################################
    
    I open tab menu "WAREHOUSE"
    I click on menu "Incoming Shipments"
    I fill "Origin" with "{{MYCODE}}"
    I click on "Search"
    I click "Edit" on line:
    | Origin |
    | *{{MYCODE}} |

    I fill "Creation Date" with "25/May/2017 00:00"
    I click on "Process" and open the window
    I click on "Copy all"
    I click on "Process" and close the window 
    
    #######################################################################################
    # Process Outgoing Shipment
    #######################################################################################

    I click on menu "Deliveries|Picking"
    I click "Edit" on line:
    | Origin |
    | *{{MYCODE}} |
    I click on "Convert to Simple Out"
    I click on "Process" and open the window
    I click on "Copy all"
    I click on "Process" and close the window

    #######################################################################################
    # Validate SI
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Suppliers"
    I click on menu "Supplier Invoices"
    I click "Edit" on line:
    | Source Document | Total |
    | *{{MYCODE}} | 49.30 |
    I fill "Document Date" with "25/May/2017"
    I fill "Posting Date" with "25/May/2017"
    I click on "validate"     


    #######################################################################################
    # Validate STV
    #######################################################################################
 
    I open accordion menu "Customers"
    I click on menu "Stock Transfer Vouchers"
    I click "Edit" on line:
    | Source Document | Total |
    | *{{MYCODE}} | 49.30 |
    I fill "Document Date" with "25/May/2017"
    I fill "Posting Date" with "25/May/2017" 
    I click on "Validate"

    #######################################################################################
    # Verify Journal Items
    #######################################################################################

    I open accordion menu "Journal Entries"
    I click on menu "Journal Items"

    I should see in the main table the following data:
    | Journal Code | Account | Third Parties | Book. Debit | Book. Credit | Book. Currency | Func. Debit | Func. Credit |
    | SAL | 12010 - Receivable from other sections| *HQ2C1 | 49.30 | 0.00 | EUR | 49.30 | 0.00 |
    | SAL | 61150 - IT & office equipment  | *HQ2C1 | 0.00 | 49.30 | EUR | 0.00 | 49.30 |
    | PUR | 30020 - Trade payables | Local Market | 0.00 | 49.30 | EUR | 0.00 | 49.30 |
    | PUR | 61150 - IT & office equipment | Local Market | 49.30 | 0.00 | EUR | 49.30 | 0.00 |
    
    I log out
    I synchronize "HQ1C1"
    I synchronize "HQ2C1"

    #######################################################################################
    # Process incoming shipment
    #######################################################################################

    I log into instance "HQ2C1"
    I open tab menu "PURCHASES"
    I click on menu "Purchase Orders"
    I store column "Reference" in "MYCODE" for line:
    | Supplier | Total | 
    | *HQ1C1 | 56.15 | 

    I open tab menu "WAREHOUSE"
    I click on menu "Incoming Shipments"
    I click "Edit" on line:
    | Origin |
    | *{{MYCODE}} |
    I click on "Process" and open the window
    I click on "Copy all"
    I click on "Process" and close the window
    
    #######################################################################################
    # Validate SI
    #######################################################################################

    I open tab menu "ACCOUNTING"
    I open accordion menu "Suppliers"
    I click on menu "Supplier Invoices"
    I click "Edit" on line:
    | Source Document | Total |
    | *{{MYCODE}} | 49.30 |
    I fill "Document Date" with "25/May/2017"
    I fill "Posting Date" with "25/May/2017" 
    I click on "Validate"

    #######################################################################################
    # Verify Journal Items
    #######################################################################################

    I open accordion menu "Journal Entries"
    I click on menu "Journal Items"

    I should see in the main table the following data:
    | Journal Code | Account | Third Parties | Book. Debit | Book. Credit | Book. Currency | Func. Debit | Func. Credit |
    | PUR | 30010 - Payable to other sections | *HQ1C1 | 0.00 | 49.30 | EUR | 0.00 | 49.30 |
    | PUR | 61150 - IT & office equipment | *HQ1C1 | 49.30 | 0.00 | EUR | 49.30 | 0.00 |


    #######################################################################################
    # Reset Suppliers
    #######################################################################################

    I open tab menu "PARTNERS"
    I click on menu "Suppliers"
    I click "Edit" on line:
    | Name |
    | *HQ1C1 |
    I fill "Order creation mode" with "All requirements"
    I click on "Save"
    I log out

    I log into instance "HQ1C1"
    I open tab menu "PARTNERS"
    I click on menu "Suppliers"
    I click "Edit" on line:
    | Name |
    | Local Market |
    I fill "Order creation mode" with "All requirements"
    I click on "Save"
    I log out

    