Feature: SLL - State propagation and readonly checks in Internal Requests 

@ir @ir_manual @SLL
 
Scenario: SLL - State propagation and readonly checks in Internal Requests

    ##########################################################
    # Create IR with 2 products
    ##########################################################

    I log into instance "HQ1C1"
    I open tab menu "ORDERS"
    I click on menu "Internal Requests"
    I click on "New"

    I should see "Draft" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as editable
    I should see "Warehouse" as editable
    I should see "Requestor" as editable
    I should see "Location Requestor" as editable
    I should see "Requested Date" as editable
    I should see "Origin" as editable
    I should see "Functional Currency" as readonly
    I should see "Order category" as editable
    I should see "Date of Stock Take" as editable
    I should see "Order State" as readonly

    I click on button_id "location_requestor_id_select" and open the window
    I click on first line and close the window
    I fill "Requested date" with "16/May/2017"
   
    # Add products line by line
    I click on "New"
    I fill "[ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer" within column "Product"
    I fill "10.00" within column "Quantity (UoM)"
    I fill "4.93" within column "Unit Price"
    I validate the line
    I fill "[ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male" within column "Product"
    I fill "5.00" within column "Quantity (UoM)"
    I fill "1.37" within column "Unit Price"
    I validate the line

    I click on "Save & Edit"
    I store "Order Reference" in "IR_REFERENCE"

    ##########################################################
    # Validate first line
    ##########################################################
 
    I click "Validate" on line:
    | Product |
    | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer |

    I should see "Draft-p" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as editable
    I should see "Warehouse" as editable
    I should see "Requestor" as editable
    I should see "Location Requestor" as editable
    I should see "Requested Date" as editable
    I should see "Origin" as editable
    I should see "Functional Currency" as readonly
    I should see "Order category" as readonly
    I should see "Date of Stock Take" as editable
    I should see "Order State" as readonly


    I click on "Save & Edit"

    I should see "Draft-p" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as editable
    I should see "Warehouse" as editable
    I should see "Requestor" as editable
    I should see "Location Requestor" as editable
    I should see "Requested Date" as editable
    I should see "Origin" as editable
    I should see "Functional Currency" as readonly
    I should see "Order category" as readonly
    I should see "Date of Stock Take" as editable
    I should see "Order State" as readonly

    I click on "Save"

    ##########################################################
    # Validate second line
    ##########################################################

    I click on "Edit"

    I click "Validate" on line:
    | Product |
    | [ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male |

    I should see "Validated" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as editable
    I should see "Warehouse" as editable
    I should see "Requestor" as editable
    I should see "Location Requestor" as editable
    I should see "Requested Date" as editable
    I should see "Origin" as editable
    I should see "Functional Currency" as readonly
    I should see "Order category" as readonly
    I should see "Date of Stock Take" as editable
    I should see "Order State" as readonly

    I click on "Save & Edit"

    I should see "Validated" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as editable
    I should see "Warehouse" as editable
    I should see "Requestor" as editable
    I should see "Location Requestor" as editable
    I should see "Requested Date" as editable
    I should see "Origin" as editable
    I should see "Functional Currency" as readonly
    I should see "Order category" as readonly
    I should see "Date of Stock Take" as editable
    I should see "Order State" as readonly


    ##########################################################
    # Souce 1 line (Validated-p)
    ##########################################################
    I click on menu "Orders Sourcing Tool"
    I fill "Order" with "{{IR_REFERENCE}}"
    I click on "Search"
    I click "Edit" on line:
        | PRODUCT                                                                 |
        | [ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male |
    I fill "ITCompany" within column "SUPPLIER"
    I validate the line
    I click "Source Line" on line:
        | PRODUCT                                                                 |
        | [ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male |

    I click on menu "Internal Requests"
    I click "Edit" on line:
        | ORDER REFERENCE    |
        | *{{IR_REFERENCE}}* |

    I should see "Validated-p" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as readonly
    I should see "Warehouse" as readonly
    I should see "Requestor" as readonly
    I should see "Location Requestor" as readonly
    I should see "Requested Date" as readonly
    I should see "Origin" as readonly
    I should see "Functional Currency" as readonly
    I should see "Order category" as readonly
    I should see "Date of Stock Take" as readonly
    I should see "Order State" as readonly


    ##########################################################
    # Souce 2nd line (Sourced)
    ##########################################################
    I click on menu "Orders Sourcing Tool"
    I fill "Order" with "{{IR_REFERENCE}}"
    I click on "Search"
    I click "Edit" on line:
        | PRODUCT                                                                 |
        | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer            |
    I fill "ITCompany" within column "SUPPLIER"
    I validate the line
    I click "Source Line" on line:
        | PRODUCT                                                                 |
        | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer            |

    I click on menu "Internal Requests"
    I click "Edit" on line:
        | ORDER REFERENCE    |
        | *{{IR_REFERENCE}}* |

    I should see "Sourced" in "Order State"
    I should see "Order Reference" as readonly
    I should see "Ordered Date" as readonly
    I should see "Warehouse" as readonly
    I should see "Requestor" as readonly
    I should see "Location Requestor" as readonly
    I should see "Requested Date" as readonly
    I should see "Origin" as readonly
    I should see "Functional Currency" as readonly
    I should see "Order category" as readonly
    I should see "Date of Stock Take" as readonly
    I should see "Order State" as readonly

    I click on "Save"

    ##########################################################
    # Create another IR with same 2 products
    ##########################################################

    I click on "Duplicate"
    I click on "Save"

    I should see "Draft" in "Order State"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product |
    | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer |
    I click on "Cancel" and close the window
    
    I click "Validate" on line:
    | Product |
    | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer |
    
    # FIXME : This doesn't work inside Selenium.. but works when done in real 
    # life. Can't investigate at the moment because console.log() don't appear
    # in Firefox ? :/
    #I should see "Draft-p" in "Order State"

    I click "Validate" on line:
    | Product |
    | [ADAPCABL2S-] (computer) CABLE, SERIAL interface PC/Mini-M, female/male |

    # FIXME : This doesn't work inside Selenium.. but works when done in real 
    # life. Can't investigate at the moment because console.log() don't appear
    # in Firefox ? :/
    #I should see "Validated" in "Order State"

    # Check that we can see the details for a line by clicking on it
    I click on line and open the window:
    | Product |
    | [ADAPCABL1P-] (printer) CABLE, PARALLEL interface PC/printer |
    I click on "Cancel" and close the window

