<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
    
        <!-- Here we just add a boolean in the page 'Delivery and invoicing' of the purchase order form notebook -->

        
        <!-- Delivery Orders : we add 2 buttons and play with attrs to change the source location-->
        <record id="view_picking_out_cross_docking_form" model="ir.ui.view">
            <field name="name">view.picking.out.cross.docking</field>
            <field name="model">stock.picking</field>
            <field name="type">form</field>
            <field name="priority">20</field>
            <field name="inherit_id" ref="stock.view_picking_out_form" />
            <field name="arch" type="xml">
                <data>
                    <xpath expr="//tree[@string='Stock Moves']//field[@name='location_id']" position="after" >
                        <field name="product_type" invisible="1" />
                        <button name="button_cross_docking" string="Cross docking" type="object" icon="gtk-select-color"
                        attrs="{'invisible':['|', '|', '|', ('product_type', 'in', ['consu', 'service_recep']), ('allocation_setup', '=', 'unallocated'),('move_cross_docking_ok','=', True), ('state', 'in', ('done','delivered','cancel'))]}"
                        context="{'from_button': True}"  />
                        <button name="button_stock" string="Stock" type="object" icon="gtk-media-play"
                        attrs="{'invisible':['|', '|', ('product_type', 'in', ['consu', 'service_recep']), ('move_cross_docking_ok','=', False), ('state', 'in', ('done','delivered','cancel'))]}"
                        context="{'from_button': True}"  />
                        <field name="move_cross_docking_ok" invisible='1'/>
                        <field name="allocation_setup" invisible="1" />
                    </xpath>
                    <xpath expr="/form/notebook/page[@string='Products']/group/field[@name='state']" position="after" >
                        <button name="button_cross_docking_all" string="Cross docking" type="object" icon="gtk-select-color"
                        attrs="{'invisible':['|', '|', ('allocation_setup', '=', 'unallocated'), ('cross_docking_ok','=', True), ('state', 'in', ('done','delivered','cancel'))]}"
                        context="{'from_button': True}" />
                        <button name="button_stock_all" string="Stock" type="object" icon="gtk-media-play"
                        attrs="{'invisible':['|', ('cross_docking_ok','=', False), ('state', 'in', ('done','delivered','cancel'))]}"
                        context="{'from_button': True}"  />
                        <field name="allocation_setup" invisible="1" />
                    </xpath>
                </data>
            </field>
        </record>
        
        <!-- We update the form view of stock.location to display the boolean "cross_docking" for cross_docking location-->
        <record id="view_location_form" model="ir.ui.view">
            <field name="name">stock.location.form</field>
            <field name="model">stock.location</field>
            <field name="type">form</field>
            <field name="priority">20</field>
            <field name="inherit_id" ref="stock.view_location_form" />
            <field name="arch" type="xml">
                <data>
                    <field name="scrap_location" position="after">
                        <field name="cross_docking_location_ok" />
                        <field name="eprep_location" />
                    </field>
                </data>
            </field>
        </record>
         
    </data>
</openerp>
