<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="msf_budget_view_tree">
            <field name="name">msf.budget.view.tree</field>
            <field name="model">msf.budget</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
               <tree colors="blue:state in ('draft');gray:state in ('done');black:state in ('valid')" string="Budget">
                    <field name="name" colspan="1"/>
                    <field name="code" colspan="1"/>
                    <field name="fiscalyear_id"/>
                    <field name="state"/>
                    <field name="decision_moment"/>
                    <field name="version"/>
                    <field name="total_budget_amount"/>
                </tree>
            </field>
        </record>

        <record id="view_msf_budget_search" model="ir.ui.view">
           <field name="name">msf.budget.search</field>
           <field name="model">msf.budget</field>
           <field name="type">search</field>
           <field name="arch" type="xml">
               <search string="Budget">
                   <group col="20" colspan="4">
                       <filter string="Draft" icon="terp-document-new" domain="[('state','=','draft')]" help="Draft Budgets"/>
                       <filter name="validated" string="Validated" icon="terp-camera_test" domain="[('state','=','valid')]" help="Validated Budgets" />
                       <separator orientation="vertical"/>
                       <field name="name" select="1"/>
                       <field name="code" select="1" />
                       <field name="cost_center_id"/>
                       <field name="state"/>
                       <field name="fiscalyear_id"/>
                       <field name="currency_id"/>
                       <field name="decision_moment"/>
                       <field name="version"/>
                   </group>
               </search>
           </field>
        </record>

        <record model="ir.ui.view" id="msf_budget_view_form">
            <field name="name">msf.budget.view.form</field>
            <field name="model">msf.budget</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Budget">
                    <field name="name" readonly="1"/>
                    <field name="code" readonly="1"/>
                    <field name="fiscalyear_id" readonly="1"/>
                    <field name="cost_center_id" readonly="1"/>
                    <field name="decision_moment" readonly="1" attrs="{'invisible': [('type', '=', 'view')]}"/>
                    <field name="version" readonly="1" attrs="{'invisible': [('type', '=', 'view')]}"/>
                    <field name="type" readonly="1" invisible="1"/>
                    <group col="4" colspan="2">
                        <button name="button_display_type" string="Change display type" type="object" icon="terp-stock_zoom" context="context" colspan="1"/>
                        <field name="display_type" readonly="1" nolabel="1"/>
                    </group>
                    <field name="currency_id" readonly="1"/>
                    <field name="budget_line_ids" colspan="4" nolabel="1" readonly="1">
                        <tree string="Budget Lines" editable="top" colors="black:line_type in ('normal');blue:line_type in ('view')">
                            <field name="account_id" domain="[('type', '!=', 'view'), ('user_type_code', '=', 'expense')]"/>
                            <field name="budget_amount" real_sum="Budget Amount"/>
                            <field name="actual_amount" real_sum="Actual Amount"/>
                            <field name="balance" real_sum="Balance"/>
                            <field name="percentage"/>
                            <field name="line_type"/>
                        </tree>
                        <form string="Budget Line">
                            <group colspan="4">
                                <field name="account_id" colspan="2" readonly="1"/>
	                            <field name="budget_amount" colspan="1" readonly="1"/>
	                            <field name="actual_amount" colspan="1" readonly="1"/>
	                            <field name="balance" colspan="1" readonly="1"/>
	                            <field name="percentage" colspan="1" readonly="1"/>
                            </group>
                        </form>
                    </field>
                    <field name="state" select="1" readonly="1" attrs="{'invisible': [('type', '=', 'view')]}"/>
                    <group col="4" colspan="2">
                        <button string="Approve" name="validate" type="workflow" icon="gtk-ok" attrs="{'invisible': [('|'), ('type', '=', 'view'), ('state', '!=', 'draft')]}"/>
                        <button string="Done" name="done" type="workflow" icon="gtk-jump-to" attrs="{'invisible': [('|'), ('type', '=', 'view'), ('state', '!=', 'valid')]}"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_crossovered_budget_view">
            <field name="name">Budgets</field>
            <field name="res_model">msf.budget</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="msf_budget_view_tree"/>
            <field name="search_view_id" ref="view_msf_budget_search"/>
            <field name="context">{'search_default_validated': 1}</field>
            <field name="help">A budget is a forecast of your company's income and expenses expected for a period in the future. With a budget, a company is able to carefully look at how much money they are taking in during a given period, and figure out the best way to divide it among various categories. By keeping track of where your money goes, you may be less likely to overspend, and more likely to meet your financial goals. Forecast a budget by detailing the expected revenue per analytic account and monitor its evolution based on the actuals realised during that period.</field>
        </record>
        
        <menuitem id="next_id_31" name="Budgets" parent="account.menu_finance" sequence="6"/>
        <menuitem parent="next_id_31"
            id="menu_act_crossovered_budget_view"
            action="act_crossovered_budget_view" sequence="1" />

        <record id="wizard_budget_criteria_export_view" model="ir.ui.view">
            <field name="name">Budget vs. Actuals Export</field>
            <field name="model">wizard.budget.criteria.export</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Budget vs. Actuals Export">
                    <field name="currency_table_id"/>
                    <field name="period_id"/>
                    <field name="commitment"/>
                    <field name="breakdown"/>
                    <field name="granularity"/>
                    <separator colspan="4"/>
                    <group colspan="4" col="6">
                        <button special="cancel" string="No" icon="gtk-cancel"/>
                        <button name="button_create_budget" string="Create report" type="object" icon="gtk-ok"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="wizard_budget_import_view" model="ir.ui.view">
            <field name="name">Budget Import</field>
            <field name="model">wizard.budget.import</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Budget Import">
                    <label string="Select a .CSV file to import." align="0.0" colspan="3"/>
                    <field name="import_file"/>
                    <separator colspan="4"/>
                    <group colspan="4" col="6">
                        <button special="cancel" string="Cancel" icon="gtk-cancel"/>
                        <button name="import_csv_budget" string="Import Budget" type="object" icon="gtk-ok"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="wizard_budget_import_confirm_view" model="ir.ui.view">
            <field name="name">Budget Already Existing</field>
            <field name="model">wizard.budget.import.confirm</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Budget Already Existing">
                    <label string="Do you want to overwrite the following budgets:" align="0.0" colspan="3"/>
                    <field name="budget_list" colspan="4" nolabel="1" readonly="1"/>
                    <separator colspan="4"/>
                    <group colspan="4" col="6">
                        <button name="button_cancel" string="No" type="object" icon="gtk-cancel"/>
                        <button name="button_confirm" string="Yes" type="object" icon="gtk-ok"/>
                    </group>
                </form>
            </field>
        </record>

        <record id="wizard_budget_import_finish_view" model="ir.ui.view">
            <field name="name">Budget Imported</field>
            <field name="model">wizard.budget.import.finish</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Budget Imported">
                    <label string="The budget has been correctly uploaded." align="0.0" colspan="3"/>
                    <separator colspan="4"/>
                    <button name="button_close" string="OK" type="object" icon="gtk-ok"/>
                </form>
            </field>
        </record>

        <record id="action_wizard_budget_import" model="ir.actions.act_window">
            <field name="name">Import Budget</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">wizard.budget.import</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="wizard_budget_import_view"/>
            <field name="target">new</field>
        </record>


		<!-- Menu Item: Analytic Accounts which displays only Cost Center, and not allow: delete, new, edit
		hide_new_button="1" hide_delete_button="1"
		 -->
        
        <menuitem parent="next_id_31"
            action="action_wizard_budget_import"
            id="menu_action_wizard_budget_import"  sequence="2"/>
            
        <record id="view_msf_budget_summary_tree" model="ir.ui.view">
            <field name="name">msf.budget.summary.tree</field>
            <field name="model">msf.budget.summary</field>
            <field name="type">tree</field>
            <field name="field_parent">child_ids</field>
            <field name="arch" type="xml">
                <tree string="Budget Status">
                    <field name="code"/>
                    <field name="name"/>
                    <field name="budget_amount"/>
                    <field name="actual_amount"/>
                    <field name="parent_id" invisible="1"/>
                </tree>
            </field>
        </record>
        
        <record id="action_wizard_budget_summary_tree" model="ir.actions.server">
            <field name="name">Budget Status</field>
            <field name="model_id" ref="model_msf_budget"/>
            <field name="state">code</field>
            <field name="code">action = obj.budget_summary_open_window(context=context)</field>
        </record>

        <record id="ir_action_wizard_budget_summary_tree" model="ir.values">
            <field eval="'client_action_multi'" name="key2"/>
            <field eval="'msf.budget'" name="model"/>
            <field name="name">Budget Status</field>
            <field eval="'ir.actions.server,%d'%action_wizard_budget_summary_tree" name="value"/>
            <field eval="True" name="object"/>
        </record>


        <record id="view_account_analytic_account_budget_tree" model="ir.ui.view">
            <field name="name">account.analytic.account.budget.tree</field>
            <field name="model">account.analytic.account</field>
            <field name="type">tree</field>
            <field name="domain">[('category','=','OC')]</field>
            <field name="field_parent">child_complete_ids</field>
            <field name="arch" type="xml">
                <tree colors="red:(date&lt;current_date);black:(date&gt;=current_date);black:(date==False)" string="Analytic Accounts" 
                 toolbar="1" hide_new_button="1" hide_delete_button="1" editable="top" noteditable="1">
                    <field name="name"/>
                    <field name="code"/>
                    <field name="description"/>
                    <field name="category"/>
                    <field name="type" />
                    <field name="date_start"/>
                    <field name="date"/>
                    <field name="parent_id" invisible="1"/>
                    <button name="button_wiz_hard_posting" states="open" string="Hard Posting" type="object" icon="terp-camera_test" context="context"/>
                </tree>
            </field>
        </record>

        <record id="action_account_analytic_account_budget_form" model="ir.actions.act_window">
            <field name="name">Analytic Accounts</field>
            <field name="res_model">account.analytic.account</field>
            <field name="view_id" ref="view_account_analytic_account_budget_tree"/>
            <field name="domain">[('category','=','OC')]</field>
            <field name="context">{'search_default_active': 1, 'filter_inactive_accounts': 1}</field>
        </record>

        <menuitem action="action_account_analytic_account_budget_form" id="menu_action_account_analytic_account_budget_form" parent="next_id_31" />

    </data>
</openerp>
