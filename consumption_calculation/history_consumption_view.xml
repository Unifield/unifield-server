<?xml version="1.0" encoding="utf-8" ?>
<openerp>
    <data>

        <record id="product_history_consumption_form" model="ir.ui.view">
	    <field name="name">product.history.consumption.form</field>
	    <field name="model">product.history.consumption</field>
	    <field name="type">form</field>
	    <field name="arch" type="xml">
		<form string="Product historical consumption">
		    <group colspan="2" col="2">
			<separator colspan="2" string="Period parameters" />
		    	<field name="date_from" on_change="date_change(date_from, date_to)" />
   		    	<field name="date_to" on_change="date_change(date_from, date_to)" />
		    	<field name="month_ids" nolabel="1" colspan="2">
			    <tree string="Months" hide_new_button="1" noteditable="True" editable="top">
			        <field name="name" />
			    </tree>
		        </field>
		    </group>

		    <group colspan="2" col="2">
			<separator colspan="2" string="Consumption parameters" />
		    	<field name="consumption_type" />
		    	<field name="location_id" attrs="{'invisible': [('consumption_type', '!=', 'rac')], 'required': [('consumption_type', '=', 'rac')]}" />
			<separator colspan="2" string="Product parameters" />
            <field name="sublist_id" attrs="{'readonly': [('nomen_manda_0', '!=', False)]}" />
            <group colspan="2" col="4" attrs="{'readonly': [('sublist_id', '!=', False)]}">
                <field name="nomen_manda_0"
                    domain="[('level', '=', '0'), ('type', '=', 'mandatory')]"
                    widget="selection"
                    on_change="onChangeSearchNomenclature(0, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                />
                <field name="nomen_manda_1"
                    domain="[('id','=', 0)]"
                    widget="selection"
                    get_selection="get_nomen"
                    on_change="onChangeSearchNomenclature(1, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                />
                <field name="nomen_manda_2"
                    domain="[('id','=', 0)]"
                    widget="selection"
                    get_selection="get_nomen"
                    on_change="onChangeSearchNomenclature(2, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                />
                <field name="nomen_manda_3"
                    domain="[('id','=', 0)]"
                    widget="selection"
                    get_selection="get_nomen"
                    on_change="onChangeSearchNomenclature(3, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                />
            </group>
			<separator colspan="2" string="Actions" />
			<button name="create_lines" type="object" string="View historical data" icon="gtk-execute" colspan="2" />
		    </group>
		</form>
	    </field>
	</record>

	<menuitem id="menu_product_history_consumption"
		  name="Historical consumption"
		  parent="warehouse_consumption_menu" />

	<record id="action_open_history_consumption_view" model="ir.actions.server">
            <field name="name">History consumption</field>
            <field name="model_id" ref="model_product_history_consumption"/>
            <field name="state">code</field>
            <field name="code">action = obj.open_history_consumption(context=context)</field>
        </record>

        <record id="ir_open_history consumption_view" model="ir.values">
            <field name="key2">tree_but_open</field>
            <field name="model">ir.ui.menu</field>
            <field name="name">Historical consumptions</field>
	        <field name="res_id" ref="menu_product_history_consumption" />
            <field eval="'ir.actions.server,%d'%action_open_history_consumption_view" name="value"/>
            <field eval="True" name="object"/>
        </record>

    </data>	
</openerp>
