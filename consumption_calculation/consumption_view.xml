<?xml version="1.0" encoding="utf-8" ?>
<openerp>
    <data>
    
        <record id="real_average_consumption_form_view" model="ir.ui.view">
            <field name="name">real.average.consumption.form.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Real consumption reporting">
                    <separator colspan="4" string="General information" />
                    <field name="cons_location_id" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <field name="creation_date" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <field name="activity_id" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <button name="import_rac" string="Import a file" icon="gtk-leave-fullscreen" type="object" attrs="{'invisible': [('created_ok', '=', True)]}"/>
                    <button name="export_rac" string="Export lines" icon="terp-mail-forward" type="object" />
                    <separator colspan="4" string="Period of consumption" />
                    <field name="period_from" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <field name="period_to" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <separator colspan="4" string="Product filters" />
                    <field name="sublist_id" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <field name="nomen_id" on_change="nomen_change(nomen_id)" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <button colspan="4" icon="gtk-go-down" string="Fill lines" type="object" name="fill_lines" />
                    <separator colspan="4" string="Products" />
                    <field colspan="4" name="line_ids" mode="tree" nolabel="1" widget="one2many_list" attrs="{'readonly': [('created_ok', '=', True)]}">
						<tree string="Products" editable="top">
                            <field name="product_id" on_change="product_onchange(product_id, parent.cons_location_id)"
                            	domain="[('nomen_ids', '=', parent.nomen_id), ('list_ids', '=', parent.sublist_id)]" />
                            <field name="uom_id" />
                            <field name="product_qty" />
                            <field name="consumed_qty" />
                            <field name="remark" />
                        </tree>
                    </field>
                    <field name="created_ok" invisible="1" />
                    <button name="save_and_process" string="Save &amp; Process" icon="gtk-execute" type="object" colspan="2" attrs="{'invisible': [('created_ok', '=', True)]}" />
                </form>
            </field>
        </record>
        
        <record id="real_average_consumption_confirmation_view" model="ir.ui.view">
            <field name="name">real.average.consumption.confirmation.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">form</field>
            <field name="priority" eval="99" />
            <field name="arch" type="xml">
                <form string="Need confirmation">
                    <separator colspan="4" string="Need confirmation" />
                    <field name="valid_ok" />
                    <separator colspan="4" string="Actions" />
                    <button name="process_moves" string="Process moves" icon="gtk-execute" type="object" colspan="2" />
                </form>
            </field>
        </record>
        
        <record id="real_average_consumption_tree_view" model="ir.ui.view">
            <field name="name">real.average.consumption.tree.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Real consumption reports">
                    <field name="cons_location_id" />
                    <field name="activity_id" />
                    <field name="period_from" />
                    <field name="period_to" />
                    <field name="nb_lines" />
                    <field name="created_ok" />
                </tree>
            </field>
        </record>
        
        <record id="real_average_consumption_search_view" model="ir.ui.view">
            <field name="name">real.average.consumption.search.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Real consumption reports">
                    <group col="10" colspan="4">
                        <filter icon="terp-check" string="Moves created" domain="[('created_ok','=',True)]"/>
                        <separator orientation="vertical"/>
                        <field name="cons_location_id"/>
                        <field name="activity_id"/>
                        <field name="period_from"/>
                        <field name="period_to"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Consumer" icon="terp-stock" domain="" context="{'group_by': 'cons_location_id'}" />
                        <filter string="Activity" icon="terp-administration" domain="" context="{'group_by':'activity_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Sublist" icon="terp-go-week" domain="" context="{'group_by':'sublist_id'}"/>
                        <filter string="Nomenclature" icon="terp-tools" domain="" context="{'group_by':'nomen_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_real_average_consumption" model="ir.actions.act_window">
            <field name="name">Real consumption reports</field>
            <field name="res_model">real.average.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        
        <record id="action_new_real_consumption_report" model="ir.actions.act_window">
            <field name="name">New real consumption report</field>
            <field name="res_model">real.average.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
        
        <menuitem
             id="warehouse_consumption_menu"
             name="Consumption"
             parent="stock.next_id_61" />
             
        <menuitem
            id="consumption_reports_menu"
            action="action_real_average_consumption"
            parent="warehouse_consumption_menu" />
          
        <!-- <menuitem
            id="new_consumption_reports_menu"
            action="action_new_real_consumption_report"
            parent="warehouse_consumption_menu" /> -->
            
            
        <record id="monthly_review_consumption_form_view" model="ir.ui.view">
            <field name="name">monthly.review.consumption.form.view</field>
            <field name="model">monthly.review.consumption</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Monthly consumption">
                    <separator colspan="4" string="General information" />
                    <field name="period_from" />
                    <button name="import_fmc" string="Import a file" icon="gtk-leave-fullscreen" type="object" colspan="2" />
                    <field name="period_to" />
                    <button name="export_fmc" string="Export lines" icon="terp-mail-forward" type="object" colspan="2" />
                    <field name="cons_location_id" />
                    <newline />
                    <field name="sublist_id" />
                    <field name="nomen_id" />
                    <button colspan="4" icon="gtk-go-down" string="Fill lines" type="object" name="fill_lines" />
                    <separator colspan="4" string="Products" />
                    <field colspan="4" name="line_ids" mode="tree" nolabel="1" widget="one2many_list">
                        <tree string="Products" editable="top"> 
                            <field name="name" on_change="product_onchange(name)" 
                            	domain="[('nomen_ids', '=', parent.nomen_id), ('list_ids', '=', parent.sublist_id)]" />
                            <field name="amc" />
                            <field name="fmc" />
                            <field name="last_reviewed" />
                            <field name="valid_ok" />
                            <field name="valid_until" />
                            <button name="valid_line" type="object" string="Valid line" icon="gtk-execute" attrs="{'invisible': [('valid_ok', '=', True)]}" />
                            <button name="display_graph" type="object" string="Display graph" icon="terp-purchase" />
                        </tree>
                    </field>
                </form>
            </field>
        </record>
        
        <record id="monthly_review_consumption_tree_view" model="ir.ui.view">
            <field name="name">monthly.review.consumption.tree.view</field>
            <field name="model">monthly.review.consumption</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Monthly consumption">
                    <field name="cons_location_id" />
                    <field name="period_from" />
                    <field name="period_to" />
                    <field name="nb_lines" />
                </tree>
            </field>
        </record>
        
        <record id="monthly_review_consumption_search_view" model="ir.ui.view">
            <field name="name">monthly.review.consumption.search.view</field>
            <field name="model">monthly.review.consumption</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Monthly consumption">
                	<group col="10" colspan="4">
                        <field name="cons_location_id"/>
                        <field name="period_from"/>
                        <field name="period_to"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Consumer" icon="terp-stock" domain="" context="{'group_by': 'cons_location_id'}" />
                        <separator orientation="vertical"/>
                        <filter string="Sublist" icon="terp-go-week" domain="" context="{'group_by':'sublist_id'}"/>
                        <filter string="Nomenclature" icon="terp-tools" domain="" context="{'group_by':'nomen_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_monthly_review_consumption" model="ir.actions.act_window">
            <field name="name">Monthly consumptions</field>
            <field name="res_model">monthly.review.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        
        <record id="action_new_monthly_review_consumption" model="ir.actions.act_window">
            <field name="name">New real monthly consumption</field>
            <field name="res_model">monthly.review.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
             
        <menuitem
            id="consumption_monthly_review_menu"
            action="action_monthly_review_consumption"
            parent="warehouse_consumption_menu" />
          
        <!-- <menuitem
            id="new_consumption_monthly_review_menu"
            action="action_new_monthly_review_consumption"
            parent="warehouse_consumption_menu" /> -->
            
        <record id="monthly_cons_product_form_view" model="ir.ui.view">
            <field name="name">monthlu.cons.product.form.view</field>
            <field name="model">product.product</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product.product_normal_form_view" />
            <field name="arch" type="xml">
                <data>
                    <field name="produce_delay" position="after">
                        <field name="procure_delay" />
                    </field>
                </data>
            </field>
        </record>
    
        <record id="monthly_cons_stock_product_form_view" model="ir.ui.view">
            <field name="name">monthlu.cons.product.stock.form.view</field>
            <field name="model">product.product</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_normal_stock_property_form" />
            <field name="arch" type="xml">
                <field name="virtual_available" position="after">
                    <field name="monthly_consumption" readonly="1" />
                    <field name="reviewed_consumption" />
                </field>
            </field>
        </record>
    
    </data>
</openerp>