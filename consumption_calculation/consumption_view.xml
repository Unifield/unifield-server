<?xml version="1.0" encoding="utf-8" ?>
<openerp>
    <data>
    
        <record id="real_average_consumption_form_view" model="ir.ui.view">
            <field name="name">real.average.consumption.form.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Real consumption reporting">
                    <separator colspan="4" string="General information" />
                    <field name="name" readonly="1" />
                    <field name="creation_date" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <field name="cons_location_id" attrs="{'readonly': [('created_ok', '=', True)]}" context="{'no3buttons': True}"/>
                    <group colspan="2" col="2">
                        <field name="picking_id" attrs="{'invisible': [('created_ok', '=', False)]}" />
                        <button name="import_rac" colspan="2" string="Import a file" icon="gtk-leave-fullscreen" type="object" attrs="{'invisible': [('created_ok', '=', True)]}"/>
                    </group>
                    <field name="activity_id" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <button name="export_rac" colspan="2" string="Export lines" icon="terp-mail-forward" type="object" />
                    <separator colspan="4" string="Period of consumption" />
                    <field name="period_from" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <field name="period_to" attrs="{'readonly': [('created_ok', '=', True)]}"/>
                    <separator colspan="4" string="Product filters" />
                    <field name="sublist_id" attrs="{'readonly': ['|',('created_ok', '=', True), ('nomen_manda_0', '!=', False)]}"/>

                    <group colspan="2" col="4" attrs="{'readonly': [('sublist_id', '!=', False)]}">
                        <field name="nomen_manda_0"
                            domain="[('level', '=', '0'), ('type', '=', 'mandatory')]"
                            widget="selection"
                            on_change="onChangeSearchNomenclature(0, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                        <field name="nomen_manda_1"
                            domain="[('id','=', 0)]"
                            widget="selection"
                            get_selection="get_nomen"
                            on_change="onChangeSearchNomenclature(1, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                        <field name="nomen_manda_2"
                            domain="[('id','=', 0)]"
                            widget="selection"
                            get_selection="get_nomen"
                            on_change="onChangeSearchNomenclature(2, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                        <field name="nomen_manda_3"
                            domain="[('id','=', 0)]"
                            widget="selection"
                            get_selection="get_nomen"
                            on_change="onChangeSearchNomenclature(3, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                    </group>

                    <button colspan="4" icon="gtk-go-down" string="Fill lines" type="object" name="fill_lines" attrs="{'invisible': [('created_ok', '=', True)]}" />
                    <separator colspan="4" string="Products" />
                    <field colspan="4" name="line_ids" mode="tree" nolabel="1" widget="one2many_list" attrs="{'readonly': [('created_ok', '=', True)]}">
                        <tree string="Products" editable="top" colors="red:(batch_mandatory and not prodlot_id) or (date_mandatory and not expiry_date) or consumed_qty>product_qty;blue: not prodlot_id and consumed_qty>product_qty">
                            <field name="product_id" on_change="product_onchange(product_id, parent.cons_location_id, uom_id, prodlot_id)"
                                context="{'location': parent.cons_location_id, 'compute_child': False}"
                                domain="[('list_ids', '=', parent.sublist_id)]" />
                            <field name="uom_id" 
                                on_change="uom_onchange(product_id, parent.cons_location_id, uom_id, prodlot_id)"/>
                            <field name="product_qty" />
                            <field name="prodlot_id" 
                                on_change="change_prodlot(product_id, prodlot_id, expiry_date, parent.cons_location_id, uom_id, remark)"
                                domain="[('product_id', '=', product_id), ('stock_available', '>', 0)]"
                                context="{'location_id': parent.cons_location_id, 'uom': uom_id, 'hidden_perishable_mandatory': not batch_mandatory}"
                                attrs="{'required': [('batch_mandatory', '=', True)], 'readonly': [('date_mandatory', '=', False), ('batch_mandatory', '=', False)]}" />
                            <field name="expiry_date"
                                on_change="change_expiry(expiry_date, product_id, parent.cons_location_id, uom_id, remark)"
                                attrs="{'required': [('date_mandatory', '=', True), ('batch_mandatory', '=', False)], 'readonly': ['|', ('batch_mandatory', '=', True), ('date_mandatory', '=', False)]}"/>
                            <field name="consumed_qty" on_change="change_qty(consumed_qty, product_id, prodlot_id, parent.cons_location_id, uom_id)"/>
                            <field name="move_id" invisible="1" />
                            <button string="Split line" icon="terp-stock_effects-object-colorize" name="line_split" type="object" attrs="{'invisible': [('move_id', '!=', False)]}" />
                            <field name="remark" invisible="1" />
                            <field name="batch_mandatory" invisible="0" string="B.Num" readonly="1" />
                            <field name="date_mandatory" invisible="0" string="Exp" readonly="1" />
                        </tree>
                    </field>
                    <field name="created_ok" invisible="1" />
                    <group colspan="4" col="6">
                        <button name="button_update_stock" string="Update Indicative Stock" icon="gtk-refresh" colspan="2" type="object" attrs="{'invisible': [('created_ok', '=', True)]}" />
                        <button name="save_and_process" string="Save &amp; Process" icon="gtk-execute" type="object" colspan="2" attrs="{'invisible': [('created_ok', '=', True)]}" />
                    </group>
                </form>
            </field>
        </record>
        
        <record id="real_average_consumption_confirmation_view" model="ir.ui.view">
            <field name="name">real.average.consumption.confirmation.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">form</field>
            <field name="priority" eval="99" />
            <field name="arch" type="xml">
                <form string="Need confirmation">
                    <separator colspan="4" string="Actions" />
                    <button name="process_moves" string="Process moves" icon="gtk-execute" type="object" colspan="2" />
                </form>
            </field>
        </record>
        
        <record id="real_average_consumption_tree_view" model="ir.ui.view">
            <field name="name">real.average.consumption.tree.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Real consumption reports">
		    <field name="name" />
                    <field name="cons_location_id" />
                    <field name="activity_id" />
                    <field name="period_from" />
                    <field name="period_to" />
                    <field name="nb_lines" />
                    <field name="created_ok" />
                    <field name="sublist_id" invisible="1" />
                    <field name="nomen_manda_0" invisible="1" />
                    <field name="nomen_manda_1" invisible="1" />
                    <field name="nomen_manda_2" invisible="1" />
                    <field name="nomen_manda_3" invisible="1" />
                </tree>
            </field>
        </record>
        
        <record id="real_average_consumption_search_view" model="ir.ui.view">
            <field name="name">real.average.consumption.search.view</field>
            <field name="model">real.average.consumption</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Real consumption reports">
                    <group col="10" colspan="4">
                        <filter icon="terp-check" string="Moves created" domain="[('created_ok','=',True)]"/>
                        <separator orientation="vertical"/>
                        <field name="cons_location_id"/>
                        <field name="activity_id"/>
                        <field name="period_from"/>
                        <field name="period_to"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Consumer" icon="terp-stock" domain="" context="{'group_by': 'cons_location_id'}" />
                        <filter string="Activity" icon="terp-administration" domain="" context="{'group_by':'activity_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Sublist" icon="terp-go-week" domain="" context="{'group_by':'sublist_id'}"/>
                        <filter string="Main type" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_0'}"/>
                        <filter string="Group" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_1'}"/>
                        <filter string="Family" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_2'}"/>
                        <filter string="Root" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_3'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_real_average_consumption" model="ir.actions.act_window">
            <field name="name">Real consumption</field>
            <field name="res_model">real.average.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'withnum': 1}</field>
        </record>
        
        <record id="action_new_real_consumption_report" model="ir.actions.act_window">
            <field name="name">New real consumption report</field>
            <field name="res_model">real.average.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
        
        <menuitem
             id="warehouse_consumption_menu"
             name="Consumption reports"
             sequence="-20"
             parent="stock.next_id_61" />
             
        <menuitem
            id="consumption_reports_menu"
            action="action_real_average_consumption"
            parent="warehouse_consumption_menu" />
          
        <!-- <menuitem
            id="new_consumption_reports_menu"
            action="action_new_real_consumption_report"
            parent="warehouse_consumption_menu" /> -->

        <record id="real_consumption_split_line_form_view" model="ir.ui.view">
            <field name="name">real.consumption.split.line.form.view</field>
            <field name="model">real.average.consumption.split.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Split line">
                    <separator colspan="4" />
                    <field name="orig_qty" readonly="1" />
                    <field name="new_qty" required="1" />
                    <separator colspan="4" string="Actions" />
                    <button special="cancel" icon="gtk-cancel" string="Cancel" />
                    <button name="split_line" type="object" icon="terp-stock_effects-object-colorize" colspan="2" string="Split line" />
                    <label />
                </form>
            </field>
        </record>
            
            
        <record id="monthly_review_consumption_form_view" model="ir.ui.view">
            <field name="name">monthly.review.consumption.form.view</field>
            <field name="model">monthly.review.consumption</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Monthly consumption">
                    <separator colspan="4" string="General information" />
                    <field name="period_from" on_change="period_change(period_from, period_to)" />
                    <button name="import_fmc" string="Import a file" icon="gtk-leave-fullscreen" type="object" colspan="2" />
                    <field name="period_to" on_change="period_change(period_from, period_to)" />
                    <button name="export_fmc" string="Export lines" icon="terp-mail-forward" type="object" colspan="2" />
                    <field name="cons_location_id" />
                    <newline />
                    <field name="sublist_id" attrs="{'readonly': [('nomen_manda_0', '!=', False)]}"/>
                    <group colspan="2" col="4" attrs="{'readonly': [('sublist_id', '!=', False)]}">
                        <field name="nomen_manda_0"
                            domain="[('level', '=', '0'), ('type', '=', 'mandatory')]"
                            widget="selection"
                            on_change="onChangeSearchNomenclature(0, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                        <field name="nomen_manda_1"
                            domain="[('id','=', 0)]"
                            widget="selection"
                            get_selection="get_nomen"
                            on_change="onChangeSearchNomenclature(1, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                        <field name="nomen_manda_2"
                            domain="[('id','=', 0)]"
                            widget="selection"
                            get_selection="get_nomen"
                            on_change="onChangeSearchNomenclature(2, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                        <field name="nomen_manda_3"
                            domain="[('id','=', 0)]"
                            widget="selection"
                            get_selection="get_nomen"
                            on_change="onChangeSearchNomenclature(3, 'mandatory', nomen_manda_0, nomen_manda_1, nomen_manda_2, nomen_manda_3, False)"
                        />
                    </group>
                    <button colspan="4" icon="gtk-go-down" string="Fill lines" type="object" name="fill_lines" />
                    <separator colspan="4" string="Products" />
                    <field colspan="4" name="line_ids" mode="tree" nolabel="1" widget="one2many_list">
                        <tree string="Products" editable="top"> 
                            <field name="name" on_change="product_onchange(name, parent.id, parent.period_from, parent.period_to)" 
                            	domain="[('list_ids', '=', parent.sublist_id)]" />
                            <field name="amc" />
                            <field name="fmc" on_change="fmc_change(amc, fmc, name)" attrs="{'readonly': [('valid_ok', '=', True)]}" />
                            <field name="last_reviewed" />
                            <field name="valid_ok" />
                            <field name="valid_until" />
			    <field name="fmc2" invisible="1" />
			    <field name="last_reviewed2" invisible="1" />
                            <!--<button name="valid_line" type="object" string="Valid line" icon="gtk-execute" attrs="{'invisible': [('valid_ok', '=', True)]}" />-->
                            <button name="display_graph" type="object" string="Display graph" icon="terp-purchase" />
                        </tree>
                    </field>
                    <button colspan="4" icon="gtk-execute" string="Valid all lines" type="object" name="valid_multiple_lines" />
                </form>
            </field>
        </record>
        
        <record id="monthly_review_consumption_tree_view" model="ir.ui.view">
            <field name="name">monthly.review.consumption.tree.view</field>
            <field name="model">monthly.review.consumption</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Monthly consumption">
                    <field name="period_from" />
                    <field name="period_to" />
                    <field name="nb_lines" />
                    <field name="sublist_id" invisible="1" />
                    <field name="nomen_manda_0" invisible="1" />
                    <field name="nomen_manda_1" invisible="1" />
                    <field name="nomen_manda_2" invisible="1" />
                    <field name="nomen_manda_3" invisible="1" />
                </tree>
            </field>
        </record>
        
        <record id="monthly_review_consumption_search_view" model="ir.ui.view">
            <field name="name">monthly.review.consumption.search.view</field>
            <field name="model">monthly.review.consumption</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Monthly consumption">
                	<group col="10" colspan="4">
                        <field name="period_from"/>
                        <field name="period_to"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Sublist" icon="terp-go-week" domain="" context="{'group_by':'sublist_id'}"/>
                        <filter string="Main type" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_0'}"/>
                        <filter string="Group" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_1'}"/>
                        <filter string="Family" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_2'}"/>
                        <filter string="Root" icon="terp-tools" domain="" context="{'group_by':'nomen_manda_3'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_monthly_review_consumption" model="ir.actions.act_window">
            <field name="name">Monthly consumption</field>
            <field name="res_model">monthly.review.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'withnum': 1}</field>
        </record>
        
        <record id="action_new_monthly_review_consumption" model="ir.actions.act_window">
            <field name="name">New real monthly consumption</field>
            <field name="res_model">monthly.review.consumption</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>
             
        <menuitem
            id="consumption_monthly_review_menu"
            action="action_monthly_review_consumption"
            parent="warehouse_consumption_menu" />
          
        <!-- <menuitem
            id="new_consumption_monthly_review_menu"
            action="action_new_monthly_review_consumption"
            parent="warehouse_consumption_menu" /> -->
            
        <record id="monthly_cons_product_form_view" model="ir.ui.view">
            <field name="name">monthlu.cons.product.form.view</field>
            <field name="model">product.product</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="product.product_normal_form_view" />
            <field name="arch" type="xml">
                <data>
                    <field name="produce_delay" position="after">
                        <field name="procure_delay" />
                    </field>
                </data>
            </field>
        </record>
    
        <record id="monthly_cons_stock_product_form_view" model="ir.ui.view">
            <field name="name">monthlu.cons.product.stock.form.view</field>
            <field name="model">product.product</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="stock.view_normal_stock_property_form" />
            <field name="arch" type="xml">
                <field name="virtual_available" position="after">
                    <field name="product_amc" readonly="1" />
                    <field name="reviewed_consumption" />
                </field>
            </field>
        </record>

        <record id="view_stock_location_search_without_buttons" model="ir.ui.view">
            <field name="name">stock.location.search.without_buttons</field>
            <field name="model">stock.location</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Stock Locations">
                    <field name="name" />
                    <field name="location_category" />
                </search>
            </field>
        </record>
    </data>
</openerp>
