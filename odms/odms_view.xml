<?xml version="1.0"?>
<openerp>
<data>
    <menuitem name="On Demand" icon="terp-project" id="odms_menu"/>
    <menuitem name="On Demand/Configuration" id="odms_config_menu" sequence="0"/>
    <menuitem name="On Demand/Configuration/Offers" id="odms_offer_menu" sequence="1"/>
    <menuitem name="On Demand/Configuration/Bundles" id="odms_bundle_menu" sequence="2"/>
    <menuitem name="On Demand/Configuration/Modules" id="odms_module_menu" sequence="3"/>


    <!--
        ODMS Server Configuration
    -->

    <record model="ir.ui.view" id="view_odms_server_form">
        <field name="name">odms.server.form</field>
        <field name="model">odms.server</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="ODMS Configuration">
                <separator string="ODMS Server information" colspan="4"/>
                <group colspan="4">
                    <field name="name" colspan="3" select="1"/>
                    <newline/>
                    <field name="ipaddress" select="1"/>
                    <field name="port" select="1"/>
                    <field name="user"/>
                    <field name="password"/>
                </group>
                <separator string="Services" colspan="4"/>
                <group colspan="2">
                    <field name="has_vserv"/>
                    <field name="nbr_vserv"/>
                           <field name="has_web"/>
                    <newline/>
                           <field name="has_bckup"/>
                </group>
                <separator string="Notes" colspan="4"/>
                <field name="vserver_ids" colspan="4" nolabel="1"/>
                <group colspan="4">
                    <field name="state"/>    
                    <button name="srv_connect" string="Connect to server" states="notconnected" type="object"/>
                    <button name="srv_disconnect" string="Disconnect from server" states="connected" type="object"/>
                </group>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_server_form">
        <field name="name">OD Server</field>
        <field name="res_model">odms.server</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">form,tree</field>
    </record>

    <menuitem name="On Demand/Configuration/Add an ODMS server" action="action_odms_server_form" id="menu_form_server" sequence="8"/>


    <record model="ir.ui.view" id="view_odms_server_list">
        <field name="name">odms.server.list</field>
        <field name="model">odms.server</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="ODMS Configuration">
                <field name="ipaddress"/>
                <field name="port"/>
                <field name="user"/>
                <field name="password"/>
                <field name="name"/>
                <field name="has_web"/>
                <field name="has_bckup"/>
                <field name="has_vserv"/>
                <field name="nbr_vserv"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_server_list">
        <field name="name">Configuration</field>
        <field name="res_model">odms.server</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem name="On Demand/Configuration/ODMS servers" action="action_odms_server_list" id="menu_list_servers" sequence="4"/>

    <!--
        OD VServer
    -->    

    <record model="ir.ui.view" id="view_odms_vserver_form">
        <field name="name">odms.vserver.form</field>
        <field name="model">odms.vserver</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="ODMS Vserver">
                <field name="name" select="1"/>
                <field name="ipaddress" select="2"/>
                <field name="state" select="1"/>
                <field name="vserv_server_id" select="1"/>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_odms_vserver_list">
        <field name="name">odms.vserver.list</field>
        <field name="model">odms.vserver</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="ODMS Vservers" >
                <field name="name"/>
                <field name="ipaddress"/>
                <field name="state"/>
                <field name="vserv_server_id"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_vserver_list">
        <field name="name">VServers</field>
        <field name="res_model">odms.vserver</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem name="On Demand/Configuration/ODMS vservers" action="action_odms_vserver_list" id="menu_list_vservers" sequence="4"/>


    <!--
        OD Partner
    -->

    <record model="ir.ui.view" id="view_odms_partner_form">
        <field name="name">odms.partner.form</field>
        <field name="model">odms.partner</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="OD Partner">
                <separator string="Company" colspan="4"/>
                <field name="name" colspan="3" select="1"/>
                <field name="partner_id" select="1"/>
                <field name="vat" select="2"/>
                <field name="address" select="2"/>
                <field name="zip" select="2"/>
                <field name="city" select="2"/>
                <newline/>
                <field name="country_id" select="1"/>
                <field name="countrystate_id" select="2"/>
                <field name="website" select="2"/>
                <newline/>
                <separator string="Contact" colspan="4"/>
                <field name="contactname" select="1"/>
                <field name="phone" select="2"/>
                <field name="email" select="1"/>
                <newline/>
                <separator string="Notes" colspan="4"/>
                <field name="notes" colspan="4" nolabel="1"/>
                <group colspan="4">
                    <field name="state" select="1"/>
                </group>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_odms_partner_list">
        <field name="name">odms.partner.list</field>
        <field name="model">odms.partner</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="OD Partners">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="contactname"/>
                <field name="country_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_partner_list">
        <field name="name">Partners</field>
        <field name="res_model">odms.partner</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem name="On Demand/Configuration/OD Partners" action="action_odms_partner_list" id="menu_list_partners" sequence="30"/>


    <!--
        OD Offer
    -->

      <record model="ir.ui.view" id="view_odms_offer_form">
        <field name="name">odms.offer.form</field>
        <field name="model">odms.offer</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="OD Offer">
            <notebook>
                <page string="Offer">
                    <field name="name" select="1"/>
                    <field name="active" select="2"/>
                    <field name="section_id" select="2"/>
                    <field name="portal_id"/>
                    <newline/>
                    <field name="description" colspan="4"/>
                </page>
                <page string="Bundles">
                    <separator string="Offer bundles" colspan="4"/>
                    <field name="bundle_ids" nolabel="1">
                    </field>
                </page>
                <page string="Emails">
                    <separator string="Freetrial" colspan="2"/>
                    <separator string="Subscription" colspan="2"/>
                    <field name="email_subject_trial" colspan="2" nolabel="1"/>
                    <field name="email_subject_subscription" colspan="2" nolabel="1"/>
                    <field name="email_trial" colspan="2" nolabel="1"/>
                    <field name="email_subscription" colspan="2" nolabel="1"/>
                    <separator string="Close" colspan="2"/>
                    <separator string="Legend" colspan="2"/>
                    <field name="email_subject_close" colspan="2" nolabel="1"/>
                    <label string="Brackets are evaluated, you can use the 'sub' object" colspan="2" align="0.0"/>
                    <field name="email_close" colspan="2" nolabel="1"/>
                    <label string="Exemple: [ sub.user_id.name ] or [ sub.email ]" colspan="2" align="0.0"/>
                </page>
            </notebook>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_offer_form">
        <field name="name">Offer</field>
        <field name="res_model">odms.offer</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">form,tree</field>
    </record>

    <menuitem name="On Demand/Configuration/Offers/Add an offer" action="action_odms_offer_form" id="menu_form_offer" sequence="1"/>


    <record model="ir.ui.view" id="view_odms_offer_list">
        <field name="name">odms.offer.list</field>
        <field name="model">odms.offer</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="OD Offers">
                <field name="name"/>
                <field name="description"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_offer_list">
        <field name="name">Offers</field>
        <field name="res_model">odms.offer</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem name="On Demand/Configuration/Offers/All offers" action="action_odms_offer_list" id="menu_list_offers" sequence="0"/>

    <!--
        OD Bundle
    -->

    <record model="ir.ui.view" id="view_odms_bundle_form">
        <field name="name">odms.bundle.form</field>
        <field name="model">odms.bundle</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="OD Bundle">
            <notebook>
            <page string="General">
                <field name="name" colspan="2" select="1"/>
                <newline/>
                <field name="product_id"/>
                <field name="price_type"/>
                <separator string="Description" colspan="4"/>
                <field name="note" colspan="4" nolabel="1"/>
            </page><page string="Modules">
                <field name="module_ids" colspan="4" nolabel="1">
                    <form string="Module">
                        <field name="name"/>
                        <field name="state"/>
                    </form>
                </field>
            </page>
            </notebook>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_bundle_form">
        <field name="name">Bundle</field>
        <field name="res_model">odms.bundle</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">form,tree</field>
    </record>

    <menuitem name="On Demand/Configuration/Bundles/Add a bundle" action="action_odms_bundle_form" id="menu_form_bundle" sequence="3"/>

    <record model="ir.ui.view" id="view_odms_bundle_list">
        <field name="name">odms.bundle.list</field>
        <field name="model">odms.bundle</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="OD Bundles">
                <field name="name"/>
                <field name="product_id"/>
                <field name="module_ids"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_bundle_list">
        <field name="name">Bundles</field>
        <field name="res_model">odms.bundle</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem name="On Demand/Configuration/Bundles/All bundles" action="action_odms_bundle_list" id="menu_list_bundles" sequence="2"/>


    <record model="ir.actions.act_window" id="action_odms_subs_bundle_list">
        <field name="name">Subscribed Bundles</field>
        <field name="res_model">odms.subs_bundle</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem
        name="On Demand/Configuration/Subscription Bundles/All Subscription Bundles"
        action="action_odms_subs_bundle_list" 
        id="menu_list_sucs_bundles" 
        sequence="2"/>


    <record model="ir.actions.act_window" id="action_odms_subs_bundle_list_installed">
        <field name="name">Installed Subscribed Bundles</field>
        <field name="res_model">odms.subs_bundle</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="domain">[('state','=','installed')]</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem
        name="On Demand/Configuration/Subscription Bundles/All Subscription Bundles/Installed Subscription Bundles"
        action="action_odms_subs_bundle_list_installed" 
        id="menu_list_sucs_bundles_installed" 
        sequence="2"/>


    <record model="ir.ui.view" id="view_odms_subs_bundle_tree">
        <field name="name">odms.subs_bundle.tree</field>
        <field name="model">odms.subs_bundle</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="Subscribed Bundles">
                <field name="bundle_id"/>
                <field name="subscription_id"/>
                <field name="price"/>
                <field name="state"/>
                <button name="%(odms_bundle_active_wizard)d" string="Activate This Service" states="notinstalled" type="action" icon="STOCK_APPLY"/>
            </tree>
        </field>
    </record>


    <record model="ir.ui.view" id="view_odms_subs_bundle_form">
        <field name="name">odms.subs_bundle.form</field>
        <field name="model">odms.subs_bundle</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Subscribed Bundles">
                <field name="bundle_id" select="1"/>
                <field name="subscription_id" select="2"/>
                <field name="price"/>
                <newline/>
                <field name="note" colspan="4"/>
                <separator string="Status" colspan="4"/>
                <field name="state" select="1"/>
                <group colspan="2">
                    <button name="%(odms_bundle_active_wizard)d" string="Activate This Service" states="notinstalled" type="action" icon="STOCK_APPLY"/>
                    <button name="uninstall_bundle" string="Uninstall Service" states="installed" type="object"/>
                </group>
            </form>
        </field>
    </record>



    <record model="ir.actions.act_window" id="action_odms_subs_bundle_list_uninstalled">
        <field name="name">Not Installed Subscribed Bundles</field>
        <field name="res_model">odms.subs_bundle</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="domain">[('state','=','notinstalled')]</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem
        name="On Demand/Configuration/Subscription Bundles/All Subscription Bundles/Not Installed Subscription Bundles"
        action="action_odms_subs_bundle_list_uninstalled" 
        id="menu_list_sucs_bundles_uninstalled" 
        sequence="2"/>


    <!--
        OD Module
    -->

    <record model="ir.ui.view" id="view_odms_module_form">
        <field name="name">odms.module.form</field>
        <field name="model">odms.module</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="OD Module">
            <field name="name" colspan="2" select="1"/>
            <newline/>
            <field name="bundle_id" select="1"/>
            <field name="state" select="1"/>
            </form>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_module_form">
        <field name="name">Module</field>
        <field name="res_model">odms.module</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">form,tree</field>
    </record>

    <menuitem name="On Demand/Configuration/Modules/Add a module" action="action_odms_module_form" id="menu_form_module" sequence="3"/>

    <record model="ir.ui.view" id="view_odms_module_list">
        <field name="name">odms.module.list</field>
        <field name="model">odms.module</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="OD Module">
                <field name="name"/>
                <field name="bundle_id"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_odms_module_list">
        <field name="name">Modules</field>
        <field name="res_model">odms.module</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem name="On Demand/Configuration/Modules/All modules" action="action_odms_module_list" id="menu_list_modules" sequence="2"/>

    <!--
        OD Subscription
    -->


    <record model="ir.ui.view" id="view_odms_subscription_form">
        <field name="name">odms.subscription.form</field>
        <field name="model">odms.subscription</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="OD Subscription">
            <notebook>
            <page string="General">
                <field name="name" select="1" />
                <field name="date" select="2" />
                <newline/>
                <field name="partner_id" on_change="onchange_partner_id(partner_id)" select="2" />
                <field name="odpartner_id" select="2" />
                <field name="offer_id" select="1" />
                <field name="pricelist_id" select="2" />
                <newline/>
                    <field name="max_users"/>
                    <button string="Update" name="_get_nbr_users" type="object" colspan="2"/>
                <newline/>
                <field name="activ_date" select="2" />
                <field name="deadline_date" select="2" />
                <field name="user_id" select="2" />
                <separator string="Login information" colspan="4"/>
                <field name="url" colspan="2" select="2"/>
                <label string=".od.openerp.com" colspan="2" align="0"/>
                <newline/>
                <field name="email" select="2"/>
                <field name="password" select="2"/>
                <field name="owner_id"/>
                <button string="Create Portal User" name="user_create" type="object" colspan="2"/>
                <separator string="ODMS Servers" colspan="2"/>
                <separator string="Status" colspan="1"/>
                <separator string="Actions" colspan="1"/>
                <field name="vserv_server_id"  domain="[('has_vserv','=',True)]"/>
                <field name="vserv_server_state" nolabel="1" colspan="1"/>
                <button name="create_vserv" string="Create VServer" type="object" colspan="3"/>
                <field name="vserver_id"/>
                <field name="vserver_state" nolabel="1" colspan="1"/>
                <button name="startstop_vserv" string="Start/Stop Vserver" type="object"/>
                <field name="web_server_id"  domain="[('has_web','=',True)]"/>
                <field name="web_server_state" nolabel="1" colspan="1"/>
                <button name="create_web" string="Create Web" type="object" colspan="3"/>
                <field name="bckup_server_id"  domain="[('has_bckup','=',True)]"/>
                <field name="bckup_server_state" nolabel="1" colspan="1"/>
                <button name="create_bckup" string="Create backup" type="object" colspan="3"/>
                <group colspan="4" col="7">
                    <field name="state" select="1"/>
                    <button name="create_subs" string="Create Subscritption" states="draft,trial" type="object"/>
                    <button name="create_trial" string="Create Free Trial" states="draft" type="object" />
                    <button name="suspend_subs" string="Suspend" states="active,trial" type="object" />
                    <button name="delete_subs" string="Delete" states="active,suspended" type="object" />
                    <button name="settodraft" string="Set to draft" states="deleted" type="object" />
                </group>
            </page>
            <page string="Notes">
                <field name="notes" colspan="4" nolabel="1"/>
            </page>
            <page string="Bundles">
                <field name="bundle_ids" colspan="4" nolabel="1">
                    <tree>
                        <field name="bundle_id"/>
                        <field name="price"/>
                        <field name="state"/>
                    </tree>
                    <form string="OD Subscription Bundle">
                        <separator string="General Information" colspan="4"/>
                        <field name="bundle_id"/>
                        <newline/>
                        <field name="price"/>
                        <field name="note"/>
                        <separator string="Status" colspan="4"/>
                        <field name="state"/>
                        <group colspan="2">
                            <button name="%(odms_bundle_active_wizard)d" string="Activate Service" states="notinstalled" type="action"/>
                            <button name="uninstall_bundle" string="Uninstall Service" states="installed" type="object"/>
                        </group>
                    </form>
                </field>
            </page>
            <page string="Statistics">
                <field name="price"/>
                <field name="nbr_users"/>
            </page>
            </notebook>
            </form>
        </field>
    </record>


    <record model="ir.ui.view" id="view_odms_subscription_list">
        <field name="name">odms.subscription.list</field>
        <field name="model">odms.subscription</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree string="OD Subscription">
                <field name="date" />
                <field name="name"/>
                <field name="partner_id"/>
                <field name="url"/>
                <field name="offer_id"/> 
                <field name="nbr_users"/>
                <field name="max_users"/>
                <field name="price"/>
                <field name="deadline_date" />
                <field name="state"/>
            </tree>
        </field>
    </record>


    <record model="ir.actions.act_window" id="action_odms_subscription_list">
        <field name="name">All Subscriptions</field>
        <field name="res_model">odms.subscription</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="On Demand/All subscriptions" action="action_odms_subscription_list" id="menu_list_subscription" sequence="10"/>

    <record model="ir.actions.act_window" id="action_odms_subscription_list_new">
        <field name="name">New Subscriptions Waiting Activation</field>
        <field name="domain">[('state','=','draft')]</field>
        <field name="res_model">odms.subscription</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="On Demand/All subscriptions/" action="action_odms_subscription_list_new" id="menu_list_subscription_new" sequence="1"/>


    <record model="ir.actions.act_window" id="action_odms_subscription_list_freetrial">
        <field name="name">Free Trial Subscriptions</field>
        <field name="domain">[('state','=','freetrial')]</field>
        <field name="res_model">odms.subscription</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="On Demand/All subscriptions/" action="action_odms_subscription_list_freetrial" id="menu_list_subscription_freetrial" sequence="1"/>

    <record model="ir.actions.act_window" id="action_odms_subscription_list_active">
        <field name="name">Active Subscriptions</field>
        <field name="domain">[('state','=','active')]</field>
        <field name="res_model">odms.subscription</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="On Demand/All subscriptions/" action="action_odms_subscription_list_active" id="menu_list_subscription_active" sequence="1"/>


    <record model="ir.actions.act_window" id="action_odms_subscription_list_my">
        <field name="name">My Subscriptions</field>
        <field name="domain">[('user_id','=',uid)]</field>
        <field name="res_model">odms.subscription</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="On Demand/All subscriptions/My Subscriptions" action="action_odms_subscription_list_my" id="menu_list_subscription_my" sequence="10"/>

    <record model="ir.actions.act_window" id="action_odms_subscription_list_deadline">
        <field name="name">Subscriptions</field>
        <field name="domain">[('state','in',('trial','active')),('deadline_date','&lt;=',time.strftime('%Y-%m-%d'))]</field>
        <field name="res_model">odms.subscription</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>
    <menuitem name="On Demand/All subscriptions/Subscriptions To Close" action="action_odms_subscription_list_deadline" id="menu_list_subscription_deadline" sequence="10"/>


    <act_window name="All Cases"
        domain="[('ref', '=', 'odms.subscription,'+str(active_id))]"
        res_model="crm.case"
        src_model="odms.subscription"
        view_type="form"
        view_mode="tree,form,calendar"
        id="act_odms_case_subscription"/>

</data>
</openerp>
