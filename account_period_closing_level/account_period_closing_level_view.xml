<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <record id="view_account_fiscalyear_level_form" model="ir.ui.view">
            <field name="name">account.fiscalyear_level.form</field>
            <field name="model">account.fiscalyear</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="account.view_account_fiscalyear_form"/>
            <field name="arch" type="xml">
                <data>
                    <button name="create_period" position="replace"/>
                    <button name="create_period3" position="replace"/>
                    <field name="end_journal_period_id" position="replace"/>
                </data>
            </field>
        </record>

        <record id="view_account_period_closing_level_form" model="ir.ui.view">
            <field name="name">account.period_closing_level.form</field>
            <field name="model">account.period</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="account.view_account_period_form"/>
            <field name="arch" type="xml">
                <data>
                    <form position="attributes">
                        <attribute name="hide_duplicate_button">1</attribute>
                        <attribute name="hide_new_button">1</attribute>
                    </form>
                    <field name="code" position="replace"/>
                    <field name="company_id" position="replace"/>
                    <button name="action_draft" position="replace">
                        <newline/>
                        <group colspan="4" col="2" attrs="{'invisible': [('state', '=', 'done')]}">
                            <separator string="Actions" colspan="4"/>
                        </group>
                        <newline/>
                        <group colspan="4" col="2">
                            <label string="" colspan="1"/>
                            <button name="action_set_state" states="created" confirm="Are you sure you want to open this period?" string="Open period" type="object" icon="gtk-go-forward" context="{'state': 'draft'}" colspan="1"/>
                        </group>
                        <group colspan="4" col="2">
                            <label string="" colspan="1"/>
                            <button name="button_close_field_period" string="Do closing period (Field) process" type="object" icon="gtk-go-forward" colspan="1" attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('field_process', '=', True)]}"/>
                        </group>
                        <group colspan="4" col="2">
                            <button name="action_set_state" states="field-closed" confirm="Are you sure you want to re-open this period?" string="Re-open period (Field)" type="object" icon="gtk-go-back" context="{'state': 'draft'}" colspan="1"/>

                            <button name="action_set_state" states="field-closed" confirm="Are you sure you want to close this period?" string="Close period (Mission)" type="object" icon="gtk-go-forward" context="{'state': 'mission-closed'}" colspan="1"/>
                        </group>
                        <group colspan="4" col="2">
                            <button name="action_set_state" states="mission-closed" confirm="Are you sure you want to re-open this period?" string="Re-open period (Mission)" type="object" icon="gtk-go-back" context="{'state': 'field-closed'}" colspan="1"/>
                            <button name="action_set_state" states="mission-closed" confirm="Are you sure you want to close this period?" string="Close period (HQ)" type="object" icon="gtk-go-forward" context="{'state': 'done'}" colspan="1"/>
                        </group>
                        <newline/>
                        <group attrs="{'invisible': [('field_process', '!=', True)]}" colspan="6" col="2">
                            <label string="You have to verify manually:" colspan="4" align="0.0"/>
                            <group col="4" colspan="4">
                                <label string="- Check that fx rates have been updated for the period to close" colspan="2" align="0.0"/>
                                <button string="Check currencies" name="button_fx_rate" type="object" icon="terp-dolar"/>
                            </group>
                            <group col="4" colspan="4">
                                <label string="- Check that HR entries from the Homere interface have been imported" colspan="2" align="0.0"/>
                                <button string="Check HR entries" name="button_hr" type="object" icon="terp-personal"/>
                            </group>
                            <group col="4" colspan="4">
                                <label string="- Check list of monthly accruals (all records, by account)" colspan="2" align="0.0"/>
                                <button string="Check accruals" name="button_accruals" type="object" icon="gtk-dnd-multiple"/>
                            </group>
                            <group col="4" colspan="4">
                                <label string="- Check list of recurring entries for the period (check that they have been generated)" colspan="2" align="0.0"/>
                                <button string="Check recurring entries" name="button_recurring" type="object" icon="terp-stage"/>
                            </group>
                            <separator string="" colspan="4"/>
                            <group col="6" colspan="4">
                                <label string="- Balances and aged balances of all third party accounts, grouped by partners (ie check list of all open invoices)" colspan="2" align="0.0"/>
                                <label string="" colspan="4"/>
                                <group colspan="3" col="4">
                                    <button string="Stock transfer vouchers" name="button_stock_transfer_vouchers" type="object" icon="gtk-dnd" readonly="1"/>
                                </group>
                                <group colspan="3" col="4">
                                    <button string="Supplier invoices" name="button_supplier_invoices" type="object" icon="gtk-dnd" colspan="4" readonly="1"/>
                                    <button string="Supplier refunds" name="button_supplier_refunds" type="object" icon="gtk-dnd" colspan="4" readonly="1"/>
                                    <button string="Supplier direct invoices" name="button_supplier_direct_invoices" type="object" icon="gtk-dnd" colspan="4" readonly="1"/>
                                    <button string="Donation" name="button_donation" type="object" icon="gtk-dnd" colspan="4" readonly="1"/>
                                    <button string="Intermission Voucher IN" name="button_intermission_in" type="object" icon="gtk-dnd" colspan="4" readonly="1"/>
                                </group>
                            </group>
                            <separator string="" colspan="4"/>
                            <group col="4" colspan="4">
                                <label string="- P&amp;L in local currency and in functional currency" colspan="2" align="0.0"/>
                                <label string="" colspan="2"/>
                            </group>
                            <group col="4" colspan="4">
                                <label string="- Calculation for unrealized gain / loss has run" colspan="2" align="0.0"/>
                                <label string="" colspan="2"/>
                            </group>
                            <separator string="" colspan="4"/>
                            <newline/>
                            <label string="" colspan="4" align="0.0"/>
                        </group>
                        <newline/>
                        <group attrs="{'invisible': [('field_process', '!=', True)]}" colspan="4" col="2">
                            <label string="" colspan="1"/>
                            <button name="action_set_state" states="draft" confirm="Are you sure you want to close this period?" string="Close period (Field)" type="object" icon="gtk-go-forward" context="{'state': 'field-closed'}" colspan="1"/>
                        </group>
                        <newline/>
                        <field name="field_process" invisible="1"/>
                    </button>
                </data>
            </field>
        </record>

        <record id="view_account_period_closing_level_search" model="ir.ui.view">
            <field name="name">account.period_closing_level.search</field>
            <field name="model">account.period</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="account.view_account_period_search"/>
            <field name="arch" type="xml">
                <filter name="draft" position="replace">
                    <filter string="To Close" name="draft" domain="[('state','!=','done')]" icon="terp-dialog-close"/>
                </filter>
            </field>
        </record>

        <record id="view_account_period_closing_level_tree" model="ir.ui.view">
            <field name="name">account.period_closing_level.tree</field>
            <field name="model">account.period</field>
            <field name="type">tree</field>
            <field name="inherit_id" ref="account.view_account_period_tree"/>
            <field name="arch" type="xml">
                <tree string="Period" position="replace">
                    <tree colors="blue:state in ('created');gray:state in ('done')" hide_new_button="1" string="Period">
                        <field name="name"/>
                        <field name="date_start"/>
                        <field name="date_stop"/>
                        <field name="special"/>
                        <field name="state"/>
                        <field name="number" invisible="1"/>
                        <button name="action_set_state" states="field-closed" confirm="Are you sure you want to re-open this period?" string="Re-open period (Field)" type="object" icon="gtk-go-back" context="{'state': 'draft'}" colspan="1"/>
                        <button name="action_set_state" states="created" confirm="Are you sure you want to open this period?" string="Open period" type="object" icon="gtk-go-forward" context="{'state': 'draft'}" colspan="1"/>
                    </tree>
                </tree>
            </field>
        </record>

        <record id="action_account_period_closing_level_tree" model="ir.actions.act_window">
            <field name="name">Close a Period</field>
            <field name="res_model">account.period</field>
            <field name="inherit_id" ref="account.action_account_period_tree"/>
            <field name="domain">[('state','!=','created')]</field>
            <field name="context">{'search_default_draft': 1}</field>
            <field name="help">A period is a fiscal period of time during which accounting entries should be recorded for accounting related activities. Monthly period is the norm but depending on your countries or company needs, you could also have quarterly periods. Closing a period will make it impossible to record new accounting entries, all new entries should then be made on the following open period. Close a period when you do not want to record new entries and want to lock this period for tax related calculation.</field>
        </record>

        <menuitem action="action_account_period_closing_level_tree"
            id="account.menu_action_account_period_close_tree"
            parent="account.menu_account_end_year_treatments"
            sequence="0"/>

        <delete model="ir.values" id="account.action_idea_post_vote_values"/>

    </data>
</openerp>
