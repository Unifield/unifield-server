<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
    
    	<record id="view_kit_creation_form" model="ir.ui.view">
            <field name="name">kit.creation.form</field>
            <field name="model">kit.creation</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
            	<form string="Kitting Order">
            		<group col="6" colspan="4">
            			<group col="4" colspan="4">
            				<field name="product_id_kit_creation" colspan="4" on_change="on_change_product_id(product_id_kit_creation)" attrs="{'readonly': [('state', '!=', 'draft')]}" />
            				<field name="qty_kit_creation" attrs="{'readonly': [('state', '!=', 'draft')]}" colspan="2" />
                        	<field name="uom_id_kit_creation" attrs="{'readonly': [('state', '!=', 'draft')]}" colspan="2" />
            			</group>
                        <group col="4" colspan="2">
                        	<field name="name" colspan="2" attrs="{'readonly': [('state', '!=', 'draft')]}" />
	                        <field name="creation_date_kit_creation" colspan="2" attrs="{'readonly': [('state', '!=', 'draft')]}" />
	                        <field name="batch_check_kit_creation" invisible="True" colspan="2" />
	                        <field name="expiry_check_kit_creation" invisible="True" colspan="2" />
	                        <field name="version_id_kit_creation"
                        		attrs="{'readonly': [('state', '!=', 'draft')]}"
                        		domain="[('composition_product_id', '=', product_id_kit_creation), ('composition_type', '=', 'theoretical'), ('state', '=', 'completed')]"
                        		colspan="4" />
                        </group>
                    </group>
                    <notebook colspan="4">
                    	<page string="Components">
                    		<field name="default_location_src_id_kit_creation" />
                    		<field name="consider_child_locations_kit_creation" /> 
                    		<field name="to_consume_ids_kit_creation" colspan="4" nolabel="True" context="{'location_src_id_consume_common': default_location_src_id_kit_creation}" />
                    		<group colspan="2" />
                    		<button name="reset_to_version" type="object" string="Check Availability" icon="gtk-clear" />
                    		<button name="reset_to_version" type="object" string="Process All Lines" icon="gtk-clear" />
                    		<field name="consumed_ids_kit_creation" colspan="4" nolabel="True" />
                    		
                    	</page>
                    	<page string="Kits">
                    		
                    	</page>
                    	<page string="Notes">
                    		<field name="notes_kit_creation" nolabel="True" />
                    	</page>
                    </notebook>
                    <group col="5" colspan="2">
                    	<field name="state" colspan="3" />
                    </group>
                    <group col="7" colspan="2">
                    	<button name="reset_to_version" type="object" string="Reset to Version" icon="gtk-clear" attrs="{'invisible': ['|', ('composition_type', '!=', 'real'), ('state', '!=', 'draft')]}" />
                    	<button name="mark_as_completed" string="Mark as Completed" type="object" icon="gtk-go-forward" attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('active', '=', False)]}" />
                    	<button name="substitute_items" type="object" string="Substitute Items" icon="terp-stock_effects-object-colorize" attrs="{'invisible': ['|', ('composition_type', '!=', 'real'), ('state', '!=', 'completed')]}" />
                        <button name="de_kitting" string="De-Kitting" type="object" icon="gtk-dnd-multiple" attrs="{'invisible': ['|', ('composition_type', '!=', 'real'), ('state', '!=', 'completed')]}" />
                        <button name="close_kit" string="Close" type="object" icon="gtk-close" attrs="{'invisible': ['|', ('composition_type', '!=', 'real'), ('state', '!=', 'completed')]}" />
                        <button name="mark_as_inactive" string="Mark as Inactive" type="object" icon="gtk-missing-image" attrs="{'invisible': ['|', ('composition_type', '!=', 'theoretical'), ('active', '=', False)]}" />
                        <button name="mark_as_active" string="Mark as Active" type="object" icon="gtk-redo" attrs="{'invisible': ['|', ('composition_type', '!=', 'theoretical'), ('active', '=', True)]}" />
                    </group>
            	</form>
            </field>
		</record>
		
		<record id="view_kit_creation_tree" model="ir.ui.view">
            <field name="name">kit.creation.tree</field>
            <field name="model">kit.creation</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
            	<tree string="Kitting Order">
            		<field name="name" />
            		<field name="product_id_kit_creation" />
            		<field name="version_id_kit_creation" />
            		<field name="qty_kit_creation" />
            		<field name="uom_id_kit_creation" />
            		<field name="creation_date_kit_creation" />
            		<field name="state" />
            	</tree>
            </field>
		</record>
		
		<record id="view_kit_creation_to_consume_tree" model="ir.ui.view">
            <field name="name">kit.creation.to.consume.tree</field>
            <field name="model">kit.creation.to.consume</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
            	<tree string="Components to Consume" editable="top" colors="red:qty_available_to_consume &lt; total_qty_to_consume">
            		<field name="product_id_consume_common"
            			on_change="on_change_product_id(product_id_consume_common, parent.default_location_src_id_kit_creation, parent.consider_child_locations_kit_creation, context)" />
            		<field name="qty_consume_common"
            			string="Qty per Kit"
            			on_change="on_change_qty(qty_consume_common, parent.qty_kit_creation, context)" />
            		<field name="total_qty_to_consume" />
            		<field name="uom_id_consume_common"
            			on_change="on_change_uom_id(product_id_consume_common, parent.default_location_src_id_kit_creation, parent.consider_child_locations_kit_creation, uom_id_consume_common, location_src_id_consume_common, context)" />
            		<field name="location_src_id_consume_common" />
            		<field name="qty_available_to_consume" />
            		<field name="availability_to_consume" invisible="True" />
            		<field name="state" invisible="True" />
            		<field name="batch_check_kit_creation_consume_common" />
            		<field name="expiry_check_kit_creation_consume_common" />
            	</tree>
            </field>
		</record>
		
		<record id="view_kit_creation_consumed_tree" model="ir.ui.view">
            <field name="name">kit.creation.consumed.tree</field>
            <field name="model">kit.creation.consumed</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
            	<tree string="Components Consumed" editable="top">
            		<field name="product_id_consume_common" />
            		<field name="qty_consume_common" />
            		<field name="uom_id_consume_common" />
            		<field name="lot_id_consumed" />
            		<field name="expiry_date_consumed" />
            		<field name="location_src_id_consume_common" />
            		<field name="kit_id_consumed" />
            		<field name="state" invisible="True" />
            		<field name="batch_check_kit_creation_consume_common" />
            		<field name="expiry_check_kit_creation_consume_common" />
            	</tree>
            </field>
		</record>
		
		<record id="view_kit_creation_filter" model="ir.ui.view">
            <field name="name">kit.creation.filter</field>
            <field name="model">kit.creation</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Kitting Order">
                    <filter icon="terp-document-new" name="draft" string="Draft" domain="[('state','=','draft')]" separator="1" />
                    <filter icon="terp-stock_effects-object-colorize" name="in_production" string="In Production" domain="[('state','=', 'in_production')]" separator="1" />
                    <filter icon="terp-dialog-close" name="done" string="Closed" domain="[('state','=','done')]" />
                    <separator orientation="vertical" />
                    <field name="name" select="1" />
                    <field name="product_id_kit_creation" domain="[('type', '=', 'product'), ('subtype', '=', 'kit')]" select="1" />
                    <field name="version_id_kit_creation" select="1" context="{'wizard_composition_type': 'theoretical'}" domain="[('composition_type', '=', 'theoretical'), ('state', '=', 'completed')]" />
                    <field name="creation_date_kit_creation" />
                    <newline />
                  	<group expand="0" string="Group By..." colspan="4" col="10" groups="base.group_extended">
	                    <filter string="Product" icon="terp-product" domain="[]" context="{'group_by':'product_id_kit_creation'}" />
	                    <filter string="Version" icon="gtk-select-font" domain="[]" context="{'group_by':'version_id_kit_creation'}" />
	                    <filter string="State" icon="gtk-execute" domain="[]" context="{'group_by':'state'}"/>
	                    <separator orientation="vertical"/>
	                    <filter string="Creation Date" icon="terp-go-month" domain="[]" context="{'group_by':'creation_date_kit_creation'}"/>
                	</group>
              	</search>
            </field>
        </record>
		
		<record id="kit_creation_action" model="ir.actions.act_window">
			<field name="name">Kitting Order</field>
			<field name="res_model">kit.creation</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[]</field>
			<field name="context">{}</field>
			<field name="search_view_id" ref="view_kit_creation_filter" />
		</record>
		
		<record id="kit_creation_action2" model="ir.actions.act_window">
			<field name="name">Kitting Orders</field>
			<field name="res_model">kit.creation</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('composition_product_id', '=', active_id)]</field>
			<field name="context">{}</field>
			<field name="search_view_id" ref="view_kit_creation_filter" />
		</record>
		
		<record id="ir_open_composition_list_view" model="ir.values">
		    <field name="key2">client_action_relate</field>
		    <field name="model">product.product</field>
		    <field name="name">Kitting Orders</field>
		    <field eval="'ir.actions.act_window,%d'%ref('kit_creation_action2')" name="value"/>
		    <field name="key">action</field>
		    <field eval="True" name="object"/>
		</record>
		
		<menuitem action="kit_creation_action" id="kit_creation_menu" parent="kit_management" sequence="20" />
		
    </data>
</openerp>
